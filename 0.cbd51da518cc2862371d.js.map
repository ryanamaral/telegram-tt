{"version":3,"sources":["webpack:///./src/hooks/useLang.ts","webpack:///./src/components/ui/ListItem.tsx","webpack:///./src/hooks/useIntersectionObserver.ts","webpack:///./src/hooks/useMedia.ts","webpack:///./src/components/common/PrivateChatInfo.tsx","webpack:///./src/components/ui/Modal.tsx","webpack:///./src/util/trapFocus.ts","webpack:///./src/components/ui/Transition.tsx","webpack:///./src/components/common/Avatar.tsx","webpack:///./src/components/ui/InfiniteScroll.tsx","webpack:///./src/hooks/useOnChange.ts","webpack:///./src/hooks/useTransitionForMedia.ts","webpack:///./src/components/common/helpers/mediaDimensions.ts","webpack:///./src/components/common/AnimatedSticker.tsx","webpack:///./src/components/ui/ConfirmDialog.tsx","webpack:///./src/components/common/NothingFound.tsx","webpack:///./src/components/right/hooks/useAsyncRendering.ts","webpack:///./src/hooks/useMediaWithDownloadProgress.ts","webpack:///./src/components/ui/ProgressSpinner.tsx","webpack:///./src/components/ui/Portal.ts","webpack:///./src/components/common/GroupChatInfo.tsx","webpack:///./src/util/fastSmoothScroll.ts","webpack:///./src/components/ui/Radio.tsx","webpack:///./src/components/ui/RadioGroup.tsx","webpack:///./src/hooks/useInfiniteScroll.ts","webpack:///./src/components/common/AnimatedEmoji.tsx","webpack:///./src/util/focusEditableElement.ts","webpack:///./src/hooks/useBackgroundMode.ts","webpack:///./src/util/captureEvents.ts","webpack:///./src/components/common/VerifiedIcon.tsx","webpack:///./src/util/cycleRestrict.ts","webpack:///./src/hooks/useCurrentOrPrev.ts","webpack:///./src/util/safePlay.ts","webpack:///./src/hooks/useBuffering.ts","webpack:///./src/components/middle/composer/helpers/parseMessageInput.ts","webpack:///./src/components/middle/composer/DropTarget.tsx","webpack:///./src/components/middle/composer/DropArea.tsx","webpack:///./src/components/common/PickerSelectedItem.tsx","webpack:///./src/util/fastSmoothScrollHorizontal.ts","webpack:///./src/hooks/useHorizontalScroll.ts","webpack:///./src/hooks/useEnsureMessage.ts","webpack:///./src/hooks/useContextMenuHandlers.ts","webpack:///./src/components/common/helpers/renderMessageText.tsx","webpack:///./src/hooks/useBlur.ts","webpack:///./src/hooks/useVideoCleanup.ts","webpack:///./src/util/clipboard.ts","webpack:///./src/components/ui/SearchInput.tsx","webpack:///./src/util/resetScroll.ts","webpack:///./src/components/common/TypingStatus.tsx","webpack:///./src/components/common/DeleteChatModal.tsx","webpack:///./src/util/patchSafariProgressiveAudio.ts","webpack:///./src/hooks/useLayoutEffectWithPrevDeps.ts","webpack:///./src/components/common/Document.tsx","webpack:///./src/components/common/StickerSetModal.async.tsx","webpack:///./src/components/middle/composer/TextFormatter.tsx","webpack:///./src/components/common/Media.tsx","webpack:///./src/components/common/Audio.tsx","webpack:///./src/util/waveform.ts","webpack:///./src/components/common/helpers/waveform.ts","webpack:///./src/components/ui/Tab.tsx","webpack:///./src/components/ui/TabList.tsx","webpack:///./src/util/getReadableErrorText.ts","webpack:///./src/hooks/useChatContextActions.ts","webpack:///./src/components/common/LastMessageMeta.tsx","webpack:///./src/components/common/MessageOutgoingStatus.tsx","webpack:///./src/hooks/useContextMenuPosition.ts","webpack:///./src/components/ui/ShowTransition.tsx","webpack:///./src/hooks/usePrevDuringAnimation.ts","webpack:///./src/hooks/useAudioPlayer.ts","webpack:///./src/util/audioPlayer.ts","webpack:///./src/util/download.ts","webpack:///./src/components/common/File.tsx","webpack:///./src/lib/fastBlur.js","webpack:///./src/components/ui/Notification.tsx","webpack:///./src/components/middle/composer/helpers/selection.ts","webpack:///./src/components/middle/composer/hooks/useEmojiTooltip.ts","webpack:///./src/components/middle/composer/EmojiTooltip.async.tsx","webpack:///./src/components/middle/composer/MessageInput.tsx","webpack:///./src/hooks/useBlurSync.ts","webpack:///./src/components/common/WebLink.tsx","webpack:///./src/components/left/main/hooks/useChatAnimationType.ts","webpack:///./src/components/left/main/Badge.tsx","webpack:///./src/components/left/main/Chat.tsx","webpack:///./src/components/left/main/ChatList.tsx","webpack:///./src/components/middle/composer/hooks/useMentionTooltip.ts","webpack:///./src/components/middle/composer/helpers/searchUserName.ts"],"names":["forceUpdate","useForceUpdate","useOnChange","langProvider","ListItem","props","ref","icon","className","style","children","disabled","ripple","narrow","inactive","focus","destructive","multiline","isStatic","contextActions","onClick","containerRef","useRef","isContextMenuOpen","contextMenuPosition","handleBeforeContextMenu","handleContextMenu","handleContextMenuClose","handleContextMenuHide","useContextMenuHandlers","getTriggerElement","useCallback","current","getRootElement","closest","getMenuElement","querySelector","positionX","positionY","menuStyle","useContextMenuPosition","handleClick","e","handleMouseDown","IS_TOUCH_ENV","button","fullClassName","buildClassName","role","tabIndex","undefined","onMouseDown","onContextMenu","isOpen","autoClose","onClose","onCloseAnimationEnd","map","action","key","title","handler","useIntersectionObserver","rootRef","throttleMs","debounceMs","shouldSkipFirst","margin","threshold","isDisabled","rootCallback","controllerRef","rootCallbackRef","isFrozenRef","onUnfreezeRef","freeze","unfreeze","useHeavyAnimationCheck","useEffect","observer","disconnect","callbacks","clear","observe","target","targetCallback","Map","entriesAccumulator","observerCallbackSync","entries","Array","from","values","forEach","entry","callback","get","scheduler","throttle","debounce","observerCallback","IntersectionObserver","set","root","rootMargin","initController","controller","delete","unobserve","useOnIntersect","targetRef","useIsIntersecting","isIntersecting","setIsIntersecting","useState","mediaHash","noLoad","mediaFormat","ApiMediaFormat","BlobUrl","cacheBuster","delay","mediaData","mediaLoader","startedAt","Date","now","then","spentTime","setTimeout","memo","withGlobal","global","userId","forceShowSelf","lastSyncTime","user","selectUser","isSavedMessages","isSelf","areMessagesLoaded","Boolean","selectChatMessages","setGlobal","actions","pick","typingStatus","avatarSize","status","withMediaViewer","withUsername","withFullInfo","withUpdatingStatus","noStatusOrTyping","loadFullUser","openMediaViewer","id","fullName","getUserFullName","handleAvatarViewerOpen","hasPhoto","stopPropagation","avatarOwnerId","origin","MediaViewerOrigin","ProfileAvatar","MiddleHeaderAvatar","lang","useLang","size","renderText","isVerified","isUserOnline","username","getUserStatus","Modal","header","hasCloseButton","noBackdrop","onEnter","shouldRender","transitionClassNames","useShowTransition","modalRef","captureKeyboardListeners","onEsc","element","handleKeyDown","preventDefault","focusableElements","querySelectorAll","length","currentFocusedIndex","findIndex","em","isSameNode","document","activeElement","newFocusedIndex","shiftKey","addEventListener","removeEventListener","trapFocus","useEffectWithPrevDeps","prevIsOpen","body","classList","toggle","dispatchHeavyAnimationEvent","remove","Portal","Button","round","color","ariaLabel","ANIMATION_DURATION","slide","fade","IS_MOBILE_SCREEN","reveal","CLEANED_UP","Symbol","animationLevel","settings","byKey","activeKey","name","direction","renderCount","shouldRestoreHeight","shouldCleanup","onStart","onStop","rendersRef","prevActiveKey","usePrevious","activateTimeoutRef","activeKeyChanged","useLayoutEffect","cleanup","container","childElements","add","childNodes","clearTimeout","isBackwards","keys","Object","Number","prevActiveIndex","indexOf","activeIndex","node","i","HTMLElement","width","offsetWidth","scrollBy","left","behavior","ANIMATION_END_DELAY","requestAnimationFrame","window","scrollLeft","height","clientHeight","flexBasis","renders","contents","fill","render","chat","text","withOnlineStatus","isDeleted","isDeletedUser","imageHash","getChatAvatarHash","dataUri","useMedia","DataUri","shouldRenderFullMedia","useTransitionForMedia","content","src","alt","decoding","userFullName","getFirstLetters","getChatTitle","isChatPrivate","isOnline","getUserColorKey","senderId","data-test-sender-id","IS_TEST","InfiniteScroll","onLoadMore","onScroll","items","itemSelector","preloadBackwards","sensitiveArea","noScrollRestore","noScrollRestoreOnTop","noFastList","stateRef","loadMoreBackwards","loadMoreForwards","useMemo","LoadMoreDirection","Backwards","Forwards","scrollHeight","state","newScrollTop","listItemElements","currentAnchor","includes","scrollTop","getBoundingClientRect","top","currentAnchorTop","nextAnchor","resetScroll","isScrollTopJustUpdated","handleScroll","listLength","offsetHeight","isNearTop","offsetTop","isNearBottom","isUpdated","nextAnchorTop","newAnchorTop","offsetParent","teactFastList","cb","dependencies","prevDeps","some","d","SPEED","fast","slow","speed","noAnimate","isMediaLoaded","willAnimate","shouldRenderThumb","setShouldRenderThumb","MEDIA_VIEWER_MEDIA_QUERY","REM","parseInt","getComputedStyle","documentElement","fontSize","ROUND_VIDEO_DIMENSIONS","AVATAR_FULL_DIMENSIONS","DEFAULT_MEDIA_DIMENSIONS","cachedMaxWidth","getAvailableWidth","fromOwnMessage","isForwarded","isWebPagePhoto","extraPaddingRem","regularMaxWidth","Math","min","floor","innerWidth","getMaxMessageWidthRem","calculateDimensionsForMessageMedia","isGif","aspectRatio","calculateDimensions","getAvailableHeight","getMediaViewerAvailableDimensions","withFooter","isVideo","mql","matchMedia","windowWidth","windowHeight","windowSize","occupiedHeightRem","matches","calculateInlineImageDimensions","photo","getPhotoInlineDimensions","calculateVideoDimensions","video","getVideoDimensions","getPictogramDimensions","getDocumentThumbnailDimensions","smaller","getStickerDimensions","sticker","baseWidth","STICKER_SIZE_INLINE_MOBILE_FACTOR","STICKER_SIZE_INLINE_DESKTOP_FACTOR","calculatedHeight","calculateMediaViewerDimensions","availableWidth","availableHeight","mediaWidth","mediaHeight","calculatedWidth","lottiePromise","RLottie","async","ensureLottie","default","animationData","play","playSegment","noLoop","quality","isLowPriority","onLoad","animation","setAnimation","wasPlaying","isFrozen","playRef","playSegmentRef","exec","newAnimation","setSpeed","fastRaf","destroy","playAnimation","shouldRestart","goToAndPlay","pauseAnimation","pause","freezeAnimation","isPlaying","unfreezeAnimation","unfreezeAnimationOnRaf","useBackgroundMode","textParts","confirmLabel","confirmHandler","confirmIsDestructive","isButtonsInOneRow","split","textPart","isText","description","useAsyncRendering","shouldRenderRef","timeoutRef","isStreaming","Stream","IS_PROGRESSIVE_SUPPORTED","Progressive","downloadProgress","setDownloadProgress","startedAtRef","handleProgress","progress","RADIUSES","s","m","l","xl","square","transparent","noCross","radius","circleRadius","STROKE_WIDTH","borderRadius","circumference","PI","svg","firstElementChild","strokeDashOffset","max","setAttribute","toString","innerHTML","containerId","elementRef","createElement","appendChild","TeactDOM","removeChild","chatId","selectChat","onlineCount","selectChatOnlineCount","withChatType","loadFullChat","isSuperGroup","isChatSuperGroup","isMin","isRestricted","getChatTypeString","handle","groupStatus","chatTypeString","membersCount","getGroupStatus","onlineStatus","renderStatusOrTyping","isAnimating","fastSmoothScroll","position","maxDistance","forceDirection","forceDuration","forceCurrentContainerHeight","FocusDirection","Static","scrollIntoView","block","offset","Up","Down","elementTop","elementHeight","containerHeight","targetContainerHeight","dataset","normalHeight","path","remainingPath","duration","abs","startAt","animateSingle","t","currentPath","transition","scrollWithJs","isAnimatingScroll","label","subLabel","value","checked","hidden","isLoading","onChange","type","Spinner","options","selected","loadingOption","handleChange","event","currentTarget","option","getViewportSlice","sourceIds","offsetId","listSlice","index","indexForDirection","to","newViewportIds","slice","areSomeLocal","areAllLocal","listIds","forceFullPreload","lastParamsRef","viewportIdsRef","prevListIds","prevIsDisabled","areSortedArraysEqual","viewportIds","getMore","AnimatedEmoji","isInline","observeIntersection","isAnimationLoaded","markAnimationLoaded","useFlag","localMediaHash","previewBlobUrl","Lottie","playKey","setPlayKey","String","random","STICKER_SIZE_TWO_FA","focusEditableElement","force","selection","getSelection","range","createRange","lastChild","nodeValue","setStart","removeAllRanges","addRange","onBlur","onFocus","hasFocus","SwipeDirection","captureEvents","captureEvent","currentSwipeAxis","hasMoved","onCapture","excludedClosestSelector","onMove","onRelease","pageX","touches","pageY","withCursor","dragOffsetX","dragOffsetY","onDrag","onSwipe","xAbs","yAbs","Left","Right","processSwipe","passive","VerifiedIcon","cycleRestrict","useCurrentOrPrev","shouldSkipUndefined","shouldForceCurrent","prev","mediaEl","catch","err","DEBUG","console","warn","noInitiallyBuffered","isBuffered","setIsBuffered","bufferedProgress","setBufferedProgress","setIsBufferedDebounced","handleBuffering","media","isSafariPatchInProgress","buffered","end","readyState","currentTime","bufferingHandlers","onLoadedData","onPlaying","onLoadStart","onPause","onTimeUpdate","onProgress","checkBuffering","ENTITY_CLASS_BY_NODE_NAME","B","ApiMessageEntityTypes","Bold","STRONG","I","Italic","EM","U","Underline","S","Strike","STRIKE","DEL","CODE","Code","PRE","Pre","BLOCKQUOTE","Blockquote","parseMessageInput","html","fragment","parsedHtml","IS_EMOJI_SUPPORTED","replace","parseMarkdown","innerText","trim","textIndex","recursionDeepness","entities","addEntity","entity","rawText","nodeName","anchor","entityType","MentionName","href","startsWith","Email","Phone","textContent","TextUrl","Url","getEntityTypeFromNode","rawIndex","substring","url","getEntityDataFromNode","push","hasChildNodes","isQuick","onFileSelect","isHovered","markHovered","unmarkHovered","onDrop","onDragEnter","onDragLeave","relatedTarget","toTarget","DropAreaState","withQuick","onHide","hideTimeoutRef","prevWithQuick","captureEscKeyListener","handleFilesDrop","dataTransfer","dt","files","handleQuickFilesDrop","handleDragLeave","fromTarget","onDragOver","chatOrUserId","isMinimized","canClose","clickArg","iconElement","titleText","getUserFirstOrLastName","fastSmoothScrollHorizontal","IS_IOS","containerWidth","scrollWidth","animate","scrollTo","deltaX","deltaY","messageId","message","replyOriginForId","loadMessage","getDispatch","loadMessageThrottled","throttled","contextMenuCounter","isMenuDisabled","shouldDisableOnLink","setIsContextMenuOpen","setContextMenuPosition","x","clientX","y","clientY","timer","clearLongPressTimer","startLongPressTimer","contains","originalEvent","cancelClickOnce","stopImmediatePropagation","emulateContextMenuEvent","renderMessageText","highlight","shouldRenderHqEmoji","formattedText","getMessageText","renderTextWithEntities","organizeEntities","organizedEntityIndexes","Set","organizedEntities","has","organizedEntity","organizeEntity","organizedIndexes","nestedEntities","filter","organizedIndex","shouldRenderAsHtml","renderMessagePart","result","deleteLineBreakAfterPre","organizedEntites","renderEntity","textPartStart","textPartEnd","isLastEntity","renderResult","textBefore","textBeforeLength","substr","entityStartIndex","entityEndIndex","entityContent","nestedEntityContent","nestedIndex","nestedEntity","nestedEntityIndex","nestedResult","nestedEntityEndIndex","newEntity","rawEntityText","renderedContent","join","getLinkUrl","processEntityAsHtml","entityText","BotCommand","handleBotCommandClick","Hashtag","Cashtag","handleHashtagClick","rel","Mention","processEntity","isArray","textAfter","arrayIndex","c","emojiFilter","sendBotCommand","command","setLocalTextSearchQuery","query","searchTextMessagesLocal","cache","useBlur","blurredRef","img","Image","onload","canvas","imgToCanvas","fastBlur","getContext","blurredDataUri","toDataURL","useVideoCleanup","videoRef","videoEl","load","CLIPBOARD_ITEM_SUPPORTED","navigator","clipboard","ClipboardItem","textCopyEl","copyTextToClipboard","str","rangeToRestore","rangeCount","getRangeAt","select","execCommand","copyImageToClipboard","imageUrl","ctx","imageEl","drawImage","toBlob","copyBlobToClipboard","pngBlob","write","error","inputId","focused","placeholder","onReset","inputRef","isInputFocused","markInputFocused","unmarkInputFocused","blur","overflow","typingUser","typingUserName","isPrivateChat","isChatWithSelf","selectIsChatWithSelf","canDeleteForAll","contactName","getPrivateChatUserId","isChannel","isChatChannel","isBasicGroup","isChatBasicGroup","chatTitle","leaveChannel","deleteHistory","deleteChannel","handleDeleteMessageForAll","maxId","lastMessage","shouldDeleteForAll","handleDeleteChat","isCreator","patchSafariProgressiveAudio","audioEl","patchedForSafari","patchForSafariInProgress","paused","once","uploadProgress","withDate","datetime","sender","isSelected","isSelectable","onCancelUpload","onDateClick","extension","getDocumentExtension","fileName","timestamp","isDownloadAllowed","setIsDownloadAllowed","useMediaWithDownloadProgress","getMessageMediaHash","isUploading","isTransferring","transferProgress","getMediaTransferState","hasPreview","getDocumentHasPreview","thumbDataUri","getMessageMediaThumbDataUri","localBlobUrl","previewData","isAllowed","handleDateClick","download","thumbnailDataUri","StickerSetModal","useModuleLoader","Bundles","Extra","TEXT_FORMAT_BY_TAG_NAME","anchorPosition","selectedRange","linkUrlInputRef","isLinkControlOpen","openLinkControl","closeLinkControl","linkUrl","setLinkUrl","isEditingLink","setIsEditingLink","inputClassName","setInputClassName","selectedTextFormats","setSelectedTextFormats","useVirtualBackdrop","selectedFormats","parentElement","commonAncestorContainer","EDITABLE_INPUT_ID","textFormat","tagName","getSelectedText","getSelectedElement","updateInputStyles","input","getFormatButtonClassName","fKey","monospace","strikethrough","handleBoldText","bold","handleItalicText","italic","handleUnderlineText","underline","handleStrikethroughText","replaceWith","handleMonospaceText","handleLinkUrlConfirm","formattedLinkUrl","restoreSelection","KeyK","KeyB","KeyU","KeyI","KeyM","KeyS","code","altKey","ctrlKey","metaKey","linkUrlConfirmClassName","onKeyDown","autoComplete","inputMode","idPrefix","mediaBlobUrl","getMessageVideo","formatMediaDuration","MIN_SPIKES","MAX_SPIKES","renderSeekline","playProgress","handleStartSeek","handleSeek","handleStopSeek","onMouseMove","onMouseUp","theme","senderTitle","renderingFor","date","onPlay","onReadMedia","audio","voice","isMediaUnread","isVoice","isSeeking","isActivated","setIsActivated","shouldDownload","getMessageMediaFormat","useBuffering","playPause","setCurrentTime","useAudioPlayer","getMessageKey","getMediaDuration","isMessageLocal","shouldRenderSpinner","spinnerClassNames","handleButtonClick","seekBar","seekHandlers","isOwn","isOwnMessage","renderedWaveform","waveform","fillColor","fillOwnColor","progressFillColor","progressFillOwnColor","durationFactor","spikesCount","decodedWaveform","encoded5bit","bitsCount","valuesCount","bitsData","byteIndex","bitShift","lastByteIndex","lastBitShift","lastValue","decodeWaveform","Uint8Array","data","spikes","peak","fitCount","newData","springFactor","leftFiller","rightFiller","idx","val","interpolateArray","fillStyle","progressFillStyle","scale","item","globalAlpha","spikeHeight","beginPath","moveTo","arcTo","closePath","roundedRectangle","renderWaveformToDataUri","draggable","renderWaveform","buttonClassNames","showSeekline","contentClassName","ProgressSpinner","getFirstLine","Link","formatPastTimeShort","performer","getSecondLine","formatMediaDateTime","renderAudio","renderVoice","active","badgeCount","isBadgeActive","previousActiveTab","tabRef","tab","indicator","currentIndicator","shiftLeft","offsetLeft","scaleFactor","clientWidth","transform","tabs","activeTab","big","onSwitchTab","useHorizontalScroll","activeTabElement","newLeft","READABLE_ERROR_MESSAGES","CHAT_RESTRICTED","CHAT_WRITE_FORBIDDEN","CHAT_SEND_POLL_FORBIDDEN","CHAT_SEND_STICKERS_FORBIDDEN","CHAT_SEND_GIFS_FORBIDDEN","CHAT_SEND_MEDIA_FORBIDDEN","CHAT_LINK_EXISTS","SLOWMODE_WAIT_X","USER_BANNED_IN_CHANNEL","USER_IS_BLOCKED","YOU_BLOCKED_USER","IMAGE_PROCESS_FAILED","MEDIA_EMPTY","MEDIA_INVALID","PHOTO_EXT_INVALID","PHOTO_INVALID_DIMENSIONS","PHOTO_SAVE_FILE_INVALID","MESSAGE_DELETE_FORBIDDEN","MESSAGE_POLL_CLOSED","MESSAGE_EDIT_TIME_EXPIRED","CHAT_ADMIN_REQUIRED","PINNED_DIALOGS_TOO_MUCH","DIALOG_FILTERS_TOO_MUCH","CHANNEL_PRIVATE","MEDIA_CAPTION_TOO_LONG","ADDRESS_STREET_LINE1_INVALID","ADDRESS_STREET_LINE2_INVALID","ADDRESS_CITY_INVALID","ADDRESS_COUNTRY_INVALID","ADDRESS_POSTCODE_INVALID","ADDRESS_STATE_INVALID","REQ_INFO_NAME_INVALID","REQ_INFO_PHONE_INVALID","REQ_INFO_EMAIL_INVALID","LINK_NOT_MODIFIED","SERVICE_WORKER_DISABLED","CAPTION_TOO_LONG_PLEASE_REMOVE_CHARACTERS","FRESH_RESET_AUTHORISATION_FORBIDDEN","BOTS_TOO_MUCH","BOT_GROUPS_BLOCKED","USERS_TOO_MUCH","USER_CHANNELS_TOO_MUCH","USER_KICKED","USER_NOT_MUTUAL_CONTACT","USER_PRIVACY_RESTRICTED","INVITE_HASH_EMPTY","INVITE_HASH_EXPIRED","INVITE_HASH_INVALID","CHANNELS_TOO_MUCH","USER_ALREADY_PARTICIPANT","getReadableErrorText","isSlowMode","textParams","extraPartIndex","errorMessage","reduce","acc","privateChatUser","handleDelete","folderId","isPinned","toggleChatPinned","updateChatMutedState","toggleChatArchived","toggleChatUnread","actionUnreadMark","unreadCount","hasUnreadMark","actionPin","actionMute","isMuted","actionArchive","isChatArchived","getCanDeleteChat","outgoingStatus","Keys","extraPaddingX","extraTopPadding","setPositionX","setPositionY","setStyle","triggerEl","emptyRect","menuEl","rootEl","triggerRect","menuRect","rootRect","ShowTransition","isCustom","prevChildren","fromChildrenRef","usePrevDuringAnimation","isCurrentPresent","isPrevPresent","trackId","originalDuration","handlers","onInit","shouldPlay","onForcePlay","noPlaylist","setIsPlaying","isPlayingSync","setPlayProgress","register","eventName","proxy","isFinite","prevShouldPlay","prevSrc","audioProxy","tracks","currentTrackId","queue","stopCurrentAudio","currentTrack","Audio","handleEvent","nextTrackId","openAudioPlayer","parseMessageKey","nextTrack","safePlay","Proxy","createAudio","preload","IS_SAFARI","time","shouldRemoveFromQueue","track","h","filename","link","click","shouldSpinnerRender","getColorFromExtension","sizeString","getFileSizeString","mul_table","shg_table","boxBlurCanvasRGB","context","top_x","top_y","iterations","isNaN","imageData","getImageData","pixels","rsum","gsum","bsum","p","p1","p2","yp","yi","yw","wm","hm","rad1","r","g","b","mul_sum","shg_sum","vmin","vmax","putImageData","onDismiss","setIsOpen","timerRef","closeAndDismiss","handleMouseEnter","handleMouseLeave","onMouseEnter","onMouseLeave","isSelectionInsideInput","selectionRange","parentNode","emojiDataPromise","emojiRawData","emojiData","RE_NOT_EMOJI_SEARCH","useEmojiTooltip","recentEmojiIds","onUpdateHtml","markIsOpen","unmarkIsOpen","emojiIds","setEmojiIds","filteredEmojis","setFilteredEmojis","recentEmojis","emojiId","emojis","uncompressEmoji","ensureEmojiData","tempEl","lastSymbol","lastWord","pop","test","toLowerCase","getEmojiCode","matched","names","find","insertEmoji","textEmoji","atIndex","lastIndexOf","messageInput","getElementById","isEmojiTooltipOpen","closeEmojiTooltip","EmojiTooltip","MAX_INPUT_HEIGHT","currentChatId","threadId","selectCurrentMessageList","messageSendKeyCombo","replyingToId","selectReplyingToId","noTabCapture","isPollModalOpen","payment","isPaymentModalOpen","editableInputId","shouldSetFocus","shouldSupressFocus","shouldSupressTextFormatter","onUpdate","onSupressedFocus","onSend","editLastMessage","cloneRef","isContextMenuOpenRef","isTextFormatterOpen","openTextFormatter","closeTextFormatter","textFormatterAnchorPosition","setTextFormatterAnchorPosition","setSelectedRange","updateInputHeight","useLayoutEffectWithPrevDeps","prevHtml","focusInput","handleCloseTextFormatter","empty","clearSelection","checkSelection","selectedText","parseEmojiOnlyString","START_TO_END","selectionRect","inputRect","willSend","clone","currentHeight","newHeight","transitionDuration","log","captureFirstTab","onTab","supressFocus","contentEditable","handleKeyUp","IS_ANDROID","closeContextMenuMouseListener","closeContextMenuKeyListener","handleMouseUp","onTouchCancel","useBlurSync","isChanged","blurredAsync","onMessageClick","linkData","getMessageWebPage","getFirstLinkInMessage","domain","messageText","getMessageSummaryText","siteName","handleMessageClick","displayUrl","truncatedDescription","trimText","data-initial","ChatAnimationTypes","isShown","renderContent","unreadMentionsCount","formatIntegerCompact","FolderTypeToListType","replyToMessageId","isOutgoing","lastMessageSender","lastMessageAction","getMessageAction","actionTargetMessage","selectChatMessage","targetUserId","actionTargetUserId","targetChatId","actionTargetChatId","privateChatUserId","messageListType","selectIsChatMuted","selectNotifySettings","selectNotifyExceptions","lastMessageOutgoingStatus","selectOutgoingStatus","actionTargetUser","draft","selectDraft","MAIN_THREAD_ID","orderDiff","animationType","openChat","focusLastMessage","isDeleteModalOpen","openDeleteModal","closeDeleteModal","isAction","isActionMessage","useEnsureMessage","mediaThumbnail","getMessageSticker","Opacity","opacity","Move","useChatContextActions","Avatar","LastMessageMeta","TypingStatus","actionOrigin","renderActionMessageText","asPlain","senderName","getMessageSenderName","blobUrl","renderMessageSummary","renderLastMessageOrTyping","DeleteChatModal","folderType","chats","byId","chatsById","orderedPinnedIds","users","usersById","currentThreadId","listType","chatFolder","selectChatFolder","isInDiscussionThread","notifySettings","notifyExceptions","noChatsText","loadMoreChats","preloadTopChatMessages","currentListIds","currentPinnedIds","prepareFolderListIds","orderById","orderedIds","newChatArrays","prepareChatList","singleList","pinnedChats","otherChats","newOrderedIds","prevOrderById","orderDiffById","mapValues","order","Infinity","loadMoreOfType","useInfiniteScroll","CHAT_LIST_SLICE","ALL_CHATS_PRELOAD_DISABLED","chatArrays","getAnimationType","movesUp","movesDown","orderDiffIds","numberOfUp","numberOfDown","None","useChatAnimationType","viewportOffset","pinnedOffset","CHAT_HEIGHT_PX","teactOrderKey","getChatOrder","renderChats","Loading","RE_NOT_USERNAME_SEARCH","useMentionTooltip","canSuggestMembers","groupChatMembers","currentUserId","currentFilter","setCurrentFilter","filteredMembers","setFilteredMembers","getFilteredMembers","usernameLowered","fullNameLowered","filterLowered","searchWords","searchUserName","usernameFilter","getUsernameFilter","membersToMention","insertMention","forceFocus","insertedHtml","isMentionTooltipOpen","mentionFilter","closeMentionTooltip","mentionFilteredMembers"],"mappings":"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K,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,GAAI,GAAI,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,GAAI,GAAI,IAAK,IAAK,GAAI,IAAK,IAAK,EAAG,GAAI,IAAK,GAAI,IAAK,IAAK,GAAI,GAAI,IAAK,GAAI,IAAK,GAAI,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,IAAK,GAAI,IAAK,IAAK,IAAK,GAAI,IAAK,GAAI,IAAK,GAE5qCC,EAAY,CAAC,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,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","file":"0.cbd51da518cc2862371d.js","sourcesContent":["import { ApiMediaFormat } from '../api/types';\n\nimport * as langProvider from '../util/langProvider';\nimport useForceUpdate from './useForceUpdate';\nimport useOnChange from './useOnChange';\n\nexport type LangFn = typeof langProvider.getTranslation;\n\nexport default <T extends ApiMediaFormat = ApiMediaFormat.BlobUrl>(): LangFn => {\n  const forceUpdate = useForceUpdate();\n\n  useOnChange(() => {\n    return langProvider.addCallback(forceUpdate);\n  }, [forceUpdate]);\n\n  return langProvider.getTranslation;\n};\n","import { RefObject } from 'react';\nimport React, { FC, useRef, useCallback } from '../../lib/teact/teact';\n\nimport { IS_TOUCH_ENV } from '../../util/environment';\nimport buildClassName from '../../util/buildClassName';\nimport useContextMenuHandlers from '../../hooks/useContextMenuHandlers';\nimport useContextMenuPosition from '../../hooks/useContextMenuPosition';\n\nimport RippleEffect from './RippleEffect';\nimport Menu from './Menu';\nimport MenuItem from './MenuItem';\n\nimport './ListItem.scss';\n\ntype OnClickHandler = (e: React.MouseEvent<HTMLDivElement>) => void;\n\ntype MenuItemContextAction = {\n  title: string;\n  icon: string;\n  destructive?: boolean;\n  handler?: () => void;\n};\n\ntype OwnProps = {\n  ref?: RefObject<HTMLDivElement>;\n  icon?: string;\n  className?: string;\n  style?: string;\n  children: any;\n  disabled?: boolean;\n  ripple?: boolean;\n  narrow?: boolean;\n  inactive?: boolean;\n  focus?: boolean;\n  destructive?: boolean;\n  multiline?: boolean;\n  isStatic?: boolean;\n  contextActions?: MenuItemContextAction[];\n  onClick?: OnClickHandler;\n};\n\nconst ListItem: FC<OwnProps> = (props) => {\n  const {\n    ref,\n    icon,\n    className,\n    style,\n    children,\n    disabled,\n    ripple,\n    narrow,\n    inactive,\n    focus,\n    destructive,\n    multiline,\n    isStatic,\n    contextActions,\n    onClick,\n  } = props;\n\n  // eslint-disable-next-line no-null/no-null\n  let containerRef = useRef<HTMLDivElement>(null);\n  if (ref) {\n    containerRef = ref;\n  }\n\n  const {\n    isContextMenuOpen, contextMenuPosition,\n    handleBeforeContextMenu, handleContextMenu,\n    handleContextMenuClose, handleContextMenuHide,\n  } = useContextMenuHandlers(containerRef, !contextActions);\n\n  const getTriggerElement = useCallback(() => containerRef.current, []);\n\n  const getRootElement = useCallback(\n    () => containerRef.current!.closest('.custom-scroll'),\n    [],\n  );\n\n  const getMenuElement = useCallback(\n    () => containerRef.current!.querySelector('.ListItem-context-menu .bubble'),\n    [],\n  );\n\n  const { positionX, positionY, style: menuStyle } = useContextMenuPosition(\n    contextMenuPosition,\n    getTriggerElement,\n    getRootElement,\n    getMenuElement,\n  );\n\n  const handleClick = useCallback((e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (disabled || !onClick) {\n      return;\n    }\n    onClick(e);\n  }, [disabled, onClick]);\n\n  const handleMouseDown = useCallback((e: React.MouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (inactive || IS_TOUCH_ENV) {\n      return;\n    }\n    if (contextActions && (e.button === 2 || !onClick)) {\n      handleBeforeContextMenu(e);\n    }\n    if (e.button === 0) {\n      if (!onClick) {\n        handleContextMenu(e);\n      } else {\n        handleClick(e);\n      }\n    }\n  }, [inactive, contextActions, onClick, handleBeforeContextMenu, handleContextMenu, handleClick]);\n\n  const fullClassName = buildClassName(\n    'ListItem',\n    className,\n    !isStatic && 'no-selection',\n    ripple && 'has-ripple',\n    narrow && 'narrow',\n    disabled && 'disabled',\n    inactive && 'inactive',\n    contextMenuPosition && 'has-menu-open',\n    focus && 'focus',\n    destructive && 'destructive',\n    multiline && 'multiline',\n    isStatic && 'is-static',\n  );\n\n  return (\n    <div\n      ref={containerRef}\n      className={fullClassName}\n      // @ts-ignore\n      style={style}\n    >\n      <div\n        className=\"ListItem-button\"\n        role=\"button\"\n        tabIndex={0}\n        onClick={!inactive && IS_TOUCH_ENV ? handleClick : undefined}\n        onMouseDown={handleMouseDown}\n        onContextMenu={!inactive && contextActions ? handleContextMenu : undefined}\n      >\n        {icon && (\n          <i className={`icon-${icon}`} />\n        )}\n        {multiline && (<div className=\"multiline-item\">{children}</div>)}\n        {!multiline && children}\n        {!disabled && !inactive && ripple && (\n          <RippleEffect />\n        )}\n      </div>\n      {contextActions && contextMenuPosition !== undefined && (\n        <Menu\n          isOpen={isContextMenuOpen}\n          positionX={positionX}\n          positionY={positionY}\n          style={menuStyle}\n          className=\"ListItem-context-menu\"\n          autoClose\n          onClose={handleContextMenuClose}\n          onCloseAnimationEnd={handleContextMenuHide}\n        >\n          {contextActions.map((action) => (\n            <MenuItem\n              key={action.title}\n              icon={action.icon}\n              destructive={action.destructive}\n              disabled={!action.handler}\n              onClick={action.handler}\n            >\n              {action.title}\n            </MenuItem>\n          ))}\n        </Menu>\n      )}\n    </div>\n  );\n};\n\nexport default ListItem;\n","import { RefObject } from 'react';\nimport {\n  useEffect, useRef, useCallback, useState,\n} from '../lib/teact/teact';\n\nimport { throttle, debounce } from '../util/schedulers';\nimport useHeavyAnimationCheck from './useHeavyAnimationCheck';\n\ntype TargetCallback = (entry: IntersectionObserverEntry) => void;\ntype RootCallback = (entries: IntersectionObserverEntry[]) => void;\ntype ObserveCleanup = NoneToVoidFunction;\nexport type ObserveFn = (target: HTMLElement, targetCallback?: TargetCallback) => ObserveCleanup;\n\ninterface IntersectionController {\n  observer: IntersectionObserver;\n  callbacks: Map<HTMLElement, TargetCallback>;\n}\n\ninterface Response {\n  observe: ObserveFn;\n  freeze: NoneToVoidFunction;\n  unfreeze: NoneToVoidFunction;\n}\n\nexport function useIntersectionObserver({\n  rootRef,\n  throttleMs,\n  debounceMs,\n  shouldSkipFirst,\n  margin,\n  threshold,\n  isDisabled,\n}: {\n  rootRef: RefObject<HTMLDivElement>;\n  throttleMs?: number;\n  debounceMs?: number;\n  shouldSkipFirst?: boolean;\n  margin?: number;\n  threshold?: number | number[];\n  isDisabled?: boolean;\n}, rootCallback?: RootCallback): Response {\n  const controllerRef = useRef<IntersectionController>();\n  const rootCallbackRef = useRef<RootCallback>();\n  const isFrozenRef = useRef<boolean>();\n  const onUnfreezeRef = useRef<NoneToVoidFunction>();\n\n  rootCallbackRef.current = rootCallback;\n\n  const freeze = useCallback(() => {\n    isFrozenRef.current = true;\n  }, []);\n\n  const unfreeze = useCallback(() => {\n    isFrozenRef.current = false;\n\n    if (onUnfreezeRef.current) {\n      onUnfreezeRef.current();\n      onUnfreezeRef.current = undefined;\n    }\n  }, []);\n\n  useHeavyAnimationCheck(freeze, unfreeze);\n\n  useEffect(() => {\n    if (isDisabled) {\n      return undefined;\n    }\n\n    return () => {\n      if (controllerRef.current) {\n        controllerRef.current.observer.disconnect();\n        controllerRef.current.callbacks.clear();\n        controllerRef.current = undefined;\n      }\n    };\n  }, [isDisabled]);\n\n  function initController() {\n    const callbacks = new Map();\n    const entriesAccumulator = new Map<Element, IntersectionObserverEntry>();\n    const observerCallbackSync = () => {\n      const entries = Array.from(entriesAccumulator.values());\n\n      entries.forEach((entry: IntersectionObserverEntry) => {\n        const callback = callbacks.get(entry.target);\n        if (callback) {\n          callback!(entry, entries);\n        }\n      });\n\n      if (rootCallbackRef.current) {\n        rootCallbackRef.current(entries);\n      }\n\n      entriesAccumulator.clear();\n    };\n    const scheduler = throttleMs ? throttle : debounceMs ? debounce : undefined;\n    const observerCallback = scheduler\n      ? scheduler(observerCallbackSync, (throttleMs || debounceMs)!, !shouldSkipFirst)\n      : observerCallbackSync;\n    const observer = new IntersectionObserver(\n      (entries) => {\n        entries.forEach((entry) => {\n          entriesAccumulator.set(entry.target, entry);\n        });\n\n        if (isFrozenRef.current) {\n          onUnfreezeRef.current = () => {\n            observerCallback();\n          };\n        } else {\n          observerCallback();\n        }\n      },\n      {\n        root: rootRef.current,\n        rootMargin: margin ? `${margin}px` : undefined,\n        threshold,\n      },\n    );\n\n    controllerRef.current = { observer, callbacks };\n  }\n\n  const observe = useCallback((target, targetCallback) => {\n    if (!controllerRef.current) {\n      initController();\n    }\n\n    const controller = controllerRef.current!;\n    controller.observer.observe(target);\n\n    if (targetCallback) {\n      controller.callbacks.set(target, targetCallback);\n    }\n\n    return () => {\n      if (targetCallback) {\n        controller.callbacks.delete(target);\n      }\n\n      controller.observer.unobserve(target);\n    };\n    // Arguments should never change\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isDisabled]);\n\n  return { observe, freeze, unfreeze };\n}\n\nexport function useOnIntersect(\n  targetRef: RefObject<HTMLDivElement>, observe?: ObserveFn, callback?: TargetCallback,\n) {\n  useEffect(() => {\n    return observe ? observe(targetRef.current!, callback) : undefined;\n    // Arguments should never change\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n}\n\nexport function useIsIntersecting(\n  targetRef: RefObject<HTMLDivElement>, observe?: ObserveFn, callback?: TargetCallback,\n) {\n  const [isIntersecting, setIsIntersecting] = useState(!observe);\n\n  useOnIntersect(targetRef, observe, (entry) => {\n    setIsIntersecting(entry.isIntersecting);\n\n    if (callback) {\n      callback(entry);\n    }\n  });\n\n  return isIntersecting;\n}\n","import { useEffect } from '../lib/teact/teact';\n\nimport { ApiMediaFormat } from '../api/types';\n\nimport * as mediaLoader from '../util/mediaLoader';\nimport useForceUpdate from './useForceUpdate';\n\nexport default <T extends ApiMediaFormat = ApiMediaFormat.BlobUrl>(\n  mediaHash: string | false | undefined,\n  noLoad = false,\n  // @ts-ignore (workaround for \"could be instantiated with a different subtype\" issue)\n  mediaFormat: T = ApiMediaFormat.BlobUrl,\n  cacheBuster?: number,\n  delay?: number | false,\n) => {\n  const mediaData = mediaHash ? mediaLoader.getFromMemory<T>(mediaHash) : undefined;\n  const forceUpdate = useForceUpdate();\n\n  useEffect(() => {\n    if (!noLoad && mediaHash && !mediaData) {\n      const startedAt = Date.now();\n\n      mediaLoader.fetch(mediaHash, mediaFormat).then(() => {\n        const spentTime = Date.now() - startedAt;\n        if (!delay || spentTime >= delay) {\n          forceUpdate();\n        } else {\n          setTimeout(forceUpdate, delay - spentTime);\n        }\n      });\n    }\n  }, [noLoad, mediaHash, mediaData, mediaFormat, cacheBuster, forceUpdate, delay]);\n\n  return mediaData;\n};\n","import { MouseEvent as ReactMouseEvent } from 'react';\nimport React, {\n  FC, useEffect, useCallback, memo,\n} from '../../lib/teact/teact';\nimport { withGlobal } from '../../lib/teact/teactn';\n\nimport { ApiUser, ApiTypingStatus } from '../../api/types';\nimport { GlobalActions, GlobalState } from '../../global/types';\nimport { MediaViewerOrigin } from '../../types';\n\nimport { selectChatMessages, selectUser } from '../../modules/selectors';\nimport { getUserFullName, getUserStatus, isUserOnline } from '../../modules/helpers';\nimport renderText from './helpers/renderText';\nimport { pick } from '../../util/iteratees';\nimport useLang from '../../hooks/useLang';\n\nimport Avatar from './Avatar';\nimport VerifiedIcon from './VerifiedIcon';\nimport TypingStatus from './TypingStatus';\n\ntype OwnProps = {\n  userId: number;\n  typingStatus?: ApiTypingStatus;\n  avatarSize?: 'tiny' | 'small' | 'medium' | 'large' | 'jumbo';\n  forceShowSelf?: boolean;\n  status?: string;\n  withMediaViewer?: boolean;\n  withUsername?: boolean;\n  withFullInfo?: boolean;\n  withUpdatingStatus?: boolean;\n  noStatusOrTyping?: boolean;\n};\n\ntype StateProps = {\n  user?: ApiUser;\n  isSavedMessages?: boolean;\n  areMessagesLoaded: boolean;\n} & Pick<GlobalState, 'lastSyncTime'>;\n\ntype DispatchProps = Pick<GlobalActions, 'loadFullUser' | 'openMediaViewer'>;\n\nconst PrivateChatInfo: FC<OwnProps & StateProps & DispatchProps> = ({\n  typingStatus,\n  avatarSize = 'medium',\n  status,\n  withMediaViewer,\n  withUsername,\n  withFullInfo,\n  withUpdatingStatus,\n  noStatusOrTyping,\n  user,\n  isSavedMessages,\n  areMessagesLoaded,\n  lastSyncTime,\n  loadFullUser,\n  openMediaViewer,\n}) => {\n  const { id: userId } = user || {};\n  const fullName = getUserFullName(user);\n\n  useEffect(() => {\n    if (withFullInfo && lastSyncTime && userId) {\n      loadFullUser({ userId });\n    }\n  }, [userId, loadFullUser, lastSyncTime, withFullInfo]);\n\n  const handleAvatarViewerOpen = useCallback((e: ReactMouseEvent<HTMLDivElement, MouseEvent>, hasPhoto: boolean) => {\n    if (user && hasPhoto) {\n      e.stopPropagation();\n      openMediaViewer({\n        avatarOwnerId: user.id,\n        origin: avatarSize === 'jumbo' ? MediaViewerOrigin.ProfileAvatar : MediaViewerOrigin.MiddleHeaderAvatar,\n      });\n    }\n  }, [user, avatarSize, openMediaViewer]);\n\n  const lang = useLang();\n\n  if (!user) {\n    return undefined;\n  }\n\n  function renderStatusOrTyping() {\n    if (status) {\n      return (\n        <span className=\"status\">{status}</span>\n      );\n    }\n\n    if (withUpdatingStatus && !areMessagesLoaded) {\n      return (\n        <span className=\"status\">{lang('Updating')}</span>\n      );\n    }\n\n    if (!user) {\n      return undefined;\n    }\n\n    if (typingStatus) {\n      return <TypingStatus typingStatus={typingStatus} />;\n    }\n\n    return (\n      <div className={`status ${isUserOnline(user) ? 'online' : ''}`}>\n        {withUsername && user.username && <span className=\"handle\">{user.username}</span>}\n        <span className=\"user-status\">{getUserStatus(user, lang)}</span>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"ChatInfo\">\n      <Avatar\n        key={user.id}\n        size={avatarSize}\n        user={user}\n        isSavedMessages={isSavedMessages}\n        onClick={withMediaViewer ? handleAvatarViewerOpen : undefined}\n      />\n      <div className=\"info\">\n        {isSavedMessages ? (\n          <div className=\"title\">\n            <h3>{lang('SavedMessages')}</h3>\n          </div>\n        ) : (\n          <div className=\"title\">\n            <h3>{fullName && renderText(fullName)}</h3>\n            {user && user.isVerified && <VerifiedIcon />}\n          </div>\n        )}\n        {(status || (!isSavedMessages && !noStatusOrTyping)) && renderStatusOrTyping()}\n      </div>\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { userId, forceShowSelf }): StateProps => {\n    const { lastSyncTime } = global;\n    const user = selectUser(global, userId);\n    const isSavedMessages = !forceShowSelf && user && user.isSelf;\n    const areMessagesLoaded = Boolean(selectChatMessages(global, userId));\n\n    return {\n      lastSyncTime, user, isSavedMessages, areMessagesLoaded,\n    };\n  },\n  (setGlobal, actions): DispatchProps => pick(actions, ['loadFullUser', 'openMediaViewer']),\n)(PrivateChatInfo));\n","import React, { FC, useEffect, useRef } from '../../lib/teact/teact';\n\nimport captureKeyboardListeners from '../../util/captureKeyboardListeners';\nimport trapFocus from '../../util/trapFocus';\nimport buildClassName from '../../util/buildClassName';\nimport { dispatchHeavyAnimationEvent } from '../../hooks/useHeavyAnimationCheck';\nimport useShowTransition from '../../hooks/useShowTransition';\nimport useEffectWithPrevDeps from '../../hooks/useEffectWithPrevDeps';\nimport useLang from '../../hooks/useLang';\n\nimport Button from './Button';\nimport Portal from './Portal';\n\nimport './Modal.scss';\n\nconst ANIMATION_DURATION = 200;\n\ntype OwnProps = {\n  title?: string;\n  className?: string;\n  isOpen?: boolean;\n  header?: FC;\n  hasCloseButton?: boolean;\n  noBackdrop?: boolean;\n  children: any;\n  onClose: () => void;\n  onCloseAnimationEnd?: () => void;\n  onEnter?: () => void;\n};\n\nconst Modal: FC<OwnProps> = (props) => {\n  const {\n    title,\n    className,\n    isOpen,\n    header,\n    hasCloseButton,\n    noBackdrop,\n    children,\n    onClose,\n    onCloseAnimationEnd,\n    onEnter,\n  } = props;\n  const { shouldRender, transitionClassNames } = useShowTransition(isOpen, onCloseAnimationEnd);\n  // eslint-disable-next-line no-null/no-null\n  const modalRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => (isOpen\n    ? captureKeyboardListeners({ onEsc: onClose, onEnter })\n    : undefined), [isOpen, onClose, onEnter]);\n  useEffect(() => (isOpen && modalRef.current ? trapFocus(modalRef.current) : undefined), [isOpen]);\n\n  useEffectWithPrevDeps(([prevIsOpen]) => {\n    document.body.classList.toggle('has-open-dialog', isOpen);\n\n    if (isOpen || (!isOpen && prevIsOpen !== undefined)) {\n      dispatchHeavyAnimationEvent(ANIMATION_DURATION);\n    }\n\n    return () => {\n      document.body.classList.remove('has-open-dialog');\n    };\n  }, [isOpen]);\n\n  const lang = useLang();\n\n  if (!shouldRender) {\n    return undefined;\n  }\n\n  function renderHeader() {\n    if (header) {\n      return header;\n    }\n\n    if (!title) {\n      return undefined;\n    }\n\n    return (\n      <div className=\"modal-header\">\n        {hasCloseButton && (\n          <Button\n            round\n            color=\"translucent\"\n            size=\"smaller\"\n            ariaLabel={lang('Close')}\n            onClick={onClose}\n          >\n            <i className=\"icon-close\" />\n          </Button>\n        )}\n        <div className=\"modal-title\">{title}</div>\n      </div>\n    );\n  }\n\n  const fullClassName = buildClassName(\n    'Modal',\n    className,\n    transitionClassNames,\n    noBackdrop && 'transparent-backdrop',\n  );\n\n  return (\n    <Portal>\n      <div\n        ref={modalRef}\n        className={fullClassName}\n        tabIndex={-1}\n        role=\"dialog\"\n      >\n        <div className=\"modal-container\">\n          <div className=\"modal-backdrop\" onClick={onClose} />\n          <div className=\"modal-dialog\">\n            {renderHeader()}\n            <div className=\"modal-content custom-scroll\">\n              {children}\n            </div>\n          </div>\n        </div>\n      </div>\n    </Portal>\n  );\n};\n\nexport default Modal;\n","export default function trapFocus(element: HTMLElement) {\n  function handleKeyDown(e: KeyboardEvent) {\n    if (e.key !== 'Tab') {\n      return;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n\n    const focusableElements = Array.from(\n      element.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'),\n    ) as HTMLElement[];\n    if (!focusableElements.length) {\n      return;\n    }\n\n    const currentFocusedIndex = focusableElements.findIndex((em) => em.isSameNode(document.activeElement));\n    let newFocusedIndex = 0;\n    if (currentFocusedIndex >= 0) {\n      if (e.shiftKey) {\n        newFocusedIndex = currentFocusedIndex > 0\n          ? currentFocusedIndex - 1\n          : focusableElements.length - 1;\n      } else {\n        newFocusedIndex = currentFocusedIndex < focusableElements.length - 1\n          ? currentFocusedIndex + 1\n          : 0;\n      }\n    }\n\n    focusableElements[newFocusedIndex].focus();\n  }\n\n  document.addEventListener('keydown', handleKeyDown, false);\n\n  return () => {\n    document.removeEventListener('keydown', handleKeyDown, false);\n  };\n}\n","import { RefObject } from 'react';\nimport React, {\n  FC, useLayoutEffect, useRef,\n} from '../../lib/teact/teact';\nimport { withGlobal } from '../../lib/teact/teactn';\n\nimport { ANIMATION_END_DELAY } from '../../config';\nimport { IS_MOBILE_SCREEN } from '../../util/environment';\nimport useForceUpdate from '../../hooks/useForceUpdate';\nimport usePrevious from '../../hooks/usePrevious';\nimport buildClassName from '../../util/buildClassName';\nimport { dispatchHeavyAnimationEvent } from '../../hooks/useHeavyAnimationCheck';\n\nimport './Transition.scss';\n\ntype ChildrenFn = (isActive: boolean, isFrom: boolean) => any;\ntype OwnProps = {\n  ref?: RefObject<HTMLDivElement>;\n  activeKey: number;\n  name: (\n    'none' | 'slide' | 'mv-slide' | 'slide-fade' | 'zoom-fade' | 'scroll-slide' | 'fade' | 'slide-layers'\n    | 'push-slide' | 'reveal'\n  );\n  direction?: 'auto' | 'inverse' | 1 | -1;\n  renderCount?: number;\n  shouldRestoreHeight?: boolean;\n  shouldCleanup?: boolean;\n  id?: string;\n  className?: string;\n  onStart?: () => void;\n  onStop?: () => void;\n  children: ChildrenFn;\n};\n\ntype StateProps = {\n  animationLevel: number;\n};\n\nconst ANIMATION_DURATION = {\n  slide: 450,\n  'mv-slide': 400,\n  'slide-fade': 400,\n  'zoom-fade': 150,\n  'scroll-slide': 500,\n  fade: 150,\n  'slide-layers': IS_MOBILE_SCREEN ? 450 : 300,\n  'push-slide': 300,\n  reveal: 350,\n};\n\nconst CLEANED_UP = Symbol('CLEANED_UP');\n\nconst Transition: FC<OwnProps & StateProps> = ({\n  ref,\n  activeKey,\n  name,\n  direction = 'auto',\n  renderCount,\n  shouldRestoreHeight,\n  shouldCleanup,\n  id,\n  className,\n  onStart,\n  onStop,\n  children,\n  animationLevel,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  let containerRef = useRef<HTMLDivElement>(null);\n  if (ref) {\n    containerRef = ref;\n  }\n\n  const rendersRef = useRef<Record<number, ChildrenFn | typeof CLEANED_UP>>({});\n  const prevActiveKey = usePrevious<any>(activeKey);\n  const activateTimeoutRef = useRef<number>();\n  const forceUpdate = useForceUpdate();\n\n  const activeKeyChanged = prevActiveKey !== undefined && activeKey !== prevActiveKey;\n\n  if (!renderCount && activeKeyChanged) {\n    rendersRef.current = { [prevActiveKey]: rendersRef.current[prevActiveKey] };\n  }\n\n  rendersRef.current[activeKey] = children;\n\n  useLayoutEffect(() => {\n    function cleanup() {\n      if (!shouldCleanup) {\n        return;\n      }\n\n      rendersRef.current = { [prevActiveKey]: CLEANED_UP };\n      forceUpdate();\n    }\n\n    const container = containerRef.current!;\n\n    const childElements = container.children;\n    if (childElements.length === 1 && !activeKeyChanged) {\n      childElements[0].classList.add('active');\n\n      return;\n    }\n\n    const childNodes = Array.from(container.childNodes);\n\n    if (!activeKeyChanged || !childNodes.length) {\n      return;\n    }\n\n    if (activateTimeoutRef.current) {\n      clearTimeout(activateTimeoutRef.current);\n      activateTimeoutRef.current = undefined;\n    }\n\n    const isBackwards = (\n      direction === -1\n      || (direction === 'auto' && prevActiveKey > activeKey)\n      || (direction === 'inverse' && prevActiveKey < activeKey)\n    );\n\n    container.classList.remove('animating');\n    container.classList.toggle('backwards', isBackwards);\n\n    const keys = Object.keys(rendersRef.current).map(Number);\n    const prevActiveIndex = renderCount ? prevActiveKey : keys.indexOf(prevActiveKey);\n    const activeIndex = renderCount ? activeKey : keys.indexOf(activeKey);\n\n    if (name === 'none' || animationLevel === 0) {\n      childNodes.forEach((node, i) => {\n        if (node instanceof HTMLElement) {\n          node.classList.remove('from', 'through', 'to');\n          node.classList.toggle('active', i === activeIndex);\n        }\n      });\n\n      cleanup();\n\n      return;\n    }\n\n    childNodes.forEach((node, i) => {\n      if (node instanceof HTMLElement) {\n        node.classList.remove('active');\n        node.classList.toggle('from', i === prevActiveIndex);\n        node.classList.toggle('through', (\n          (i > prevActiveIndex && i < activeIndex) || (i < prevActiveIndex && i > activeIndex)\n        ));\n        node.classList.toggle('to', i === activeIndex);\n      }\n    });\n\n    if (name === 'scroll-slide') {\n      const width = container.offsetWidth;\n      container.scrollBy({\n        left: activeIndex > prevActiveIndex ? width : -width,\n        behavior: 'smooth',\n      });\n    }\n\n    if (animationLevel > 0) {\n      dispatchHeavyAnimationEvent(ANIMATION_DURATION[name] + ANIMATION_END_DELAY);\n    }\n\n    requestAnimationFrame(() => {\n      container.classList.add('animating');\n\n      activateTimeoutRef.current = window.setTimeout(() => {\n        requestAnimationFrame(() => {\n          container.classList.remove('animating', 'backwards');\n\n          childNodes.forEach((node, i) => {\n            if (node instanceof HTMLElement) {\n              node.classList.remove('from', 'through', 'to');\n              node.classList.toggle('active', i === activeIndex);\n            }\n          });\n\n          if (name === 'scroll-slide') {\n            container.scrollLeft = activeKey * container.offsetWidth;\n          }\n\n          if (shouldRestoreHeight) {\n            const activeElement = container.querySelector<HTMLDivElement>('.active');\n\n            if (activeElement) {\n              activeElement.style.height = 'auto';\n              container.style.height = `${activeElement.clientHeight}px`;\n            }\n          }\n\n          cleanup();\n\n          if (onStop) {\n            onStop();\n          }\n        });\n      }, ANIMATION_DURATION[name] + ANIMATION_END_DELAY);\n\n      if (onStart) {\n        onStart();\n      }\n    });\n  }, [\n    activeKey,\n    prevActiveKey,\n    activeKeyChanged,\n    direction,\n    name,\n    onStart,\n    onStop,\n    renderCount,\n    shouldRestoreHeight,\n    shouldCleanup,\n    animationLevel,\n    forceUpdate,\n  ]);\n\n  useLayoutEffect(() => {\n    if (shouldRestoreHeight) {\n      const container = containerRef.current!;\n      const activeElement = container.querySelector<HTMLDivElement>('.active')\n        || container.querySelector<HTMLDivElement>('.from');\n\n      if (activeElement) {\n        activeElement.style.height = 'auto';\n        container.style.height = `${activeElement.clientHeight}px`;\n        container.style.flexBasis = `${activeElement.clientHeight}px`;\n      }\n    }\n  }, [shouldRestoreHeight, children]);\n\n  const renders = rendersRef.current;\n  const collection = Object.keys(renderCount ? new Array(renderCount).fill(undefined) : renders).map(Number);\n  const contents = collection.map((key) => {\n    const render = renders[key];\n\n    return (\n      typeof render === 'function' ? <div key={key}>{render(key === activeKey, key === prevActiveKey)}</div> : undefined\n    );\n  });\n\n  const fullClassName = buildClassName(\n    'Transition',\n    className,\n    animationLevel === 0 && name === 'scroll-slide' ? 'slide' : name,\n  );\n\n  return (\n    <div ref={containerRef} id={id} className={fullClassName}>\n      {contents}\n    </div>\n  );\n};\n\nexport default withGlobal<OwnProps>((global) => {\n  const { animationLevel } = global.settings.byKey;\n  return { animationLevel };\n})(Transition);\n","import { MouseEvent as ReactMouseEvent } from 'react';\nimport React, { FC, useCallback, memo } from '../../lib/teact/teact';\n\nimport { ApiUser, ApiChat, ApiMediaFormat } from '../../api/types';\n\nimport { IS_TEST } from '../../config';\nimport {\n  getChatAvatarHash, getChatTitle, isChatPrivate,\n  getUserFullName, isUserOnline, isDeletedUser, getUserColorKey,\n} from '../../modules/helpers';\nimport { getFirstLetters } from '../../util/textFormat';\nimport buildClassName from '../../util/buildClassName';\nimport renderText from './helpers/renderText';\nimport useMedia from '../../hooks/useMedia';\nimport useTransitionForMedia from '../../hooks/useTransitionForMedia';\nimport useLang from '../../hooks/useLang';\n\nimport './Avatar.scss';\n\ntype OwnProps = {\n  className?: string;\n  size?: 'micro' | 'tiny' | 'small' | 'medium' | 'large' | 'jumbo';\n  withOnlineStatus?: boolean;\n  chat?: ApiChat;\n  user?: ApiUser;\n  text?: string;\n  isSavedMessages?: boolean;\n  lastSyncTime?: number;\n  onClick?: (e: ReactMouseEvent<HTMLDivElement, MouseEvent>, hasPhoto: boolean) => void;\n};\n\nconst Avatar: FC<OwnProps> = ({\n  className,\n  size = 'large',\n  chat,\n  user,\n  text,\n  withOnlineStatus,\n  isSavedMessages,\n  lastSyncTime,\n  onClick,\n}) => {\n  const isDeleted = user && isDeletedUser(user);\n  let imageHash: string | undefined;\n\n  if (!isSavedMessages && !isDeleted) {\n    if (user) {\n      imageHash = getChatAvatarHash(user);\n    } else if (chat) {\n      imageHash = getChatAvatarHash(chat);\n    }\n  }\n\n  const dataUri = useMedia(imageHash, false, ApiMediaFormat.DataUri, lastSyncTime);\n  const { shouldRenderFullMedia, transitionClassNames } = useTransitionForMedia(dataUri, 'slow');\n\n  useLang();\n\n  let content: string | undefined = '';\n\n  if (isSavedMessages) {\n    content = <i className=\"icon-avatar-saved-messages\" />;\n  } else if (isDeleted) {\n    content = <i className=\"icon-avatar-deleted-account\" />;\n  } else if (shouldRenderFullMedia) {\n    content = <img src={dataUri} className={`${transitionClassNames} avatar-media`} alt=\"\" decoding=\"async\" />;\n  } else if (user) {\n    const userFullName = getUserFullName(user);\n    content = userFullName ? getFirstLetters(userFullName, 2) : undefined;\n  } else if (chat) {\n    const title = getChatTitle(chat);\n    content = title && getFirstLetters(title, isChatPrivate(chat.id) ? 2 : 1);\n  } else if (text) {\n    content = getFirstLetters(text, 2);\n  }\n\n  const isOnline = !isSavedMessages && user && isUserOnline(user);\n  const fullClassName = buildClassName(\n    `Avatar size-${size}`,\n    className,\n    `color-bg-${getUserColorKey(user || chat)}`,\n    isSavedMessages && 'saved-messages',\n    isDeleted && 'deleted-account',\n    withOnlineStatus && isOnline && 'online',\n    onClick && 'interactive',\n    (!isSavedMessages && !shouldRenderFullMedia) && 'no-photo',\n  );\n\n  const handleClick = useCallback((e: ReactMouseEvent<HTMLDivElement, MouseEvent>) => {\n    if (onClick) {\n      onClick(e, isSavedMessages || shouldRenderFullMedia);\n    }\n  }, [onClick, isSavedMessages, shouldRenderFullMedia]);\n\n  const senderId = (user || chat) && (user || chat)!.id;\n\n  return (\n    <div className={fullClassName} onClick={handleClick} data-test-sender-id={IS_TEST ? senderId : undefined}>\n      {typeof content === 'string' ? renderText(content, [size === 'jumbo' ? 'hq_emoji' : 'emoji']) : content}\n    </div>\n  );\n};\n\nexport default memo(Avatar);\n","import { RefObject, UIEvent } from 'react';\nimport { LoadMoreDirection } from '../../types';\n\nimport React, {\n  FC, useCallback, useEffect, useLayoutEffect, useMemo, useRef,\n} from '../../lib/teact/teact';\n\nimport { debounce } from '../../util/schedulers';\nimport resetScroll from '../../util/resetScroll';\n\ntype OwnProps = {\n  ref?: RefObject<HTMLDivElement>;\n  className?: string;\n  onLoadMore?: ({ direction }: { direction: LoadMoreDirection }) => void;\n  onScroll?: (e: UIEvent<HTMLDivElement>) => void;\n  items?: any[];\n  itemSelector?: string;\n  preloadBackwards?: number;\n  sensitiveArea?: number;\n  noScrollRestore?: boolean;\n  noScrollRestoreOnTop?: boolean;\n  noFastList?: boolean;\n  cacheBuster?: any;\n  children: any;\n};\n\nconst DEFAULT_LIST_SELECTOR = '.ListItem';\nconst DEFAULT_PRELOAD_BACKWARDS = 20;\nconst DEFAULT_SENSITIVE_AREA = 800;\n\nconst InfiniteScroll: FC<OwnProps> = ({\n  ref,\n  className,\n  onLoadMore,\n  onScroll,\n  items,\n  itemSelector = DEFAULT_LIST_SELECTOR,\n  preloadBackwards = DEFAULT_PRELOAD_BACKWARDS,\n  sensitiveArea = DEFAULT_SENSITIVE_AREA,\n  // Used to turn off restoring scroll position (e.g. for frequently re-ordered chat or user lists)\n  noScrollRestore = false,\n  noScrollRestoreOnTop = false,\n  noFastList,\n  // Used to re-query `listItemElements` if rendering is delayed by transition\n  cacheBuster,\n  children,\n}: OwnProps) => {\n  // eslint-disable-next-line no-null/no-null\n  let containerRef = useRef<HTMLDivElement>(null);\n  if (ref) {\n    containerRef = ref;\n  }\n\n  const stateRef = useRef<{\n    listItemElements: NodeListOf<HTMLDivElement>;\n    isScrollTopJustUpdated: boolean;\n    currentAnchor: HTMLDivElement | undefined;\n    currentAnchorTop: number;\n  }>({} as any);\n\n  const [loadMoreBackwards, loadMoreForwards] = useMemo(() => {\n    if (!onLoadMore) {\n      return [];\n    }\n\n    return [\n      debounce(() => onLoadMore({ direction: LoadMoreDirection.Backwards }), 1000, true, false),\n      debounce(() => onLoadMore({ direction: LoadMoreDirection.Forwards }), 1000, true, false),\n    ];\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [onLoadMore, items]);\n\n  // Initial preload\n  useEffect(() => {\n    if (!loadMoreBackwards) {\n      return;\n    }\n\n    if (preloadBackwards > 0 && (!items || items.length < preloadBackwards)) {\n      loadMoreBackwards();\n      return;\n    }\n\n    const { scrollHeight, clientHeight } = containerRef.current!;\n    if (clientHeight && scrollHeight <= clientHeight) {\n      loadMoreBackwards();\n    }\n  }, [items, loadMoreBackwards, preloadBackwards]);\n\n  // Restore `scrollTop` after adding items\n  useLayoutEffect(() => {\n    const container = containerRef.current!;\n    const state = stateRef.current;\n\n    state.listItemElements = container.querySelectorAll<HTMLDivElement>(itemSelector);\n\n    let newScrollTop;\n\n    if (state.currentAnchor && Array.from(state.listItemElements).includes(state.currentAnchor)) {\n      const { scrollTop } = container;\n      const newAnchorTop = state.currentAnchor.getBoundingClientRect().top;\n      newScrollTop = scrollTop + (newAnchorTop - state.currentAnchorTop);\n    } else {\n      const nextAnchor = state.listItemElements[0];\n      if (nextAnchor) {\n        state.currentAnchor = nextAnchor;\n        state.currentAnchorTop = nextAnchor.getBoundingClientRect().top;\n      }\n    }\n\n    if (noScrollRestore) {\n      return;\n    }\n\n    if (noScrollRestoreOnTop && container.scrollTop === 0) {\n      return;\n    }\n\n    resetScroll(container, newScrollTop);\n\n    state.isScrollTopJustUpdated = true;\n  }, [items, itemSelector, noScrollRestore, noScrollRestoreOnTop, cacheBuster]);\n\n  const handleScroll = useCallback((e: UIEvent<HTMLDivElement>) => {\n    if (loadMoreForwards && loadMoreBackwards) {\n      const {\n        listItemElements, isScrollTopJustUpdated, currentAnchor, currentAnchorTop,\n      } = stateRef.current;\n\n      if (isScrollTopJustUpdated) {\n        stateRef.current.isScrollTopJustUpdated = false;\n        return;\n      }\n\n      const listLength = listItemElements.length;\n      const container = containerRef.current!;\n      const { scrollTop, scrollHeight, offsetHeight } = container;\n      const top = listLength ? listItemElements[0].offsetTop : 0;\n      const isNearTop = scrollTop <= top + sensitiveArea;\n      const bottom = listLength\n        ? listItemElements[listLength - 1].offsetTop + listItemElements[listLength - 1].offsetHeight\n        : scrollHeight;\n      const isNearBottom = bottom - (scrollTop + offsetHeight) <= sensitiveArea;\n      let isUpdated = false;\n\n      if (isNearTop) {\n        const nextAnchor = listItemElements[0];\n        if (nextAnchor) {\n          const nextAnchorTop = nextAnchor.getBoundingClientRect().top;\n          const newAnchorTop = currentAnchor && currentAnchor.offsetParent && currentAnchor !== nextAnchor\n            ? currentAnchor.getBoundingClientRect().top\n            : nextAnchorTop;\n          const isMovingUp = (\n            currentAnchor && currentAnchorTop !== undefined && newAnchorTop > currentAnchorTop\n          );\n\n          if (isMovingUp) {\n            stateRef.current.currentAnchor = nextAnchor;\n            stateRef.current.currentAnchorTop = nextAnchorTop;\n            isUpdated = true;\n            resetScroll(container);\n            loadMoreForwards();\n          }\n        }\n      }\n\n      if (isNearBottom) {\n        const nextAnchor = listItemElements[listLength - 1];\n        if (nextAnchor) {\n          const nextAnchorTop = nextAnchor.getBoundingClientRect().top;\n          const newAnchorTop = currentAnchor && currentAnchor.offsetParent && currentAnchor !== nextAnchor\n            ? currentAnchor.getBoundingClientRect().top\n            : nextAnchorTop;\n          const isMovingDown = (\n            currentAnchor && currentAnchorTop !== undefined && newAnchorTop < currentAnchorTop\n          );\n\n          if (isMovingDown) {\n            stateRef.current.currentAnchor = nextAnchor;\n            stateRef.current.currentAnchorTop = nextAnchorTop;\n            isUpdated = true;\n            resetScroll(container);\n            loadMoreBackwards();\n          }\n        }\n      }\n\n      if (!isUpdated) {\n        if (currentAnchor && currentAnchor.offsetParent) {\n          stateRef.current.currentAnchorTop = currentAnchor.getBoundingClientRect().top;\n        } else {\n          const nextAnchor = listItemElements[0];\n\n          if (nextAnchor) {\n            stateRef.current.currentAnchor = nextAnchor;\n            stateRef.current.currentAnchorTop = nextAnchor.getBoundingClientRect().top;\n          }\n        }\n      }\n    }\n\n    if (onScroll) {\n      onScroll(e);\n    }\n  }, [loadMoreBackwards, loadMoreForwards, onScroll, sensitiveArea]);\n\n  return (\n    <div ref={containerRef} className={className} onScroll={handleScroll} teactFastList={!noFastList}>\n      {children}\n    </div>\n  );\n};\n\nexport default InfiniteScroll;\n","import usePrevious from './usePrevious';\n\nexport default <T extends any[], PT = T>(cb: (args: PT) => void, dependencies: T) => {\n  const prevDeps = usePrevious<T>(dependencies);\n  if (!prevDeps || dependencies.some((d, i) => d !== prevDeps[i])) {\n    // @ts-ignore (workaround for \"could be instantiated with a different subtype\" issue)\n    cb(prevDeps || []);\n  }\n};\n","import { useEffect, useRef, useState } from '../lib/teact/teact';\n\nimport useShowTransition from './useShowTransition';\n\nconst SPEED = {\n  fast: 200,\n  slow: 350,\n};\n\nexport default (mediaData?: any, speed: keyof typeof SPEED = 'fast', noAnimate = false) => {\n  const isMediaLoaded = Boolean(mediaData);\n  const willAnimate = !useRef(isMediaLoaded).current && !noAnimate;\n  const [shouldRenderThumb, setShouldRenderThumb] = useState(!isMediaLoaded);\n\n  const {\n    shouldRender: shouldRenderFullMedia,\n    transitionClassNames,\n  } = useShowTransition(isMediaLoaded, undefined, !willAnimate, speed);\n\n  useEffect(() => {\n    if (shouldRenderFullMedia) {\n      if (willAnimate) {\n        setTimeout(() => {\n          setShouldRenderThumb(false);\n        }, SPEED[speed]);\n      } else {\n        setShouldRenderThumb(false);\n      }\n    }\n  }, [willAnimate, shouldRenderFullMedia, speed]);\n\n  return {\n    shouldRenderThumb,\n    shouldRenderFullMedia,\n    transitionClassNames,\n  };\n};\n","import { ApiPhoto, ApiVideo, ApiSticker } from '../../../api/types';\nimport { getPhotoInlineDimensions, getVideoDimensions, IDimensions } from '../../../modules/helpers';\nimport windowSize from '../../../util/windowSize';\nimport { IS_MOBILE_SCREEN } from '../../../util/environment';\nimport { STICKER_SIZE_INLINE_DESKTOP_FACTOR, STICKER_SIZE_INLINE_MOBILE_FACTOR } from '../../../config';\n\nexport const MEDIA_VIEWER_MEDIA_QUERY = '(max-height: 640px)';\nexport const REM = parseInt(getComputedStyle(document.documentElement).fontSize, 10);\nexport const ROUND_VIDEO_DIMENSIONS = 200;\nexport const AVATAR_FULL_DIMENSIONS = { width: 640, height: 640 };\n\nconst DEFAULT_MEDIA_DIMENSIONS: IDimensions = { width: 100, height: 100 };\nconst LIKE_STICKER_ID = '1258816259753933';\nconst MOBILE_SCREEN_MAX_MESSAGE_SCREEN_WIDTH = 0.69;\n\nlet cachedMaxWidth: number | undefined;\n\nfunction getMaxMessageWidthRem(fromOwnMessage: boolean) {\n  const regularMaxWidth = fromOwnMessage ? 30 : 29;\n  if (!IS_MOBILE_SCREEN) {\n    return regularMaxWidth;\n  }\n\n  // @optimization Limitation: changing device screen width not supported\n  if (!cachedMaxWidth) {\n    cachedMaxWidth = Math.min(\n      regularMaxWidth,\n      Math.floor(window.innerWidth * MOBILE_SCREEN_MAX_MESSAGE_SCREEN_WIDTH) / REM,\n    );\n  }\n\n  return cachedMaxWidth;\n}\n\nfunction getAvailableWidth(\n  fromOwnMessage: boolean,\n  isForwarded?: boolean,\n  isWebPagePhoto?: boolean,\n) {\n  const extraPaddingRem = isForwarded || isWebPagePhoto ? 1.625 : 0;\n  const availableWidthRem = getMaxMessageWidthRem(fromOwnMessage) - extraPaddingRem;\n\n  return availableWidthRem * REM;\n}\n\nfunction getAvailableHeight(isGif?: boolean, aspectRatio?: number) {\n  if (\n    isGif && aspectRatio\n    && aspectRatio >= 0.75 && aspectRatio <= 1.25\n  ) {\n    return 20 * REM;\n  }\n\n  return 27 * REM;\n}\n\nfunction calculateDimensionsForMessageMedia({\n  width,\n  height,\n  fromOwnMessage,\n  isForwarded,\n  isWebPagePhoto,\n  isGif,\n}: {\n  width: number;\n  height: number;\n  fromOwnMessage: boolean;\n  isForwarded?: boolean;\n  isWebPagePhoto?: boolean;\n  isGif?: boolean;\n}): IDimensions {\n  const aspectRatio = height / width;\n  const availableWidth = getAvailableWidth(fromOwnMessage, isForwarded, isWebPagePhoto);\n  const availableHeight = getAvailableHeight(isGif, aspectRatio);\n\n  return calculateDimensions(availableWidth, availableHeight, width, height);\n}\n\nexport function getMediaViewerAvailableDimensions(withFooter: boolean, isVideo: boolean): IDimensions {\n  const mql = window.matchMedia(MEDIA_VIEWER_MEDIA_QUERY);\n  const { width: windowWidth, height: windowHeight } = windowSize.get();\n  let occupiedHeightRem = isVideo && mql.matches ? 10 : 8.25;\n  if (withFooter) {\n    occupiedHeightRem = mql.matches ? 10 : 15;\n  }\n\n  return {\n    width: windowWidth,\n    height: windowHeight - occupiedHeightRem * REM,\n  };\n}\n\nexport function calculateInlineImageDimensions(\n  photo: ApiPhoto,\n  fromOwnMessage: boolean,\n  isForwarded?: boolean,\n  isWebPagePhoto?: boolean,\n) {\n  const { width, height } = getPhotoInlineDimensions(photo) || DEFAULT_MEDIA_DIMENSIONS;\n\n  return calculateDimensionsForMessageMedia({\n    width,\n    height,\n    fromOwnMessage,\n    isForwarded,\n    isWebPagePhoto,\n  });\n}\n\nexport function calculateVideoDimensions(\n  video: ApiVideo,\n  fromOwnMessage: boolean,\n  isForwarded?: boolean,\n) {\n  const { width, height } = getVideoDimensions(video) || DEFAULT_MEDIA_DIMENSIONS;\n\n  return calculateDimensionsForMessageMedia({\n    width,\n    height,\n    fromOwnMessage,\n    isForwarded,\n    isGif: video.isGif,\n  });\n}\n\nexport function getPictogramDimensions(): IDimensions {\n  return {\n    width: 2 * REM,\n    height: 2 * REM,\n  };\n}\n\nexport function getDocumentThumbnailDimensions(smaller?: boolean): IDimensions {\n  if (smaller) {\n    return {\n      width: 3 * REM,\n      height: 3 * REM,\n    };\n  }\n\n  return {\n    width: 3.375 * REM,\n    height: 3.375 * REM,\n  };\n}\n\nexport function getStickerDimensions(sticker: ApiSticker): IDimensions {\n  const { width } = sticker;\n  let { height } = sticker;\n\n  // For some reason this sticker has some weird `height` value\n  if (sticker.id === LIKE_STICKER_ID) {\n    height = width;\n  }\n\n  const aspectRatio = (height && width) && height / width;\n  const baseWidth = (IS_MOBILE_SCREEN ? STICKER_SIZE_INLINE_MOBILE_FACTOR : STICKER_SIZE_INLINE_DESKTOP_FACTOR) * REM;\n  const calculatedHeight = aspectRatio ? baseWidth * aspectRatio : baseWidth;\n\n  if (aspectRatio && calculatedHeight > baseWidth) {\n    return {\n      width: Math.round(baseWidth / aspectRatio),\n      height: baseWidth,\n    };\n  }\n\n  return {\n    width: baseWidth,\n    height: calculatedHeight,\n  };\n}\n\nexport function calculateMediaViewerDimensions(\n  { width, height }: IDimensions, withFooter: boolean, isVideo: boolean = false,\n): IDimensions {\n  const { width: availableWidth, height: availableHeight } = getMediaViewerAvailableDimensions(withFooter, isVideo);\n\n  return calculateDimensions(availableWidth, availableHeight, width, height);\n}\n\nexport function calculateDimensions(\n  availableWidth: number,\n  availableHeight: number,\n  mediaWidth: number,\n  mediaHeight: number,\n): IDimensions {\n  const aspectRatio = mediaHeight / mediaWidth;\n  const calculatedWidth = Math.min(mediaWidth, availableWidth);\n  const calculatedHeight = Math.round(calculatedWidth * aspectRatio);\n\n  if (calculatedHeight > availableHeight) {\n    return {\n      width: Math.round(availableHeight / aspectRatio),\n      height: availableHeight,\n    };\n  }\n\n  return {\n    width: calculatedWidth,\n    height: Math.round(calculatedWidth * aspectRatio),\n  };\n}\n","import React, {\n  FC, useEffect, useRef, memo, useCallback, useState,\n} from '../../lib/teact/teact';\n\nimport { fastRaf } from '../../util/schedulers';\nimport buildClassName from '../../util/buildClassName';\nimport useHeavyAnimationCheck from '../../hooks/useHeavyAnimationCheck';\nimport useBackgroundMode from '../../hooks/useBackgroundMode';\n\ntype OwnProps = {\n  className?: string;\n  id: string;\n  animationData: AnyLiteral;\n  play?: boolean | string;\n  playSegment?: [number, number];\n  speed?: number;\n  noLoop?: boolean;\n  size: number;\n  quality?: number;\n  isLowPriority?: boolean;\n  onLoad?: NoneToVoidFunction;\n};\n\ntype RLottieClass = typeof import('../../lib/rlottie/RLottie').default;\ntype RLottieInstance = import('../../lib/rlottie/RLottie').default;\nlet lottiePromise: Promise<RLottieClass>;\nlet RLottie: RLottieClass;\n\n// Time supposed for judges to measure \"Transferred Size\" in Dev Tools\nconst LOTTIE_LOAD_DELAY = 5000;\n\nasync function ensureLottie() {\n  if (!lottiePromise) {\n    lottiePromise = import('../../lib/rlottie/RLottie') as unknown as Promise<RLottieClass>;\n    RLottie = (await lottiePromise as any).default;\n  }\n\n  return lottiePromise;\n}\n\nsetTimeout(ensureLottie, LOTTIE_LOAD_DELAY);\n\nconst AnimatedSticker: FC<OwnProps> = ({\n  className,\n  id,\n  animationData,\n  play,\n  playSegment,\n  speed,\n  noLoop,\n  size,\n  quality,\n  isLowPriority,\n  onLoad,\n}) => {\n  const [animation, setAnimation] = useState<RLottieInstance>();\n  // eslint-disable-next-line no-null/no-null\n  const container = useRef<HTMLDivElement>(null);\n  const wasPlaying = useRef(false);\n  const isFrozen = useRef(false);\n\n  const playRef = useRef();\n  playRef.current = play;\n  const playSegmentRef = useRef<[number, number]>();\n  playSegmentRef.current = playSegment;\n\n  useEffect(() => {\n    if (animation || !animationData) {\n      return;\n    }\n\n    const exec = () => {\n      if (!container.current) {\n        return;\n      }\n\n      const newAnimation = new RLottie(\n        id,\n        container.current,\n        animationData,\n        {\n          noLoop,\n          size,\n          quality,\n          isLowPriority,\n        },\n        onLoad,\n      );\n\n      if (speed) {\n        newAnimation.setSpeed(speed);\n      }\n\n      setAnimation(newAnimation);\n    };\n\n    if (RLottie) {\n      exec();\n    } else {\n      ensureLottie().then(() => {\n        fastRaf(() => {\n          if (container.current) {\n            exec();\n          }\n        });\n      });\n    }\n  }, [animation, animationData, id, isLowPriority, noLoop, onLoad, quality, size, speed]);\n\n  useEffect(() => {\n    return () => {\n      if (animation) {\n        animation.destroy();\n      }\n    };\n  }, [animation]);\n\n  const playAnimation = useCallback((shouldRestart = false) => {\n    if (animation && (playRef.current || playSegmentRef.current)) {\n      if (playSegmentRef.current) {\n        animation.playSegment(playSegmentRef.current);\n      } else if (shouldRestart) {\n        animation.goToAndPlay(0);\n      } else {\n        animation.play();\n      }\n    }\n  }, [animation]);\n\n  const pauseAnimation = useCallback(() => {\n    if (!animation) {\n      return;\n    }\n\n    animation.pause();\n  }, [animation]);\n\n  const freezeAnimation = useCallback(() => {\n    isFrozen.current = true;\n\n    if (!animation) {\n      return;\n    }\n\n    if (!wasPlaying.current) {\n      wasPlaying.current = animation.isPlaying();\n    }\n\n    pauseAnimation();\n  }, [animation, pauseAnimation]);\n\n  const unfreezeAnimation = useCallback(() => {\n    if (wasPlaying.current) {\n      playAnimation();\n    }\n\n    wasPlaying.current = false;\n    isFrozen.current = false;\n  }, [playAnimation]);\n\n  const unfreezeAnimationOnRaf = useCallback(() => {\n    fastRaf(unfreezeAnimation);\n  }, [unfreezeAnimation]);\n\n  useEffect(() => {\n    if (!animation) {\n      return;\n    }\n\n    if (play || playSegment) {\n      if (isFrozen.current) {\n        wasPlaying.current = true;\n      } else {\n        playAnimation(noLoop);\n      }\n    } else {\n      // eslint-disable-next-line no-lonely-if\n      if (isFrozen.current) {\n        wasPlaying.current = false;\n      } else {\n        pauseAnimation();\n      }\n    }\n  }, [animation, play, playSegment, noLoop, playAnimation, pauseAnimation]);\n\n  useHeavyAnimationCheck(freezeAnimation, unfreezeAnimation);\n  // Pausing frame may not happen in background\n  // so we need to make sure it happens right after focusing,\n  // then we can play again.\n  useBackgroundMode(freezeAnimation, unfreezeAnimationOnRaf);\n\n  const fullClassName = buildClassName('AnimatedSticker', className);\n\n  const style = size ? `width: ${size}px; height: ${size}px;` : undefined;\n\n  return (\n    <div\n      ref={container}\n      className={fullClassName}\n      // @ts-ignore\n      style={style}\n    />\n  );\n};\n\nexport default memo(AnimatedSticker);\n","import React, { FC, memo } from '../../lib/teact/teact';\n\nimport useLang from '../../hooks/useLang';\nimport { TextPart } from '../common/helpers/renderMessageText';\n\nimport Modal from './Modal';\nimport Button from './Button';\n\ntype OwnProps = {\n  isOpen: boolean;\n  onClose: () => void;\n  onCloseAnimationEnd?: () => void;\n  title?: string;\n  header?: FC;\n  textParts?: TextPart[];\n  text?: string;\n  confirmLabel?: string;\n  confirmHandler: () => void;\n  confirmIsDestructive?: boolean;\n  isButtonsInOneRow?: boolean;\n};\n\nconst ConfirmDialog: FC<OwnProps> = ({\n  isOpen,\n  onClose,\n  onCloseAnimationEnd,\n  title,\n  header,\n  text,\n  textParts,\n  confirmLabel = 'Confirm',\n  confirmHandler,\n  confirmIsDestructive,\n  isButtonsInOneRow,\n}) => {\n  const lang = useLang();\n\n  return (\n    <Modal\n      className=\"confirm\"\n      title={title}\n      header={header}\n      isOpen={isOpen}\n      onClose={onClose}\n      onCloseAnimationEnd={onCloseAnimationEnd}\n      onEnter={confirmHandler}\n    >\n      {text && text.split('\\\\n').map((textPart) => (\n        <p>{textPart}</p>\n      ))}\n      {textParts}\n      <div className={isButtonsInOneRow ? 'dialog-buttons mt-2' : ''}>\n        <Button\n          className=\"confirm-dialog-button\"\n          isText\n          onClick={confirmHandler}\n          color={confirmIsDestructive ? 'danger' : 'primary'}\n        >\n          {confirmLabel}\n        </Button>\n        <Button className=\"confirm-dialog-button\" isText onClick={onClose}>{lang('Cancel')}</Button>\n      </div>\n    </Modal>\n  );\n};\n\nexport default memo(ConfirmDialog);\n","import React, { FC, memo } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport useShowTransition from '../../hooks/useShowTransition';\nimport renderText from './helpers/renderText';\nimport useLang from '../../hooks/useLang';\n\nimport './NothingFound.scss';\n\ninterface OwnProps {\n  text?: string;\n  description?: string;\n}\n\nconst DEFAULT_TEXT = 'Nothing found.';\n\nconst NothingFound: FC<OwnProps> = ({ text = DEFAULT_TEXT, description }) => {\n  const lang = useLang();\n  const { transitionClassNames } = useShowTransition(true);\n\n  return (\n    <div className={buildClassName('NothingFound', transitionClassNames, description && 'with-description')}>\n      {text}\n      {description && <p className=\"description\">{renderText(lang(description), ['br'])}</p>}\n    </div>\n  );\n};\n\nexport default memo(NothingFound);\n","import { useEffect, useRef } from '../../../lib/teact/teact';\n\nimport useOnChange from '../../../hooks/useOnChange';\nimport useForceUpdate from '../../../hooks/useForceUpdate';\n\nexport default function useAsyncRendering<T extends any[]>(dependencies: T, delay?: number) {\n  const isDisabled = delay === undefined;\n  const shouldRenderRef = useRef(isDisabled);\n  const timeoutRef = useRef<number>();\n  const forceUpdate = useForceUpdate();\n\n  useOnChange(() => {\n    if (isDisabled) {\n      return;\n    }\n\n    shouldRenderRef.current = false;\n\n    if (timeoutRef.current) {\n      clearTimeout(timeoutRef.current);\n      timeoutRef.current = undefined;\n    }\n  }, dependencies);\n\n  useEffect(() => {\n    if (isDisabled || shouldRenderRef.current) {\n      return;\n    }\n\n    const exec = () => {\n      shouldRenderRef.current = true;\n      forceUpdate();\n    };\n\n    if (delay! > 0) {\n      timeoutRef.current = window.setTimeout(exec, delay);\n    } else {\n      exec();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, dependencies);\n\n  return shouldRenderRef.current;\n}\n","import {\n  useEffect, useMemo, useRef, useState,\n} from '../lib/teact/teact';\n\nimport { IS_PROGRESSIVE_SUPPORTED } from '../util/environment';\nimport { ApiMediaFormat } from '../api/types';\nimport { throttle } from '../util/schedulers';\nimport * as mediaLoader from '../util/mediaLoader';\nimport useForceUpdate from './useForceUpdate';\n\nconst STREAMING_PROGRESS = 0.75;\nconst STREAMING_TIMEOUT = 1500;\nconst PROGRESS_THROTTLE = 500;\n\nexport default <T extends ApiMediaFormat = ApiMediaFormat.BlobUrl>(\n  mediaHash: string | undefined,\n  noLoad = false,\n  // @ts-ignore (workaround for \"could be instantiated with a different subtype\" issue)\n  mediaFormat: T = ApiMediaFormat.BlobUrl,\n  cacheBuster?: number,\n  delay?: number | false,\n) => {\n  const mediaData = mediaHash ? mediaLoader.getFromMemory<T>(mediaHash) : undefined;\n  const isStreaming = mediaFormat === ApiMediaFormat.Stream || (\n    IS_PROGRESSIVE_SUPPORTED && mediaFormat === ApiMediaFormat.Progressive\n  );\n  const forceUpdate = useForceUpdate();\n  const [downloadProgress, setDownloadProgress] = useState(mediaData && !isStreaming ? 1 : 0);\n  const startedAtRef = useRef<number>();\n\n  const handleProgress = useMemo(() => {\n    return throttle((progress: number) => {\n      if (!delay || (Date.now() - startedAtRef.current! > delay)) {\n        setDownloadProgress(progress);\n      }\n    }, PROGRESS_THROTTLE, true);\n  }, [delay]);\n\n  useEffect(() => {\n    if (!noLoad && mediaHash) {\n      if (!mediaData) {\n        setDownloadProgress(0);\n\n        if (startedAtRef.current) {\n          mediaLoader.cancelProgress(handleProgress);\n        }\n\n        startedAtRef.current = Date.now();\n\n        mediaLoader.fetch(mediaHash, mediaFormat, handleProgress).then(() => {\n          const spentTime = Date.now() - startedAtRef.current!;\n          startedAtRef.current = undefined;\n\n          if (!delay || spentTime >= delay) {\n            forceUpdate();\n          } else {\n            setTimeout(forceUpdate, delay - spentTime);\n          }\n        });\n      } else if (isStreaming) {\n        setTimeout(() => {\n          setDownloadProgress(STREAMING_PROGRESS);\n        }, STREAMING_TIMEOUT);\n      }\n    }\n  }, [noLoad, mediaHash, mediaData, mediaFormat, cacheBuster, forceUpdate, isStreaming, delay, handleProgress]);\n\n  useEffect(() => {\n    if (noLoad && startedAtRef.current) {\n      mediaLoader.cancelProgress(handleProgress);\n      setDownloadProgress(0);\n    }\n  }, [handleProgress, noLoad]);\n\n  return { mediaData, downloadProgress };\n};\n","import React, {\n  FC, useEffect, useRef, memo,\n} from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport './ProgressSpinner.scss';\n\nconst RADIUSES = {\n  s: 22, m: 25, l: 28, xl: 20,\n};\nconst STROKE_WIDTH = 2;\nconst MIN_PROGRESS = 0.05;\nconst MAX_PROGRESS = 1;\n\nconst ProgressSpinner: FC<{\n  progress?: number;\n  size?: 's' | 'm' | 'l' | 'xl';\n  square?: boolean;\n  transparent?: boolean;\n  noCross?: boolean;\n  onClick?: (e: React.MouseEvent<HTMLElement, MouseEvent>) => void;\n}> = ({\n  progress = 0,\n  size = 'l',\n  square,\n  transparent,\n  noCross,\n  onClick,\n}) => {\n  const radius = RADIUSES[size];\n  const circleRadius = radius - STROKE_WIDTH * 2;\n  const borderRadius = radius - 1;\n  const circumference = circleRadius * 2 * Math.PI;\n  // eslint-disable-next-line no-null/no-null\n  const container = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    if (!container.current) {\n      return;\n    }\n\n    const svg = container.current.firstElementChild;\n    const strokeDashOffset = circumference - Math.min(Math.max(MIN_PROGRESS, progress), MAX_PROGRESS) * circumference;\n\n    if (!svg) {\n      container.current.innerHTML = `<svg\n        viewBox=\"0 0 ${borderRadius * 2} ${borderRadius * 2}\"\n        height=\"${borderRadius * 2}\"\n        width=\"${borderRadius * 2}\"\n      >\n        <circle\n          stroke=\"white\"\n          fill=\"transparent\"\n          stroke-width=${STROKE_WIDTH}\n          stroke-dasharray=\"${circumference} ${circumference}\"}\n          stroke-dashoffset=\"${strokeDashOffset}\"\n          stroke-linecap=\"round\"\n          r=${circleRadius}\n          cx=${borderRadius}\n          cy=${borderRadius}\n        />\n      </svg>`;\n    } else {\n      (svg.firstElementChild as SVGElement).setAttribute('stroke-dashoffset', strokeDashOffset.toString());\n    }\n  }, [container, circumference, borderRadius, circleRadius, progress]);\n\n  const className = buildClassName(\n    `ProgressSpinner size-${size}`,\n    transparent && 'transparent',\n    square && 'square',\n    noCross && 'no-cross',\n  );\n\n  return (\n    <div\n      ref={container}\n      className={className}\n      onClick={onClick}\n    />\n  );\n};\n\nexport default memo(ProgressSpinner);\n","import { FC, useRef, useLayoutEffect } from '../../lib/teact/teact';\nimport TeactDOM from '../../lib/teact/teact-dom';\n\ntype OwnProps = {\n  containerId?: string;\n  className?: string;\n  children: any;\n};\n\nconst Portal: FC<OwnProps> = ({ containerId, className, children }) => {\n  const elementRef = useRef(document.createElement('div'));\n\n  useLayoutEffect(() => {\n    const container = document.querySelector<HTMLDivElement>(containerId || '#portals');\n    if (!container) {\n      return undefined;\n    }\n\n    const element = elementRef.current;\n    if (className) {\n      element.classList.add(className);\n    }\n\n    container.appendChild(element);\n\n    return () => {\n      TeactDOM.render(undefined, element);\n      container.removeChild(element);\n    };\n  }, [className, containerId]);\n\n  return TeactDOM.render(children, elementRef.current);\n};\n\nexport default Portal;\n","import { MouseEvent as ReactMouseEvent } from 'react';\nimport React, {\n  FC, useEffect, useCallback, memo,\n} from '../../lib/teact/teact';\nimport { withGlobal } from '../../lib/teact/teactn';\n\nimport { ApiChat, ApiTypingStatus } from '../../api/types';\nimport { GlobalActions, GlobalState } from '../../global/types';\nimport { MediaViewerOrigin } from '../../types';\n\nimport {\n  getChatTypeString,\n  getChatTitle,\n  isChatSuperGroup,\n} from '../../modules/helpers';\nimport { selectChat, selectChatMessages, selectChatOnlineCount } from '../../modules/selectors';\nimport renderText from './helpers/renderText';\nimport { pick } from '../../util/iteratees';\nimport useLang, { LangFn } from '../../hooks/useLang';\n\nimport Avatar from './Avatar';\nimport VerifiedIcon from './VerifiedIcon';\nimport TypingStatus from './TypingStatus';\n\ntype OwnProps = {\n  chatId: number;\n  typingStatus?: ApiTypingStatus;\n  avatarSize?: 'small' | 'medium' | 'large' | 'jumbo';\n  withMediaViewer?: boolean;\n  withUsername?: boolean;\n  withFullInfo?: boolean;\n  withUpdatingStatus?: boolean;\n  withChatType?: boolean;\n};\n\ntype StateProps = {\n  chat?: ApiChat;\n  onlineCount?: number;\n  areMessagesLoaded: boolean;\n} & Pick<GlobalState, 'lastSyncTime'>;\n\ntype DispatchProps = Pick<GlobalActions, 'loadFullChat' | 'openMediaViewer'>;\n\nconst GroupChatInfo: FC<OwnProps & StateProps & DispatchProps> = ({\n  typingStatus,\n  avatarSize = 'medium',\n  withMediaViewer,\n  withUsername,\n  withFullInfo,\n  withUpdatingStatus,\n  withChatType,\n  chat,\n  onlineCount,\n  areMessagesLoaded,\n  lastSyncTime,\n  loadFullChat,\n  openMediaViewer,\n}) => {\n  const isSuperGroup = chat && isChatSuperGroup(chat);\n  const { id: chatId, isMin, isRestricted } = chat || {};\n\n  useEffect(() => {\n    if (chatId && !isMin && withFullInfo && lastSyncTime) {\n      loadFullChat({ chatId });\n    }\n  }, [chatId, isMin, lastSyncTime, withFullInfo, loadFullChat, isSuperGroup]);\n\n  const handleAvatarViewerOpen = useCallback((e: ReactMouseEvent<HTMLDivElement, MouseEvent>, hasPhoto: boolean) => {\n    if (chat && hasPhoto) {\n      e.stopPropagation();\n      openMediaViewer({\n        avatarOwnerId: chat.id,\n        origin: avatarSize === 'jumbo' ? MediaViewerOrigin.ProfileAvatar : MediaViewerOrigin.MiddleHeaderAvatar,\n      });\n    }\n  }, [chat, avatarSize, openMediaViewer]);\n\n  const lang = useLang();\n\n  if (!chat) {\n    return undefined;\n  }\n\n  function renderStatusOrTyping() {\n    if (withUpdatingStatus && !areMessagesLoaded && !isRestricted) {\n      return (\n        <span className=\"status\">{lang('Updating')}</span>\n      );\n    }\n\n    if (!chat) {\n      return undefined;\n    }\n\n    if (typingStatus) {\n      return <TypingStatus typingStatus={typingStatus} />;\n    }\n\n    if (withChatType) {\n      return (\n        <div className=\"status\">{lang(getChatTypeString(chat))}</div>\n      );\n    }\n\n    const handle = withUsername ? chat.username : undefined;\n    const groupStatus = getGroupStatus(chat, lang);\n    const onlineStatus = onlineCount ? `, ${lang('OnlineCount', onlineCount, 'i')}` : undefined;\n\n    return (\n      <div className=\"status\">\n        {handle && <span className=\"handle\">{handle}</span>}\n        <span className=\"group-status\">{groupStatus}</span>\n        {onlineStatus && <span className=\"online-status\">{onlineStatus}</span>}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"ChatInfo\">\n      <Avatar\n        key={chat.id}\n        size={avatarSize}\n        chat={chat}\n        onClick={withMediaViewer ? handleAvatarViewerOpen : undefined}\n      />\n      <div className=\"info\">\n        <div className=\"title\">\n          <h3>{renderText(getChatTitle(chat))}</h3>\n          {chat.isVerified && <VerifiedIcon />}\n        </div>\n        {renderStatusOrTyping()}\n      </div>\n    </div>\n  );\n};\n\nfunction getGroupStatus(chat: ApiChat, lang: LangFn) {\n  const chatTypeString = lang(getChatTypeString(chat));\n  const { membersCount } = chat;\n\n  if (chat.isRestricted) {\n    return chatTypeString === 'Channel' ? 'channel is inaccessible' : 'group is inaccessible';\n  }\n\n  if (!membersCount) {\n    return chatTypeString;\n  }\n\n  return chatTypeString === 'Channel'\n    ? lang('Subscribers', membersCount, 'i')\n    : lang('Members', membersCount, 'i');\n}\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatId }): StateProps => {\n    const { lastSyncTime } = global;\n    const chat = selectChat(global, chatId);\n    const onlineCount = chat ? selectChatOnlineCount(global, chat) : undefined;\n    const areMessagesLoaded = Boolean(selectChatMessages(global, chatId));\n\n    return {\n      lastSyncTime, chat, onlineCount, areMessagesLoaded,\n    };\n  },\n  (setGlobal, actions): DispatchProps => pick(actions, ['loadFullChat', 'openMediaViewer']),\n)(GroupChatInfo));\n","import { FocusDirection } from '../types';\n\nimport { dispatchHeavyAnimationEvent } from '../hooks/useHeavyAnimationCheck';\nimport { fastRaf } from './schedulers';\nimport { animateSingle } from './animation';\n\nconst MAX_DISTANCE = 1500;\nconst MIN_JS_DURATION = 250;\nconst MAX_JS_DURATION = 600;\n\nlet isAnimating = false;\n\nexport default function fastSmoothScroll(\n  container: HTMLElement,\n  element: HTMLElement,\n  position: ScrollLogicalPosition,\n  margin = 0,\n  maxDistance = MAX_DISTANCE,\n  forceDirection?: FocusDirection,\n  forceDuration?: number,\n  forceCurrentContainerHeight?: boolean,\n) {\n  if (forceDirection === FocusDirection.Static) {\n    element.scrollIntoView({ block: position });\n\n    return;\n  }\n\n  const { offsetTop } = element;\n\n  if (forceDirection === undefined) {\n    const offset = offsetTop - container.scrollTop;\n\n    if (offset < -maxDistance) {\n      container.scrollTop += (offset + maxDistance);\n    } else if (offset > maxDistance) {\n      container.scrollTop += (offset - maxDistance);\n    }\n  } else if (forceDirection === FocusDirection.Up) {\n    container.scrollTop = offsetTop + maxDistance;\n  } else if (forceDirection === FocusDirection.Down) {\n    container.scrollTop = Math.max(0, offsetTop - maxDistance);\n  }\n\n  isAnimating = true;\n  fastRaf(() => {\n    scrollWithJs(container, element, position, margin, forceDuration, forceCurrentContainerHeight);\n  });\n}\n\nexport function isAnimatingScroll() {\n  return isAnimating;\n}\n\nfunction scrollWithJs(\n  container: HTMLElement,\n  element: HTMLElement,\n  position: ScrollLogicalPosition,\n  margin = 0,\n  forceDuration?: number,\n  forceCurrentContainerHeight?: boolean,\n) {\n  const { offsetTop: elementTop, offsetHeight: elementHeight } = element;\n  const { scrollTop, offsetHeight: containerHeight, scrollHeight } = container;\n  const targetContainerHeight = !forceCurrentContainerHeight && container.dataset.normalHeight\n    ? Number(container.dataset.normalHeight)\n    : containerHeight;\n\n  let path!: number;\n\n  switch (position) {\n    case 'start':\n      path = (elementTop - margin) - scrollTop;\n      break;\n    case 'end':\n      path = (elementTop + elementHeight + margin) - (scrollTop + targetContainerHeight);\n      break;\n    // 'nearest' is not supported yet\n    case 'nearest':\n    case 'center':\n      path = elementHeight < targetContainerHeight\n        ? (elementTop + elementHeight / 2) - (scrollTop + targetContainerHeight / 2)\n        : (elementTop - margin) - scrollTop;\n      break;\n  }\n\n  if (path < 0) {\n    const remainingPath = -scrollTop;\n    path = Math.max(path, remainingPath);\n  } else if (path > 0) {\n    const remainingPath = scrollHeight - (scrollTop + targetContainerHeight);\n    path = Math.min(path, remainingPath);\n  }\n\n  const target = container.scrollTop + path;\n  const duration = forceDuration || (\n    MIN_JS_DURATION + (Math.abs(path) / MAX_DISTANCE) * (MAX_JS_DURATION - MIN_JS_DURATION)\n  );\n  const startAt = Date.now();\n\n  dispatchHeavyAnimationEvent(duration);\n  animateSingle(() => {\n    const t = Math.min((Date.now() - startAt) / duration, 1);\n\n    const currentPath = path * (1 - transition(t));\n    container.scrollTop = Math.round(target - currentPath);\n\n    isAnimating = t < 1;\n\n    return isAnimating;\n  });\n}\n\nfunction transition(t: number) {\n  return 1 - ((1 - t) ** 3.5);\n}\n","import { ChangeEvent } from 'react';\nimport React, { FC, memo } from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport Spinner from './Spinner';\n\nimport './Radio.scss';\n\ntype OwnProps = {\n  id?: string;\n  name: string;\n  label: string;\n  subLabel?: string;\n  value: string;\n  checked: boolean;\n  disabled?: boolean;\n  hidden?: boolean;\n  isLoading?: boolean;\n  onChange: (e: ChangeEvent<HTMLInputElement>) => void;\n};\n\nconst Radio: FC<OwnProps> = ({\n  id,\n  label,\n  subLabel,\n  value,\n  name,\n  checked,\n  disabled,\n  hidden,\n  isLoading,\n  onChange,\n}) => {\n  const className = buildClassName(\n    'Radio',\n    disabled && 'disabled',\n    hidden && 'hidden-widget',\n    isLoading && 'loading',\n  );\n\n  return (\n    <label className={className}>\n      <input\n        type=\"radio\"\n        name={name}\n        value={value}\n        id={id}\n        checked={checked}\n        onChange={onChange}\n        disabled={disabled || hidden}\n      />\n      <div className=\"Radio-main\">\n        <span className=\"label\">{label}</span>\n        {subLabel && <span className=\"subLabel\">{subLabel}</span>}\n      </div>\n      {isLoading && <Spinner />}\n    </label>\n  );\n};\n\nexport default memo(Radio);\n","import { ChangeEvent } from 'react';\nimport React, { FC, useCallback, memo } from '../../lib/teact/teact';\nimport Radio from './Radio';\n\ntype IRadioOption = {\n  label: string;\n  subLabel?: string;\n  value: string;\n  hidden?: boolean;\n};\n\ntype OwnProps = {\n  id?: string;\n  name: string;\n  options: IRadioOption[];\n  selected?: string;\n  disabled?: boolean;\n  loadingOption?: string;\n  onChange: (value: string) => void;\n};\n\nconst RadioGroup: FC<OwnProps> = ({\n  id,\n  name,\n  options,\n  selected,\n  disabled,\n  loadingOption,\n  onChange,\n}) => {\n  const handleChange = useCallback((event: ChangeEvent<HTMLInputElement>) => {\n    const { value } = event.currentTarget;\n    onChange(value);\n  }, [onChange]);\n\n  return (\n    <div id={id} className=\"radio-group\">\n      {options.map((option) => (\n        <Radio\n          name={name}\n          label={option.label}\n          subLabel={option.subLabel}\n          value={option.value}\n          checked={option.value === selected}\n          hidden={option.hidden}\n          disabled={disabled}\n          isLoading={loadingOption ? loadingOption === option.value : undefined}\n          onChange={handleChange}\n        />\n      ))}\n    </div>\n  );\n};\n\nexport default memo(RadioGroup);\n","import { useCallback, useEffect, useRef } from '../lib/teact/teact';\nimport { LoadMoreDirection } from '../types';\n\nimport { areSortedArraysEqual } from '../util/iteratees';\nimport useForceUpdate from './useForceUpdate';\nimport usePrevious from './usePrevious';\n\ntype GetMore = (args: { direction: LoadMoreDirection }) => void;\ntype LoadMoreBackwards = (args: { offsetId?: number }) => void;\n\nconst DEFAULT_LIST_SLICE = 30;\n\nexport default (\n  loadMoreBackwards?: LoadMoreBackwards,\n  listIds?: number[],\n  isDisabled = false,\n  listSlice = DEFAULT_LIST_SLICE,\n  forceFullPreload = false,\n): [number[]?, GetMore?] => {\n  const lastParamsRef = useRef<{\n    direction?: LoadMoreDirection;\n    offsetId?: number;\n  }>();\n\n  const viewportIdsRef = useRef<number[] | undefined>((() => {\n    // Only run once to initialize\n    if (!listIds || lastParamsRef.current) {\n      return undefined;\n    }\n\n    const { newViewportIds } = getViewportSlice(listIds, listIds[0], LoadMoreDirection.Forwards, listSlice);\n    return newViewportIds;\n  })());\n\n  const forceUpdate = useForceUpdate();\n\n  const prevListIds = usePrevious(listIds);\n  const prevIsDisabled = usePrevious(isDisabled);\n  if (listIds && !isDisabled && (listIds !== prevListIds || isDisabled !== prevIsDisabled)) {\n    const { offsetId = listIds[0], direction = LoadMoreDirection.Forwards } = lastParamsRef.current || {};\n    const { newViewportIds } = getViewportSlice(listIds, offsetId, direction, listSlice);\n\n    if (!viewportIdsRef.current || !areSortedArraysEqual(viewportIdsRef.current, newViewportIds)) {\n      viewportIdsRef.current = newViewportIds;\n    }\n  }\n\n  useEffect(() => {\n    if (listIds && !isDisabled && loadMoreBackwards && forceFullPreload) {\n      const viewportIds = viewportIdsRef.current!;\n      loadMoreBackwards({ offsetId: viewportIds[viewportIds.length - 1] });\n    }\n  }, [listIds, isDisabled, loadMoreBackwards, forceFullPreload]);\n\n  const getMore: GetMore = useCallback(({ direction }: { direction: LoadMoreDirection }) => {\n    const viewportIds = viewportIdsRef.current;\n\n    const offsetId = viewportIds\n      ? direction === LoadMoreDirection.Backwards ? viewportIds[viewportIds.length - 1] : viewportIds[0]\n      : undefined;\n\n    if (!listIds) {\n      if (loadMoreBackwards) {\n        loadMoreBackwards({ offsetId });\n      }\n\n      return;\n    }\n\n    lastParamsRef.current = { ...lastParamsRef.current, direction, offsetId };\n\n    const {\n      newViewportIds, areSomeLocal, areAllLocal,\n    } = getViewportSlice(listIds, offsetId, direction, listSlice);\n\n    if (areSomeLocal && !(viewportIds && areSortedArraysEqual(viewportIds, newViewportIds))) {\n      viewportIdsRef.current = newViewportIds;\n      forceUpdate();\n    }\n\n    if (!areAllLocal && loadMoreBackwards) {\n      loadMoreBackwards({ offsetId });\n    }\n  }, [listIds, listSlice, loadMoreBackwards, forceUpdate]);\n\n  return isDisabled ? [listIds] : [viewportIdsRef.current, getMore];\n};\n\nfunction getViewportSlice(\n  sourceIds: number[],\n  offsetId = 0,\n  direction: LoadMoreDirection,\n  listSlice: number,\n) {\n  const { length } = sourceIds;\n  const index = sourceIds.indexOf(offsetId);\n  const isForwards = direction === LoadMoreDirection.Forwards;\n  const indexForDirection = isForwards ? index : (index + 1) || length;\n  const from = Math.max(0, indexForDirection - listSlice);\n  const to = indexForDirection + listSlice - 1;\n  const newViewportIds = sourceIds.slice(Math.max(0, from), to + 1);\n\n  let areSomeLocal;\n  let areAllLocal;\n  switch (direction) {\n    case LoadMoreDirection.Forwards:\n      areSomeLocal = indexForDirection > 0;\n      areAllLocal = from >= 0;\n      break;\n    case LoadMoreDirection.Backwards:\n      areSomeLocal = indexForDirection < length;\n      areAllLocal = to <= length - 1;\n      break;\n  }\n\n  return { newViewportIds, areSomeLocal, areAllLocal };\n}\n","import React, {\n  FC, useCallback, useRef, useState,\n} from '../../lib/teact/teact';\n\nimport { ApiMediaFormat, ApiSticker } from '../../api/types';\n\nimport { STICKER_SIZE_TWO_FA } from '../../config';\nimport { getStickerDimensions } from './helpers/mediaDimensions';\nimport { ObserveFn, useIsIntersecting } from '../../hooks/useIntersectionObserver';\nimport useMedia from '../../hooks/useMedia';\nimport useTransitionForMedia from '../../hooks/useTransitionForMedia';\nimport useFlag from '../../hooks/useFlag';\n\nimport AnimatedSticker from './AnimatedSticker';\n\nimport './AnimatedEmoji.scss';\n\ntype OwnProps = {\n  sticker: ApiSticker;\n  observeIntersection?: ObserveFn;\n  isInline?: boolean;\n  lastSyncTime?: number;\n};\n\nconst QUALITY = 1;\nconst RESIZE_FACTOR = 0.5;\n\nconst AnimatedEmoji: FC<OwnProps> = ({\n  sticker, isInline = false, observeIntersection, lastSyncTime,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  const [isAnimationLoaded, markAnimationLoaded] = useFlag();\n  const localMediaHash = `sticker${sticker.id}`;\n\n  const isIntersecting = useIsIntersecting(ref, observeIntersection);\n\n  const previewBlobUrl = useMedia(`${localMediaHash}?size=m`, !isIntersecting, ApiMediaFormat.BlobUrl, lastSyncTime);\n  const { transitionClassNames } = useTransitionForMedia(previewBlobUrl, 'slow');\n\n  const mediaData = useMedia(localMediaHash, !isIntersecting, ApiMediaFormat.Lottie, lastSyncTime);\n  const isMediaLoaded = Boolean(mediaData);\n\n  const [playKey, setPlayKey] = useState(String(Math.random()));\n  const handleClick = useCallback(() => {\n    setPlayKey(String(Math.random()));\n  }, []);\n\n  let width: number;\n  if (isInline) {\n    width = getStickerDimensions(sticker).width * RESIZE_FACTOR;\n  } else {\n    width = STICKER_SIZE_TWO_FA;\n  }\n\n  const style = `width: ${width}px; height: ${width}px;`;\n\n  return (\n    <div\n      ref={ref}\n      className=\"AnimatedEmoji media-inner\"\n      // @ts-ignore\n      style={style}\n      onClick={handleClick}\n    >\n      {previewBlobUrl && !isAnimationLoaded && (\n        <img src={previewBlobUrl} className={transitionClassNames} alt=\"\" />\n      )}\n      {isMediaLoaded && (\n        <AnimatedSticker\n          key={localMediaHash}\n          id={localMediaHash}\n          animationData={mediaData as AnyLiteral}\n          size={width}\n          quality={QUALITY}\n          play={isIntersecting && playKey}\n          noLoop\n          onLoad={markAnimationLoaded}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default AnimatedEmoji;\n","export default function focusEditableElement(element: HTMLElement, force?: boolean) {\n  if (!force && element === document.activeElement) {\n    return;\n  }\n  const selection = window.getSelection()!;\n  const range = document.createRange();\n\n  if (!element.lastChild || !element.lastChild.nodeValue) {\n    element.focus();\n    return;\n  }\n\n  range.setStart(element.lastChild, element.lastChild.nodeValue.length);\n  selection.removeAllRanges();\n  selection.addRange(range);\n}\n","import { useEffect } from '../lib/teact/teact';\n\nexport default (\n  onBlur: AnyToVoidFunction,\n  onFocus: AnyToVoidFunction,\n) => {\n  useEffect(() => {\n    if (!document.hasFocus()) {\n      onBlur();\n    }\n\n    window.addEventListener('blur', onBlur);\n    window.addEventListener('focus', onFocus);\n\n    return () => {\n      window.removeEventListener('focus', onFocus);\n      window.removeEventListener('blur', onBlur);\n    };\n  }, [onBlur, onFocus]);\n};\n","export enum SwipeDirection {\n  Up,\n  Down,\n  Left,\n  Right,\n}\n\ninterface CaptureOptions {\n  onCapture?: (e: MouseEvent | TouchEvent) => void;\n  onRelease?: (e: MouseEvent | TouchEvent) => void;\n  onDrag?: (\n    e: MouseEvent | TouchEvent,\n    captureEvent: MouseEvent | TouchEvent,\n    params: {\n      dragOffsetX: number;\n      dragOffsetY: number;\n    },\n  ) => void;\n  onSwipe?: (e: Event, direction: SwipeDirection) => void;\n  onClick?: (e: MouseEvent | TouchEvent) => void;\n  excludedClosestSelector?: string;\n  withCursor?: boolean;\n}\n\n// https://stackoverflow.com/questions/11287877/how-can-i-get-e-offsetx-on-mobile-ipad\n// Android does not have this value, and iOS has it but as read-only\nexport interface RealTouchEvent extends TouchEvent {\n  pageX?: number;\n  pageY?: number;\n}\n\ntype TSwipeAxis = 'x' | 'y' | undefined;\n\nconst MOVED_THRESHOLD = 15;\nconst SWIPE_THRESHOLD = 50;\n\nexport function captureEvents(element: HTMLElement, options: CaptureOptions) {\n  let captureEvent: MouseEvent | RealTouchEvent | undefined;\n  let hasMoved = false;\n  let currentSwipeAxis: TSwipeAxis;\n\n  function onCapture(e: MouseEvent | RealTouchEvent) {\n    if (options.excludedClosestSelector && (\n      (e.target as HTMLElement).matches(options.excludedClosestSelector)\n      || (e.target as HTMLElement).closest(options.excludedClosestSelector)\n    )) {\n      return;\n    }\n\n    captureEvent = e;\n\n    if (e.type === 'mousedown') {\n      document.addEventListener('mousemove', onMove);\n      document.addEventListener('mouseup', onRelease);\n    } else if (e.type === 'touchstart') {\n      document.addEventListener('touchmove', onMove);\n      document.addEventListener('touchend', onRelease);\n      document.addEventListener('touchcancel', onRelease);\n\n      if ('touches' in e) {\n        if (e.pageX === undefined) {\n          e.pageX = e.touches[0].pageX;\n        }\n\n        if (e.pageY === undefined) {\n          e.pageY = e.touches[0].pageY;\n        }\n      }\n    }\n\n    document.body.classList.add('no-selection');\n    if (options.withCursor) {\n      document.body.classList.add('cursor-grabbing');\n    }\n\n    if (options.onCapture) {\n      options.onCapture(e);\n    }\n  }\n\n  function onRelease(e: MouseEvent | TouchEvent) {\n    if (captureEvent) {\n      if (options.withCursor) {\n        document.body.classList.remove('cursor-grabbing');\n      }\n      document.body.classList.remove('no-selection');\n\n      document.removeEventListener('mouseup', onRelease);\n      document.removeEventListener('mousemove', onMove);\n      document.removeEventListener('touchcancel', onRelease);\n      document.removeEventListener('touchend', onRelease);\n      document.removeEventListener('touchmove', onMove);\n\n      captureEvent = undefined;\n\n      if (hasMoved) {\n        if (options.onRelease) {\n          options.onRelease(e);\n        }\n      } else if (options.onClick) {\n        options.onClick(e);\n      }\n    }\n\n    hasMoved = false;\n    currentSwipeAxis = undefined;\n  }\n\n  function onMove(e: MouseEvent | RealTouchEvent) {\n    if (captureEvent) {\n      if (e.type === 'touchmove' && ('touches' in e)) {\n        if (e.pageX === undefined) {\n          e.pageX = e.touches[0].pageX;\n        }\n\n        if (e.pageY === undefined) {\n          e.pageY = e.touches[0].pageY;\n        }\n      }\n\n      const dragOffsetX = e.pageX! - captureEvent.pageX!;\n      const dragOffsetY = e.pageY! - captureEvent.pageY!;\n\n      if (Math.abs(dragOffsetX) >= MOVED_THRESHOLD || Math.abs(dragOffsetY) >= MOVED_THRESHOLD) {\n        hasMoved = true;\n      }\n\n      if (options.onDrag) {\n        e.preventDefault();\n        options.onDrag(e, captureEvent, { dragOffsetX, dragOffsetY });\n      }\n\n      if (options.onSwipe) {\n        onSwipe(e, dragOffsetX, dragOffsetY);\n      }\n    }\n  }\n\n  function onSwipe(e: Event, dragOffsetX: number, dragOffsetY: number) {\n    if (!currentSwipeAxis) {\n      const xAbs = Math.abs(dragOffsetX);\n      const yAbs = Math.abs(dragOffsetY);\n\n      if (dragOffsetX && dragOffsetY) {\n        const ratio = Math.max(xAbs, yAbs) / Math.min(xAbs, yAbs);\n        // Diagonal swipe\n        if (ratio < 2) {\n          return;\n        }\n      }\n\n      if (xAbs >= SWIPE_THRESHOLD) {\n        currentSwipeAxis = 'x';\n      } else if (yAbs >= SWIPE_THRESHOLD) {\n        currentSwipeAxis = 'y';\n      }\n    }\n\n    processSwipe(e, currentSwipeAxis, dragOffsetX, dragOffsetY, options.onSwipe!);\n  }\n\n  element.addEventListener('mousedown', onCapture);\n  element.addEventListener('touchstart', onCapture, { passive: true });\n\n  return () => {\n    element.removeEventListener('mousedown', onCapture);\n    element.removeEventListener('touchstart', onCapture);\n  };\n}\n\nfunction processSwipe(\n  e: Event,\n  currentSwipeAxis:TSwipeAxis,\n  dragOffsetX: number,\n  dragOffsetY: number,\n  onSwipe: (e: Event, direction: SwipeDirection) => void,\n) {\n  if (currentSwipeAxis === 'x') {\n    if (dragOffsetX < 0) {\n      onSwipe(e, SwipeDirection.Left);\n    } else {\n      onSwipe(e, SwipeDirection.Right);\n    }\n  } else if (currentSwipeAxis === 'y') {\n    if (dragOffsetY < 0) {\n      onSwipe(e, SwipeDirection.Up);\n    } else {\n      onSwipe(e, SwipeDirection.Down);\n    }\n  }\n}\n","import React, { FC } from '../../lib/teact/teact';\n\nimport './VerifiedIcon.scss';\n\nconst VerifiedIcon: FC = () => {\n  return (\n    <span className=\"VerifiedIcon\" />\n  );\n};\n\nexport default VerifiedIcon;\n","export default function cycleRestrict(length: number, index: number) {\n  return index - Math.floor(index / length) * length;\n}\n","import usePrevious from './usePrevious';\n\nexport default function useCurrentOrPrev<T extends any>(\n  current: T, shouldSkipUndefined = false, shouldForceCurrent = false,\n): T | undefined {\n  const prev = usePrevious(current, shouldSkipUndefined);\n\n  // eslint-disable-next-line no-null/no-null\n  return shouldForceCurrent || (current !== null && current !== undefined) ? current : prev;\n}\n","import { DEBUG } from '../config';\n\nexport default (mediaEl: HTMLMediaElement) => {\n  mediaEl.play().catch((err) => {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.warn(err);\n    }\n  });\n};\n","import React, { useCallback, useMemo, useState } from '../lib/teact/teact';\nimport { debounce } from '../util/schedulers';\nimport { isSafariPatchInProgress } from '../util/patchSafariProgressiveAudio';\n\ntype BufferingEvent = (e: Event | React.SyntheticEvent<HTMLMediaElement>) => void;\n\nconst MIN_READY_STATE = 3;\n// Avoid flickering when re-mounting previously buffered video\nconst DEBOUNCE = 200;\n\nexport default (noInitiallyBuffered = false) => {\n  const [isBuffered, setIsBuffered] = useState(!noInitiallyBuffered);\n  const [bufferedProgress, setBufferedProgress] = useState(0);\n\n  const setIsBufferedDebounced = useMemo(() => {\n    return debounce(setIsBuffered, DEBOUNCE, false, true);\n  }, []);\n\n  const handleBuffering = useCallback<BufferingEvent>((e) => {\n    const media = e.currentTarget as HTMLMediaElement;\n\n    if (!isSafariPatchInProgress(media)) {\n      if (media.buffered.length) {\n        setBufferedProgress(media.buffered.end(0) / media.duration);\n      }\n\n      setIsBufferedDebounced(media.readyState >= MIN_READY_STATE || media.currentTime > 0);\n    }\n  }, [setIsBufferedDebounced]);\n\n  const bufferingHandlers = {\n    onLoadedData: handleBuffering,\n    onPlaying: handleBuffering,\n    onLoadStart: handleBuffering, // Needed for Safari to start\n    onPause: handleBuffering, // Needed for Chrome when seeking\n    onTimeUpdate: handleBuffering, // Needed for audio buffering progress\n    onProgress: handleBuffering, // Needed for video buffering progress\n  };\n\n  return {\n    isBuffered,\n    bufferedProgress,\n    bufferingHandlers,\n    checkBuffering(element: HTMLMediaElement) {\n      setIsBufferedDebounced(element.readyState >= MIN_READY_STATE);\n    },\n  };\n};\n","import { ApiMessageEntity, ApiMessageEntityTypes, ApiFormattedText } from '../../../../api/types';\nimport { IS_EMOJI_SUPPORTED } from '../../../../util/environment';\n\nconst ENTITY_CLASS_BY_NODE_NAME: Record<string, string> = {\n  B: ApiMessageEntityTypes.Bold,\n  STRONG: ApiMessageEntityTypes.Bold,\n  I: ApiMessageEntityTypes.Italic,\n  EM: ApiMessageEntityTypes.Italic,\n  U: ApiMessageEntityTypes.Underline,\n  S: ApiMessageEntityTypes.Strike,\n  STRIKE: ApiMessageEntityTypes.Strike,\n  DEL: ApiMessageEntityTypes.Strike,\n  CODE: ApiMessageEntityTypes.Code,\n  PRE: ApiMessageEntityTypes.Pre,\n  BLOCKQUOTE: ApiMessageEntityTypes.Blockquote,\n};\n\nconst MAX_TAG_DEEPNESS = 3;\nconst MAX_MESSAGE_LENGTH = 4096;\n\nexport default function parseMessageInput(html: string): ApiFormattedText {\n  const fragment = document.createElement('div');\n  fragment.innerHTML = parseMarkdown(html);\n  const text = fragment.innerText.trim().replace(/\\u200b+/g, '').slice(0, MAX_MESSAGE_LENGTH);\n  let textIndex = 0;\n  let recursionDeepness = 0;\n  const entities: ApiMessageEntity[] = [];\n\n  function addEntity(node: ChildNode) {\n    const { index, entity } = getEntityDataFromNode(node, text, textIndex);\n\n    if (entity) {\n      textIndex = index;\n      entities.push(entity);\n    } else if (node.textContent) {\n      textIndex += node.textContent.length;\n    }\n\n    if (node.hasChildNodes() && recursionDeepness <= MAX_TAG_DEEPNESS) {\n      recursionDeepness += 1;\n      Array.from(node.childNodes).forEach(addEntity);\n    }\n  }\n\n  Array.from(fragment.childNodes).forEach((node) => {\n    recursionDeepness = 1;\n    addEntity(node);\n  });\n\n  return {\n    text,\n    entities: entities.length ? entities : undefined,\n  };\n}\n\nfunction parseMarkdown(html: string) {\n  let parsedHtml = html.slice(0);\n\n  if (!IS_EMOJI_SUPPORTED) {\n    // Emojis\n    parsedHtml = parsedHtml.replace(/<img[^>]+alt=\"([^\"]+)\"[^>]*>/gm, '$1');\n  } else {\n    parsedHtml = parsedHtml.replace(/<span\\s+class=\"font-emoji\">([^<]*)<\\/span>/g, '$1');\n  }\n  // Strip redundant <span> tags\n  parsedHtml = parsedHtml.replace(/<\\/?span([^>]*)?>/g, '');\n\n  // Strip redundant nbsp's\n  parsedHtml = parsedHtml.replace(/&nbsp;/g, ' ');\n\n  // Replace <br> with newline\n  parsedHtml = parsedHtml.replace(/<br([^>]*)?>/g, '\\n');\n\n  // Strip redundant <div> tags\n  parsedHtml = parsedHtml.replace(/<\\/div>(\\s*)<div>/g, '\\n');\n  parsedHtml = parsedHtml.replace(/<div>/g, '\\n');\n  parsedHtml = parsedHtml.replace(/<\\/div>/g, '');\n\n  // Pre\n  parsedHtml = parsedHtml.replace(/^`{3}(.*[\\n\\r][^]*?^)`{3}/gm, '<pre>$1</pre>');\n  parsedHtml = parsedHtml.replace(/[`]{3}([^`]+)[`]{3}/g, '<pre>$1</pre>');\n\n  // Code\n  parsedHtml = parsedHtml.replace(/[`]{1}([^`\\n]+)[`]{1}/g, '<code>$1</code>');\n\n  // Other simple markdown\n  parsedHtml = parsedHtml.replace(/[*]{2}([^*\\n]+)[*]{2}/g, '<b>$1</b>');\n  parsedHtml = parsedHtml.replace(/[*]{1}([^*\\n]+)[*]{1}/g, '<i>$1</i>');\n  parsedHtml = parsedHtml.replace(/[~]{2}([^~\\n]+)[~]{2}/g, '<s>$1</s>');\n\n  return parsedHtml;\n}\n\nfunction getEntityDataFromNode(\n  node: ChildNode,\n  rawText: string,\n  textIndex: number,\n): { index: number; entity?: ApiMessageEntity } {\n  const type = getEntityTypeFromNode(node);\n  if (!type || !node.textContent) {\n    return {\n      index: textIndex,\n      entity: undefined,\n    };\n  }\n\n  const rawIndex = rawText.indexOf(node.textContent, textIndex);\n  // In some cases, last text entity ends with a newline (which gets trimmed from `rawText`).\n  // In this case, `rawIndex` would return `-1`, so we use `textIndex` instead.\n  const index = rawIndex >= 0 ? rawIndex : textIndex;\n  const offset = rawText.substring(0, index).length;\n  const { length } = rawText.substring(index, index + node.textContent.length);\n\n  let url: string | undefined;\n  let userId: number | undefined;\n  if (type === ApiMessageEntityTypes.TextUrl) {\n    url = (node as HTMLAnchorElement).href;\n  }\n  if (type === ApiMessageEntityTypes.MentionName) {\n    userId = Number((node as HTMLAnchorElement).dataset.userId);\n  }\n\n  return {\n    index,\n    entity: {\n      type,\n      offset,\n      length,\n      ...(url && { url }),\n      ...(userId && { userId }),\n    },\n  };\n}\n\nfunction getEntityTypeFromNode(node: ChildNode) {\n  if (ENTITY_CLASS_BY_NODE_NAME[node.nodeName]) {\n    return ENTITY_CLASS_BY_NODE_NAME[node.nodeName];\n  }\n\n  if (node.nodeName === 'A') {\n    const anchor = node as HTMLAnchorElement;\n    if (anchor.dataset.entityType === ApiMessageEntityTypes.MentionName) {\n      return ApiMessageEntityTypes.MentionName;\n    }\n    if (anchor.href.startsWith('mailto:')) {\n      return ApiMessageEntityTypes.Email;\n    }\n    if (anchor.href.startsWith('tel:')) {\n      return ApiMessageEntityTypes.Phone;\n    }\n    if (anchor.href !== anchor.textContent) {\n      return ApiMessageEntityTypes.TextUrl;\n    }\n\n    return ApiMessageEntityTypes.Url;\n  }\n\n  if (node.nodeName === 'SPAN') {\n    return (node as HTMLElement).dataset.entityType;\n  }\n\n  return undefined;\n}\n","import React, { FC, memo } from '../../../lib/teact/teact';\n\nimport useFlag from '../../../hooks/useFlag';\nimport buildClassName from '../../../util/buildClassName';\n\nimport './DropTarget.scss';\n\nexport type OwnProps = {\n  isQuick?: boolean;\n  onFileSelect: (e: React.DragEvent<HTMLDivElement>) => void;\n};\n\nconst DropTarget: FC<OwnProps> = ({ isQuick, onFileSelect }) => {\n  const [isHovered, markHovered, unmarkHovered] = useFlag();\n\n  const handleDragEnter = () => { markHovered(); };\n  const handleDragLeave = (e: React.DragEvent<HTMLDivElement>) => {\n    const { relatedTarget: toTarget } = e;\n\n    if (toTarget) {\n      e.stopPropagation();\n    }\n\n    unmarkHovered();\n  };\n\n  const className = buildClassName(\n    'DropTarget',\n    isHovered && 'hovered',\n  );\n\n  return (\n    <div\n      className={className}\n      onDrop={onFileSelect}\n      onDragEnter={handleDragEnter}\n      onDragLeave={handleDragLeave}\n    >\n      <div className=\"target-content\">\n        <div className={`icon icon-${isQuick ? 'photo' : 'document'}`} />\n        <div className=\"title\">Drop files here to send them</div>\n        <div className=\"description\">{isQuick ? 'in a quick way' : 'without compression'}</div>\n      </div>\n    </div>\n  );\n};\n\nexport default memo(DropTarget);\n","import React, {\n  FC, memo, useCallback, useEffect, useRef,\n} from '../../../lib/teact/teact';\n\nimport useShowTransition from '../../../hooks/useShowTransition';\nimport buildClassName from '../../../util/buildClassName';\n\nimport captureEscKeyListener from '../../../util/captureEscKeyListener';\nimport usePrevious from '../../../hooks/usePrevious';\n\nimport DropTarget from './DropTarget';\n\nimport './DropArea.scss';\n\nexport type OwnProps = {\n  isOpen: boolean;\n  withQuick?: boolean;\n  onHide: NoneToVoidFunction;\n  onFileSelect: (files: File[], isQuick: boolean) => void;\n};\n\nexport enum DropAreaState {\n  None = 'none',\n  Document = 'document',\n  QuickFile = 'quick_file',\n}\n\nconst DROP_LEAVE_TIMEOUT_MS = 150;\n\nconst DropArea: FC<OwnProps> = ({\n  isOpen, withQuick, onHide, onFileSelect,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const hideTimeoutRef = useRef<number>(null);\n  const prevWithQuick = usePrevious(withQuick);\n  const { shouldRender, transitionClassNames } = useShowTransition(isOpen);\n\n  useEffect(() => (isOpen ? captureEscKeyListener(onHide) : undefined), [isOpen, onHide]);\n\n  const handleFilesDrop = useCallback((e: React.DragEvent<HTMLDivElement>) => {\n    const { dataTransfer: dt } = e;\n\n    if (dt.files && dt.files.length > 0) {\n      onHide();\n      onFileSelect(Array.from(dt.files), false);\n    }\n  }, [onFileSelect, onHide]);\n\n  const handleQuickFilesDrop = useCallback((e: React.DragEvent<HTMLDivElement>) => {\n    const { dataTransfer: dt } = e;\n\n    if (dt.files && dt.files.length > 0) {\n      onHide();\n      onFileSelect(Array.from(dt.files), true);\n    }\n  }, [onFileSelect, onHide]);\n\n  const handleDragLeave = useCallback((e: React.DragEvent<HTMLDivElement>) => {\n    e.stopPropagation();\n\n    const { target: fromTarget, relatedTarget: toTarget } = e;\n\n    // Esc button pressed during drag event\n    if ((fromTarget as HTMLDivElement).matches('.DropTarget, .DropArea') && !toTarget) {\n      hideTimeoutRef.current = window.setTimeout(() => {\n        onHide();\n      }, DROP_LEAVE_TIMEOUT_MS);\n    }\n  }, [onHide]);\n\n  const handleDragOver = () => {\n    if (hideTimeoutRef.current) {\n      window.clearTimeout(hideTimeoutRef.current);\n    }\n  };\n\n  if (!shouldRender) {\n    return undefined;\n  }\n\n  const className = buildClassName(\n    'DropArea',\n    transitionClassNames,\n  );\n\n  return (\n    <div className={className} onDragLeave={handleDragLeave} onDragOver={handleDragOver} onDrop={onHide}>\n      <DropTarget onFileSelect={handleFilesDrop} />\n      {(withQuick || prevWithQuick) && <DropTarget onFileSelect={handleQuickFilesDrop} isQuick />}\n    </div>\n  );\n};\n\nexport default memo(DropArea);\n","import React, { FC, memo } from '../../lib/teact/teact';\nimport { withGlobal } from '../../lib/teact/teactn';\n\nimport { ApiChat, ApiUser } from '../../api/types';\n\nimport { selectChat, selectUser } from '../../modules/selectors';\nimport { getChatTitle, getUserFirstOrLastName, isChatPrivate } from '../../modules/helpers';\nimport renderText from './helpers/renderText';\nimport buildClassName from '../../util/buildClassName';\nimport useLang from '../../hooks/useLang';\n\nimport Avatar from './Avatar';\n\nimport './PickerSelectedItem.scss';\n\ntype OwnProps = {\n  chatOrUserId?: number;\n  icon?: string;\n  title?: string;\n  isMinimized?: boolean;\n  canClose?: boolean;\n  onClick: (arg: any) => void;\n  clickArg: any;\n  className?: string;\n};\n\ntype StateProps = {\n  chat?: ApiChat;\n  user?: ApiUser;\n};\n\nconst PickerSelectedItem: FC<OwnProps & StateProps> = ({\n  icon,\n  title,\n  isMinimized,\n  canClose,\n  onClick,\n  clickArg,\n  chat,\n  user,\n  className,\n}) => {\n  useLang();\n\n  let iconElement: any;\n  let titleText: any;\n\n  if (icon && title) {\n    iconElement = (\n      <div className=\"item-icon\">\n        <i className={`icon-${icon}`} />\n      </div>\n    );\n\n    titleText = title;\n  } else if (chat || user) {\n    iconElement = (\n      <Avatar\n        chat={chat}\n        user={user}\n        size=\"small\"\n        isSavedMessages={user && user.isSelf}\n      />\n    );\n\n    const name = !chat || (user && !user.isSelf)\n      ? getUserFirstOrLastName(user)\n      : getChatTitle(chat, user);\n\n    titleText = name ? renderText(name) : undefined;\n  }\n\n  const fullClassName = buildClassName(\n    'PickerSelectedItem',\n    className,\n    isMinimized && 'minimized',\n    canClose && 'closeable',\n  );\n\n  return (\n    <div\n      className={fullClassName}\n      onClick={() => onClick(clickArg)}\n      title={isMinimized ? titleText : undefined}\n    >\n      {iconElement}\n      {!isMinimized && (\n        <div className=\"item-name\">\n          {titleText}\n        </div>\n      )}\n      {canClose && (\n        <div className=\"item-remove\">\n          <i className=\"icon-close\" />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatOrUserId }): StateProps => {\n    if (!chatOrUserId) {\n      return {};\n    }\n\n    const chat = chatOrUserId ? selectChat(global, chatOrUserId) : undefined;\n    const user = isChatPrivate(chatOrUserId) ? selectUser(global, chatOrUserId) : undefined;\n\n    return {\n      chat,\n      user,\n    };\n  },\n)(PickerSelectedItem));\n","import { fastRaf } from './schedulers';\nimport { animate } from './animation';\nimport { IS_IOS } from './environment';\n\nconst DURATION = 450;\n\nexport default function fastSmoothScrollHorizontal(container: HTMLElement, left: number) {\n  // Native way seems to be smoother in Chrome\n  if (!IS_IOS) {\n    container.scrollTo({ left, behavior: 'smooth' });\n  } else {\n    fastRaf(() => {\n      scrollWithJs(container, left);\n    });\n  }\n}\n\nfunction scrollWithJs(container: HTMLElement, left: number) {\n  const { scrollLeft, offsetWidth: containerWidth, scrollWidth } = container;\n  let path = left - scrollLeft;\n\n  if (path < 0) {\n    const remainingPath = -scrollLeft;\n    path = Math.max(path, remainingPath);\n  } else if (path > 0) {\n    const remainingPath = scrollWidth - (scrollLeft + containerWidth);\n    path = Math.min(path, remainingPath);\n  }\n\n  const target = container.scrollLeft + path;\n  const startAt = Date.now();\n\n  animate(() => {\n    const t = Math.min((Date.now() - startAt) / DURATION, 1);\n\n    const currentPath = path * (1 - transition(t));\n    container.scrollLeft = Math.round(target - currentPath);\n\n    return t < 1;\n  });\n}\n\nfunction transition(t: number) {\n  return 1 - ((1 - t) ** 3.5);\n}\n","import { RefObject } from 'react';\nimport { useEffect } from '../lib/teact/teact';\n\nexport default (containerRef: RefObject<HTMLElement>, isDisabled?: boolean) => {\n  useEffect(() => {\n    const container = containerRef.current;\n    if (!container) {\n      return undefined;\n    }\n\n    function handleScroll(e: WheelEvent) {\n      // Ignore horizontal scroll and let it work natively (e.g. on touchpad)\n      if (!e.deltaX) {\n        container!.scrollLeft += e.deltaY / 4;\n      }\n    }\n\n    container.addEventListener('wheel', handleScroll, { passive: true });\n\n    return () => {\n      container.removeEventListener('wheel', handleScroll);\n    };\n  }, [containerRef, isDisabled]);\n};\n","import { useEffect, useMemo } from '../lib/teact/teact';\nimport { getDispatch } from '../lib/teact/teactn';\n\nimport { ApiMessage } from '../api/types';\n\nimport { throttle } from '../util/schedulers';\n\nexport default (\n  chatId: number,\n  messageId?: number,\n  message?: ApiMessage,\n  replyOriginForId?: number,\n) => {\n  const { loadMessage } = getDispatch();\n  const loadMessageThrottled = useMemo(() => {\n    const throttled = throttle(loadMessage, 500, true);\n    return () => {\n      throttled({ chatId, messageId, replyOriginForId });\n    };\n  }, [loadMessage, chatId, messageId, replyOriginForId]);\n\n  useEffect(() => {\n    if (messageId && !message) {\n      loadMessageThrottled();\n    }\n  });\n};\n","import { RefObject } from 'react';\nimport { useState, useEffect, useCallback } from '../lib/teact/teact';\n\nimport { IAnchorPosition } from '../types';\nimport { IS_TOUCH_ENV, IS_MOBILE_SCREEN } from '../util/environment';\n\nconst LONG_TAP_DURATION_MS = 250;\nconst SELECTION_ANIMATION_DURATION_MS = 200;\n\nlet contextMenuCounter = 0;\n\nfunction checkIsDisabledForMobile() {\n  return IS_MOBILE_SCREEN\n  && window.document.body.classList.contains('enable-symbol-menu-transforms');\n}\n\nexport default (\n  elementRef: RefObject<HTMLElement>,\n  isMenuDisabled?: boolean,\n  shouldDisableOnLink?: boolean,\n) => {\n  const [isContextMenuOpen, setIsContextMenuOpen] = useState(false);\n  const [contextMenuPosition, setContextMenuPosition] = useState<IAnchorPosition | undefined>(undefined);\n\n  const handleBeforeContextMenu = useCallback((e: React.MouseEvent) => {\n    if (!isMenuDisabled && e.button === 2) {\n      document.body.classList.add('no-selection');\n    }\n  }, [isMenuDisabled]);\n\n  const handleContextMenu = useCallback((e: React.MouseEvent) => {\n    document.body.classList.remove('no-selection');\n\n    if (isMenuDisabled || (shouldDisableOnLink && (e.target as HTMLElement).matches('a.text-entity-link[href]'))) {\n      return;\n    }\n    e.preventDefault();\n\n    if (contextMenuPosition) {\n      return;\n    }\n    document.body.classList.remove('no-selection');\n    if (contextMenuCounter === 0) {\n      document.body.classList.add('has-context-menu');\n    }\n    contextMenuCounter++;\n\n    setIsContextMenuOpen(true);\n    setContextMenuPosition({ x: e.clientX, y: e.clientY });\n  }, [isMenuDisabled, shouldDisableOnLink, contextMenuPosition]);\n\n  const handleContextMenuClose = useCallback(() => {\n    setIsContextMenuOpen(false);\n  }, []);\n\n  const handleContextMenuHide = useCallback(() => {\n    setContextMenuPosition(undefined);\n    document.body.classList.remove('no-selection');\n\n    setTimeout(() => {\n      contextMenuCounter--;\n      if (contextMenuCounter === 0) {\n        document.body.classList.remove('has-context-menu');\n      }\n    }, SELECTION_ANIMATION_DURATION_MS);\n  }, []);\n\n  // Support context menu on touch-devices\n  useEffect(() => {\n    if (isMenuDisabled || !IS_TOUCH_ENV) {\n      return undefined;\n    }\n\n    const element = elementRef.current;\n    if (!element) {\n      return undefined;\n    }\n\n    let timer: number | undefined;\n\n    const clearLongPressTimer = () => {\n      if (timer) {\n        clearTimeout(timer);\n        timer = undefined;\n      }\n    };\n\n    const emulateContextMenuEvent = (originalEvent: TouchEvent) => {\n      clearLongPressTimer();\n\n      const { clientX, clientY } = originalEvent.touches[0];\n\n      if (contextMenuPosition) {\n        return;\n      }\n\n      // temporarily intercept and clear the next click\n      element.addEventListener('touchend', function cancelClickOnce(e) {\n        element.removeEventListener('touchend', cancelClickOnce, true);\n        e.stopImmediatePropagation();\n        e.preventDefault();\n        e.stopPropagation();\n      }, true);\n\n      document.body.classList.add('no-selection');\n      setIsContextMenuOpen(true);\n      setContextMenuPosition({ x: clientX, y: clientY });\n    };\n\n    const startLongPressTimer = (e: TouchEvent) => {\n      if (isMenuDisabled || checkIsDisabledForMobile()) {\n        return;\n      }\n      clearLongPressTimer();\n\n      timer = window.setTimeout(() => emulateContextMenuEvent(e), LONG_TAP_DURATION_MS);\n    };\n\n    // @perf Consider event delegation\n    element.addEventListener('touchstart', startLongPressTimer, { passive: true });\n    element.addEventListener('touchcancel', clearLongPressTimer, true);\n    element.addEventListener('touchend', clearLongPressTimer, true);\n    element.addEventListener('touchmove', clearLongPressTimer, { passive: true });\n\n    return () => {\n      clearLongPressTimer();\n      element.removeEventListener('touchstart', startLongPressTimer);\n      element.removeEventListener('touchcancel', clearLongPressTimer, true);\n      element.removeEventListener('touchend', clearLongPressTimer, true);\n      element.removeEventListener('touchmove', clearLongPressTimer);\n    };\n  }, [contextMenuPosition, isMenuDisabled, elementRef]);\n\n  return {\n    isContextMenuOpen,\n    contextMenuPosition,\n    handleBeforeContextMenu,\n    handleContextMenu,\n    handleContextMenuClose,\n    handleContextMenuHide,\n  };\n};\n","import { MouseEvent } from 'react';\nimport React from '../../../lib/teact/teact';\nimport { getDispatch } from '../../../lib/teact/teactn';\n\nimport { ApiMessageEntity, ApiMessageEntityTypes, ApiMessage } from '../../../api/types';\n\nimport { getMessageText } from '../../../modules/helpers';\nimport renderText from './renderText';\n\nimport MentionLink from '../../middle/message/MentionLink';\nimport SafeLink from '../SafeLink';\n\nexport type TextPart = string | Element;\n\nexport function renderMessageText(message: ApiMessage, highlight?: string, shouldRenderHqEmoji?: boolean) {\n  const formattedText = message.content.text;\n\n  if (!formattedText || !formattedText.text) {\n    const rawText = getMessageText(message);\n    return rawText ? [rawText] : undefined;\n  }\n  const { text, entities } = formattedText;\n\n  return renderTextWithEntities(text, entities, highlight, shouldRenderHqEmoji);\n}\n\ninterface IOrganizedEntity {\n  entity: ApiMessageEntity;\n  organizedIndexes: Set<number>;\n  nestedEntities: IOrganizedEntity[];\n}\n\nfunction organizeEntity(\n  entity: ApiMessageEntity,\n  index: number,\n  entities: ApiMessageEntity[],\n  organizedEntityIndexes: Set<number>,\n): IOrganizedEntity | undefined {\n  const { offset, length } = entity;\n  const organizedIndexes = new Set([index]);\n\n  if (organizedEntityIndexes.has(index)) {\n    return undefined;\n  }\n\n  // Determine any nested entities inside current entity\n  const nestedEntities = entities\n    .filter((e, i) => i > index && e.offset >= offset && e.offset < offset + length)\n    .map((e) => organizeEntity(e, entities.indexOf(e), entities, organizedEntityIndexes))\n    .filter<IOrganizedEntity>(Boolean as any);\n\n  nestedEntities.forEach((e) => e.organizedIndexes.forEach((i) => organizedIndexes.add(i)));\n\n  return {\n    entity,\n    organizedIndexes,\n    nestedEntities,\n  };\n}\n\n// Organize entities in a tree-like structure to better represent how the text will be displayed\nfunction organizeEntities(entities: ApiMessageEntity[]) {\n  const organizedEntityIndexes: Set<number> = new Set();\n  const organizedEntities: IOrganizedEntity[] = [];\n\n  entities.forEach((entity, index) => {\n    if (organizedEntityIndexes.has(index)) {\n      return;\n    }\n\n    const organizedEntity = organizeEntity(entity, index, entities, organizedEntityIndexes);\n    if (organizedEntity) {\n      organizedEntity.organizedIndexes.forEach((organizedIndex) => {\n        organizedEntityIndexes.add(organizedIndex);\n      });\n\n      organizedEntities.push(organizedEntity);\n    }\n  });\n\n  return organizedEntities;\n}\n\nexport function renderTextWithEntities(\n  text: string,\n  entities?: ApiMessageEntity[],\n  highlight?: string,\n  shouldRenderHqEmoji?: boolean,\n  shouldRenderAsHtml?: boolean,\n) {\n  if (!entities || !entities.length) {\n    return renderMessagePart(text, highlight, shouldRenderHqEmoji, shouldRenderAsHtml);\n  }\n\n  const result: TextPart[] = [];\n  let deleteLineBreakAfterPre = false;\n\n  const organizedEntites = organizeEntities(entities);\n\n  // Recursive function to render regular and nested entities\n  function renderEntity(\n    textPartStart: number,\n    textPartEnd: number,\n    organizedEntity: IOrganizedEntity,\n    isLastEntity: boolean,\n  ) {\n    const renderResult: TextPart[] = [];\n    const { entity, nestedEntities } = organizedEntity;\n    const { offset, length, type } = entity;\n\n    // Render text before the entity\n    let textBefore = text.substring(textPartStart, offset);\n    const textBeforeLength = textBefore.length;\n    if (textBefore) {\n      if (deleteLineBreakAfterPre && textBefore.length > 0 && textBefore[0] === '\\n') {\n        textBefore = textBefore.substr(1);\n        deleteLineBreakAfterPre = false;\n      }\n      if (textBefore) {\n        renderResult.push(...renderMessagePart(\n          textBefore, highlight, shouldRenderHqEmoji, shouldRenderAsHtml,\n        ) as TextPart[]);\n      }\n    }\n\n    const entityStartIndex = textPartStart + textBeforeLength;\n    const entityEndIndex = entityStartIndex + length;\n\n    let entityContent: TextPart = text.substring(offset, offset + length);\n    const nestedEntityContent: TextPart[] = [];\n\n    if (deleteLineBreakAfterPre && entityContent.length > 0 && entityContent[0] === '\\n') {\n      entityContent = entityContent.substr(1);\n      deleteLineBreakAfterPre = false;\n    }\n\n    if (type === ApiMessageEntityTypes.Pre) {\n      deleteLineBreakAfterPre = true;\n    }\n\n    // Render nested entities, if any\n    if (nestedEntities.length) {\n      let nestedIndex = entityStartIndex;\n\n      nestedEntities.forEach((nestedEntity, nestedEntityIndex) => {\n        const {\n          renderResult: nestedResult,\n          entityEndIndex: nestedEntityEndIndex,\n        } = renderEntity(\n          nestedIndex,\n          entityEndIndex,\n          nestedEntity,\n          nestedEntityIndex === nestedEntities.length - 1,\n        );\n\n        nestedEntityContent.push(...nestedResult);\n        nestedIndex = nestedEntityEndIndex;\n      });\n    }\n\n    // Render the entity itself\n    const newEntity = shouldRenderAsHtml\n      ? processEntityAsHtml(entity, entityContent, nestedEntityContent)\n      : processEntity(entity, entityContent, nestedEntityContent);\n\n    if (Array.isArray(newEntity)) {\n      renderResult.push(...newEntity);\n    } else {\n      renderResult.push(newEntity);\n    }\n\n    // Render text after the entity, if it is the last entity in the text,\n    // or the last nested entity inside of another entity\n    if (isLastEntity && entityEndIndex < textPartEnd) {\n      let textAfter = text.substring(entityEndIndex, textPartEnd);\n      if (deleteLineBreakAfterPre && textAfter.length > 0 && textAfter[0] === '\\n') {\n        textAfter = textAfter.substring(1);\n      }\n      if (textAfter) {\n        renderResult.push(...renderMessagePart(\n          textAfter, highlight, shouldRenderHqEmoji, shouldRenderAsHtml,\n        ) as TextPart[]);\n      }\n    }\n\n    return {\n      renderResult,\n      entityEndIndex,\n    };\n  }\n\n  // Process highest-level entities\n  let index = 0;\n\n  organizedEntites.forEach((entity, arrayIndex) => {\n    const { renderResult, entityEndIndex } = renderEntity(\n      index,\n      text.length,\n      entity,\n      arrayIndex === organizedEntites.length - 1,\n    );\n\n    result.push(...renderResult);\n    index = entityEndIndex;\n  });\n\n  return result;\n}\n\nfunction processEntity(\n  entity: ApiMessageEntity,\n  entityContent: TextPart,\n  nestedEntityContent: TextPart[],\n) {\n  const entityText = typeof entityContent === 'string' && entityContent;\n  const renderedContent = nestedEntityContent.length ? nestedEntityContent : entityContent;\n\n  if (!entityText) {\n    return renderMessagePart(renderedContent);\n  }\n\n  switch (entity.type) {\n    case ApiMessageEntityTypes.Bold:\n      return <strong>{renderMessagePart(renderedContent)}</strong>;\n    case ApiMessageEntityTypes.Blockquote:\n      return <blockquote>{renderMessagePart(renderedContent)}</blockquote>;\n    case ApiMessageEntityTypes.BotCommand:\n      return (\n        <a\n          onClick={handleBotCommandClick}\n          className=\"text-entity-link\"\n        >\n          {renderMessagePart(renderedContent)}\n        </a>\n      );\n    case ApiMessageEntityTypes.Hashtag:\n      return (\n        <a\n          onClick={handleHashtagClick}\n          className=\"text-entity-link\"\n        >\n          {renderMessagePart(renderedContent)}\n        </a>\n      );\n    case ApiMessageEntityTypes.Cashtag:\n      return (\n        <a\n          onClick={handleHashtagClick}\n          className=\"text-entity-link\"\n        >\n          {renderMessagePart(renderedContent)}\n        </a>\n      );\n    case ApiMessageEntityTypes.Code:\n      return <code className=\"text-entity-code\">{renderMessagePart(renderedContent)}</code>;\n    case ApiMessageEntityTypes.Email:\n      return (\n        <a\n          href={`mailto:${entityText}`}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          className=\"text-entity-link\"\n        >\n          {renderMessagePart(renderedContent)}\n        </a>\n      );\n    case ApiMessageEntityTypes.Italic:\n      return <em>{renderMessagePart(renderedContent)}</em>;\n    case ApiMessageEntityTypes.MentionName:\n      return (\n        <MentionLink userId={entity.userId}>\n          {renderMessagePart(renderedContent)}\n        </MentionLink>\n      );\n    case ApiMessageEntityTypes.Mention:\n      return (\n        <MentionLink username={entityText}>\n          {renderMessagePart(renderedContent)}\n        </MentionLink>\n      );\n    case ApiMessageEntityTypes.Phone:\n      return (\n        <a\n          href={`tel:${entityText}`}\n          className=\"text-entity-link\"\n        >\n          {renderMessagePart(renderedContent)}\n        </a>\n      );\n    case ApiMessageEntityTypes.Pre:\n      return <pre className=\"text-entity-pre\">{renderMessagePart(renderedContent)}</pre>;\n    case ApiMessageEntityTypes.Strike:\n      return <del>{renderMessagePart(renderedContent)}</del>;\n    case ApiMessageEntityTypes.TextUrl:\n    case ApiMessageEntityTypes.Url:\n      return (\n        <SafeLink\n          url={getLinkUrl(entityText, entity)}\n          text={entityText}\n        >\n          {renderMessagePart(renderedContent)}\n        </SafeLink>\n      );\n    case ApiMessageEntityTypes.Underline:\n      return <ins>{renderMessagePart(renderedContent)}</ins>;\n    default:\n      return renderMessagePart(renderedContent);\n  }\n}\n\nfunction renderMessagePart(\n  content: TextPart | TextPart[],\n  highlight?: string,\n  shouldRenderHqEmoji?: boolean,\n  shouldRenderAsHtml?: boolean,\n) {\n  if (Array.isArray(content)) {\n    const result: TextPart[] = [];\n\n    content.forEach((c) => {\n      result.push(...renderMessagePart(c, highlight, shouldRenderHqEmoji, shouldRenderAsHtml));\n    });\n\n    return result;\n  }\n\n  if (shouldRenderAsHtml) {\n    return renderText(content, ['escape_html', 'emoji_html', 'br_html']);\n  }\n\n  const emojiFilter = shouldRenderHqEmoji ? 'hq_emoji' : 'emoji';\n\n  if (highlight) {\n    return renderText(content, [emojiFilter, 'br', 'highlight'], { highlight });\n  } else {\n    return renderText(content, [emojiFilter, 'br']);\n  }\n}\n\nfunction getLinkUrl(entityContent: string, entity: ApiMessageEntity) {\n  const { type, url } = entity;\n  return type === ApiMessageEntityTypes.TextUrl && url ? url : entityContent;\n}\n\nfunction handleBotCommandClick(e: MouseEvent<HTMLAnchorElement>) {\n  getDispatch().sendBotCommand({ command: e.currentTarget.innerText });\n}\n\nfunction handleHashtagClick(e: MouseEvent<HTMLAnchorElement>) {\n  getDispatch().setLocalTextSearchQuery({ query: e.currentTarget.innerText });\n  getDispatch().searchTextMessagesLocal();\n}\n\nfunction processEntityAsHtml(\n  entity: ApiMessageEntity,\n  entityContent: TextPart,\n  nestedEntityContent: TextPart[],\n) {\n  const rawEntityText = typeof entityContent === 'string' && entityContent;\n\n  const renderedContent = nestedEntityContent.length\n    ? nestedEntityContent.join('')\n    : renderText(entityContent, ['emoji_html', 'br_html']).join('');\n\n  if (!rawEntityText) {\n    return renderedContent;\n  }\n\n  switch (entity.type) {\n    case ApiMessageEntityTypes.Bold:\n      return `<b>${renderedContent}</b>`;\n    case ApiMessageEntityTypes.Italic:\n      return `<i>${renderedContent}</i>`;\n    case ApiMessageEntityTypes.Underline:\n      return `<u>${renderedContent}</u>`;\n    case ApiMessageEntityTypes.Code:\n      return `<code class=\"text-entity-code\">${renderedContent}</code>`;\n    case ApiMessageEntityTypes.Pre:\n      return `\\`\\`\\`<br/>${renderedContent}<br/>\\`\\`\\``;\n    case ApiMessageEntityTypes.Strike:\n      return `<del>${renderedContent}</del>`;\n    case ApiMessageEntityTypes.MentionName:\n      return `<a\n        class=\"text-entity-link\"\n        data-entity-type=\"${ApiMessageEntityTypes.MentionName}\"\n        data-user-id=\"${entity.userId}\"\n        contenteditable=\"false\"\n      >${renderedContent}</a>`;\n    case ApiMessageEntityTypes.Url:\n    case ApiMessageEntityTypes.TextUrl:\n      return `<a\n        class=\"text-entity-link\"\n        href=${getLinkUrl(rawEntityText, entity)}\n        data-entity-type=\"${entity.type}\"\n      >${renderedContent}</a>`;\n    default:\n      return renderedContent;\n  }\n}\n","import { useEffect, useRef } from '../lib/teact/teact';\n\nimport fastBlur from '../lib/fastBlur';\nimport { imgToCanvas } from '../util/files';\nimport useForceUpdate from './useForceUpdate';\n\nconst RADIUS = 2;\nconst ITERATIONS = 2;\nconst MAX_CACHE_SIZE = 1000;\n\nconst cache = new Map<string, string>();\n\nexport default function useBlur(dataUri?: string, isDisabled = false, delay?: number) {\n  const blurredRef = useRef<string | undefined>(dataUri ? cache.get(dataUri) : undefined);\n  const timeoutRef = useRef<number>();\n  const forceUpdate = useForceUpdate();\n\n  if (timeoutRef.current && isDisabled) {\n    clearTimeout(timeoutRef.current);\n    timeoutRef.current = undefined;\n  }\n\n  useEffect(() => {\n    if (!dataUri || blurredRef.current || isDisabled) {\n      return;\n    }\n\n    const img = new Image();\n\n    img.onload = () => {\n      const canvas = imgToCanvas(img);\n      fastBlur(canvas.getContext('2d'), 0, 0, canvas.width, canvas.height, RADIUS, ITERATIONS);\n      const blurredDataUri = canvas.toDataURL();\n\n      blurredRef.current = blurredDataUri;\n      forceUpdate();\n\n      if (cache.size >= MAX_CACHE_SIZE) {\n        cache.clear();\n      }\n      cache.set(dataUri, blurredDataUri);\n    };\n\n    if (delay) {\n      timeoutRef.current = window.setTimeout(() => {\n        img.src = dataUri;\n      }, delay);\n    } else {\n      img.src = dataUri;\n    }\n  }, [dataUri, delay, forceUpdate, isDisabled]);\n\n  return blurredRef.current;\n}\n","import { RefObject } from 'react';\nimport { useEffect } from '../lib/teact/teact';\nimport { fastRaf } from '../util/schedulers';\n\n// Fix for memory leak when unmounting video element\nexport default function useVideoCleanup(videoRef: RefObject<HTMLVideoElement>, dependencies: any[]) {\n  useEffect(() => {\n    const videoEl = videoRef.current;\n\n    return () => {\n      if (videoEl) {\n        fastRaf(() => {\n          videoEl.pause();\n          videoEl.src = '';\n          videoEl.load();\n        });\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, dependencies);\n}\n","import { DEBUG } from '../config';\n\nexport const CLIPBOARD_ITEM_SUPPORTED = navigator.clipboard && window.ClipboardItem;\n\nconst textCopyEl = document.createElement('textarea');\ntextCopyEl.setAttribute('readonly', '');\ntextCopyEl.tabIndex = -1;\ntextCopyEl.className = 'visually-hidden';\n\nexport const copyTextToClipboard = (str: string): void => {\n  textCopyEl.value = str;\n  document.body.appendChild(textCopyEl);\n  const selection = document.getSelection();\n\n  if (selection) {\n    // Store previous selection\n    const rangeToRestore = selection.rangeCount > 0 && selection.getRangeAt(0);\n    textCopyEl.select();\n    document.execCommand('copy');\n    // Restore the original selection\n    if (rangeToRestore) {\n      selection.removeAllRanges();\n      selection.addRange(rangeToRestore);\n    }\n  }\n\n  document.body.removeChild(textCopyEl);\n};\n\nexport const copyImageToClipboard = (imageUrl: string) => {\n  const canvas = document.createElement('canvas');\n  const ctx = canvas.getContext('2d');\n  const imageEl = new Image();\n  imageEl.onload = (e: Event) => {\n    if (ctx && e.currentTarget) {\n      const img = e.currentTarget as HTMLImageElement;\n      canvas.width = img.width;\n      canvas.height = img.height;\n      ctx.drawImage(img, 0, 0, img.width, img.height);\n      canvas.toBlob(copyBlobToClipboard, 'image/png', 1);\n    }\n  };\n\n  imageEl.src = imageUrl;\n};\n\nasync function copyBlobToClipboard(pngBlob: Blob | null) {\n  if (!pngBlob || !CLIPBOARD_ITEM_SUPPORTED) {\n    return;\n  }\n\n  try {\n    await navigator.clipboard.write([\n      new window.ClipboardItem({\n        [pngBlob.type]: pngBlob,\n      }),\n    ]);\n  } catch (error) {\n    if (DEBUG) {\n      // eslint-disable-next-line no-console\n      console.error(error);\n    }\n  }\n}\n","import { RefObject } from 'react';\nimport React, {\n  FC, useRef, useEffect, memo,\n} from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\nimport useFlag from '../../hooks/useFlag';\nimport useLang from '../../hooks/useLang';\n\nimport Loading from './Loading';\nimport Button from './Button';\n\nimport './SearchInput.scss';\n\ntype OwnProps = {\n  ref?: RefObject<HTMLInputElement>;\n  children?: any;\n  className?: string;\n  inputId?: string;\n  value?: string;\n  focused?: boolean;\n  isLoading?: boolean;\n  placeholder?: string;\n  disabled?: boolean;\n  canClose?: boolean;\n  onChange: (value: string) => void;\n  onReset?: NoneToVoidFunction;\n  onFocus?: NoneToVoidFunction;\n  onBlur?: NoneToVoidFunction;\n};\n\nconst SearchInput: FC<OwnProps> = ({\n  ref,\n  children,\n  value,\n  inputId,\n  className,\n  focused,\n  isLoading,\n  placeholder,\n  disabled,\n  canClose,\n  onChange,\n  onReset,\n  onFocus,\n  onBlur,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  let inputRef = useRef<HTMLInputElement>(null);\n  if (ref) {\n    inputRef = ref;\n  }\n\n  const [isInputFocused, markInputFocused, unmarkInputFocused] = useFlag(focused);\n\n  useEffect(() => {\n    if (!inputRef.current) {\n      return;\n    }\n\n    if (focused) {\n      inputRef.current.focus();\n    } else {\n      inputRef.current.blur();\n    }\n  }, [focused, placeholder]); // Trick for setting focus when selecting a contact to search for\n\n  const lang = useLang();\n\n  function handleChange(event: React.ChangeEvent<HTMLInputElement>) {\n    const { currentTarget } = event;\n    onChange(currentTarget.value);\n  }\n\n  function handleFocus() {\n    markInputFocused();\n    if (onFocus) {\n      onFocus();\n    }\n  }\n\n  function handleBlur() {\n    unmarkInputFocused();\n    if (onBlur) {\n      onBlur();\n    }\n  }\n\n  return (\n    <div className={buildClassName('SearchInput', className, isInputFocused && 'has-focus')}>\n      {children}\n      <input\n        ref={inputRef}\n        id={inputId}\n        type=\"text\"\n        placeholder={placeholder || lang('Search')}\n        className=\"form-control\"\n        value={value}\n        disabled={disabled}\n        onChange={handleChange}\n        onFocus={handleFocus}\n        onBlur={handleBlur}\n      />\n      <i className=\"icon-search\" />\n      {isLoading && (\n        <Loading />\n      )}\n      {!isLoading && (value || canClose) && onReset && (\n        <Button\n          round\n          size=\"tiny\"\n          color=\"translucent\"\n          onClick={onReset}\n        >\n          <span className=\"icon-close\" />\n        </Button>\n      )}\n    </div>\n  );\n};\n\nexport default memo(SearchInput);\n","import { IS_IOS } from './environment';\n\nexport default (container: HTMLDivElement, scrollTop?: number) => {\n  if (IS_IOS) {\n    container.style.overflow = 'hidden';\n  }\n\n  if (scrollTop !== undefined) {\n    container.scrollTop = scrollTop;\n  }\n\n  if (IS_IOS) {\n    container.style.overflow = '';\n  }\n};\n","import React, { FC, memo } from '../../lib/teact/teact';\nimport { withGlobal } from '../../lib/teact/teactn';\n\nimport { ApiUser, ApiTypingStatus } from '../../api/types';\n\nimport { selectUser } from '../../modules/selectors';\nimport { getUserFirstOrLastName } from '../../modules/helpers';\nimport renderText from './helpers/renderText';\n\nimport './TypingStatus.scss';\n\ntype OwnProps = {\n  typingStatus: ApiTypingStatus;\n};\n\ntype StateProps = {\n  typingUser?: ApiUser;\n};\n\nconst TypingStatus: FC<OwnProps & StateProps> = ({ typingStatus, typingUser }) => {\n  const typingUserName = typingUser && !typingUser.isSelf && getUserFirstOrLastName(typingUser);\n\n  return (\n    <p className=\"typing-status\">\n      {typingUserName && (\n        <span className=\"sender-name\">{renderText(typingUserName)}</span>\n      )}\n      {typingStatus.action}\n      <span className=\"ellipsis\" />\n    </p>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { typingStatus }): StateProps => {\n    if (!typingStatus.userId) {\n      return {};\n    }\n\n    const typingUser = selectUser(global, typingStatus.userId);\n\n    return { typingUser };\n  },\n)(TypingStatus));\n","import React, { FC, useCallback, memo } from '../../lib/teact/teact';\nimport { withGlobal } from '../../lib/teact/teactn';\n\nimport { ApiChat } from '../../api/types';\nimport { GlobalActions } from '../../global/types';\n\nimport { selectIsChatWithSelf, selectUser } from '../../modules/selectors';\nimport {\n  isChatPrivate,\n  getUserFirstOrLastName,\n  getPrivateChatUserId,\n  isChatBasicGroup,\n  isChatSuperGroup,\n  isChatChannel,\n  getChatTitle,\n} from '../../modules/helpers';\nimport { pick } from '../../util/iteratees';\nimport useLang from '../../hooks/useLang';\nimport renderText from './helpers/renderText';\n\nimport Avatar from './Avatar';\nimport Modal from '../ui/Modal';\nimport Button from '../ui/Button';\n\nimport './DeleteChatModal.scss';\n\nexport type OwnProps = {\n  isOpen: boolean;\n  chat: ApiChat;\n  onClose: () => void;\n};\n\ntype StateProps = {\n  isChannel: boolean;\n  isChatWithSelf?: boolean;\n  isPrivateChat: boolean;\n  isBasicGroup: boolean;\n  isSuperGroup: boolean;\n  canDeleteForAll?: boolean;\n  chatTitle: string;\n  contactName?: string;\n};\n\ntype DispatchProps = Pick<GlobalActions, 'leaveChannel' | 'deleteHistory' | 'deleteChannel'>;\n\nconst DeleteChatModal: FC<OwnProps & StateProps & DispatchProps> = ({\n  isOpen,\n  chat,\n  isChannel,\n  isPrivateChat,\n  isChatWithSelf,\n  isBasicGroup,\n  isSuperGroup,\n  canDeleteForAll,\n  chatTitle,\n  contactName,\n  onClose,\n  leaveChannel,\n  deleteHistory,\n  deleteChannel,\n}) => {\n  const handleDeleteMessageForAll = useCallback(() => {\n    deleteHistory({ chatId: chat.id, maxId: chat.lastMessage!.id, shouldDeleteForAll: true });\n    onClose();\n  }, [deleteHistory, chat.id, chat.lastMessage, onClose]);\n\n  const handleDeleteChat = useCallback(() => {\n    if (isPrivateChat || isBasicGroup) {\n      deleteHistory({ chatId: chat.id, maxId: chat.lastMessage!.id, shouldDeleteForAll: false });\n    } else if ((isChannel || isSuperGroup) && !chat.isCreator) {\n      leaveChannel({ chatId: chat.id });\n    } else if ((isChannel || isSuperGroup) && chat.isCreator) {\n      deleteChannel({ chatId: chat.id });\n    }\n    onClose();\n  }, [\n    isPrivateChat,\n    isBasicGroup,\n    isChannel,\n    isSuperGroup,\n    chat.isCreator,\n    chat.lastMessage,\n    chat.id,\n    onClose,\n    deleteHistory,\n    leaveChannel,\n    deleteChannel,\n  ]);\n\n  const lang = useLang();\n\n  function renderHeader() {\n    return (\n      <div className=\"modal-header\">\n        <Avatar\n          size=\"tiny\"\n          chat={chat}\n          isSavedMessages={isChatWithSelf}\n        />\n        <h3 className=\"modal-title\">{lang(renderTitle())}</h3>\n      </div>\n    );\n  }\n\n  function renderTitle() {\n    if (isChannel && !chat.isCreator) {\n      return 'LeaveChannel';\n    }\n\n    if (isChannel && chat.isCreator) {\n      return 'ChannelDelete';\n    }\n\n    if (isBasicGroup || isSuperGroup) {\n      return 'Group.LeaveGroup';\n    }\n\n    return 'DeleteChatUser';\n  }\n\n  function renderMessage() {\n    if (isChannel && chat.isCreator) {\n      return <p>{renderText(lang('ChatList.DeleteAndLeaveGroupConfirmation', chatTitle), ['simple_markdown'])}</p>;\n    }\n\n    if ((isChannel && !chat.isCreator) || isBasicGroup || isSuperGroup) {\n      return <p>{renderText(lang('ChannelLeaveAlertWithName', chatTitle), ['simple_markdown'])}</p>;\n    }\n\n    return <p>{renderText(lang('ChatList.DeleteChatConfirmation', contactName), ['simple_markdown'])}</p>;\n  }\n\n  function renderActionText() {\n    if (isChannel && !chat.isCreator) {\n      return 'LeaveChannel';\n    }\n    if (isChannel && chat.isCreator) {\n      return 'Chat.Input.Delete';\n    }\n\n    if (isBasicGroup || isSuperGroup) {\n      return 'Group.LeaveGroup';\n    }\n\n    return canDeleteForAll ? 'ChatList.DeleteForCurrentUser' : 'Delete';\n  }\n\n  return (\n    <Modal\n      isOpen={isOpen}\n      onClose={onClose}\n      className=\"DeleteChatModal\"\n      header={renderHeader()}\n    >\n      {renderMessage()}\n      {canDeleteForAll && (\n        <Button color=\"danger\" className=\"confirm-dialog-button\" isText onClick={handleDeleteMessageForAll}>\n          {contactName ? lang('ChatList.DeleteForEveryone', contactName) : lang('DeleteForAll')}\n        </Button>\n      )}\n      <Button color=\"danger\" className=\"confirm-dialog-button\" isText onClick={handleDeleteChat}>\n        {lang(renderActionText())}\n      </Button>\n      <Button className=\"confirm-dialog-button\" isText onClick={onClose}>{lang('Cancel')}</Button>\n    </Modal>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chat }): StateProps => {\n    const isPrivateChat = isChatPrivate(chat.id);\n    const isChatWithSelf = selectIsChatWithSelf(global, chat.id);\n    const canDeleteForAll = (isPrivateChat && !isChatWithSelf);\n    const contactName = chat && isChatPrivate(chat.id)\n      ? getUserFirstOrLastName(selectUser(global, getPrivateChatUserId(chat)!))\n      : undefined;\n\n    return {\n      isPrivateChat,\n      isChatWithSelf,\n      isChannel: isChatChannel(chat),\n      isBasicGroup: isChatBasicGroup(chat),\n      isSuperGroup: isChatSuperGroup(chat),\n      canDeleteForAll,\n      chatTitle: getChatTitle(chat),\n      contactName,\n    };\n  },\n  (setGlobal, actions): DispatchProps => pick(actions, ['leaveChannel', 'deleteHistory', 'deleteChannel']),\n)(DeleteChatModal));\n","/*\n * Thanks to Ace Monkey for this mind-blowing patch.\n */\n\nexport function patchSafariProgressiveAudio(audioEl: HTMLAudioElement) {\n  if (audioEl.dataset.patchedForSafari) {\n    return;\n  }\n\n  audioEl.addEventListener('play', () => {\n    const t = audioEl.currentTime;\n\n    function onProgress() {\n      if (!audioEl.buffered.length) {\n        return;\n      }\n\n      audioEl.dataset.patchForSafariInProgress = 'true';\n      audioEl.currentTime = audioEl.duration - 1;\n      audioEl.addEventListener('progress', () => {\n        delete audioEl.dataset.patchForSafariInProgress;\n        audioEl.currentTime = t;\n        if (audioEl.paused) {\n          audioEl.play();\n        }\n      }, { once: true });\n\n      audioEl.removeEventListener('progress', onProgress);\n    }\n\n    audioEl.addEventListener('progress', onProgress);\n  }, { once: true });\n\n  audioEl.dataset.patchedForSafari = 'true';\n}\n\nexport function isSafariPatchInProgress(audioEl: HTMLAudioElement) {\n  return Boolean(audioEl.dataset.patchForSafariInProgress);\n}\n","import { useLayoutEffect } from '../lib/teact/teact';\nimport usePrevious from './usePrevious';\n\nexport default <T extends any[], PT = T>(cb: (args: PT) => void, dependencies: T) => {\n  const prevDeps = usePrevious<T>(dependencies);\n  return useLayoutEffect(() => {\n    // @ts-ignore (workaround for \"could be instantiated with a different subtype\" issue)\n    cb(prevDeps || []);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, dependencies);\n};\n","import React, {\n  FC, useCallback, useEffect, useState, memo, useRef,\n} from '../../lib/teact/teact';\n\nimport { ApiMessage } from '../../api/types';\n\nimport { getDocumentExtension, getDocumentHasPreview } from './helpers/documentInfo';\nimport { getMediaTransferState, getMessageMediaHash, getMessageMediaThumbDataUri } from '../../modules/helpers';\nimport { ObserveFn, useIsIntersecting } from '../../hooks/useIntersectionObserver';\nimport useMediaWithDownloadProgress from '../../hooks/useMediaWithDownloadProgress';\nimport useMedia from '../../hooks/useMedia';\nimport download from '../../util/download';\n\nimport File from './File';\n\ntype OwnProps = {\n  message: ApiMessage;\n  observeIntersection?: ObserveFn;\n  smaller?: boolean;\n  isSelected?: boolean;\n  isSelectable?: boolean;\n  uploadProgress?: number;\n  withDate?: boolean;\n  datetime?: number;\n  className?: string;\n  sender?: string;\n  onCancelUpload?: () => void;\n  onDateClick?: (messageId: number, chatId: number) => void;\n};\n\nconst Document: FC<OwnProps> = ({\n  message,\n  observeIntersection,\n  smaller,\n  uploadProgress,\n  withDate,\n  datetime,\n  className,\n  sender,\n  isSelected,\n  isSelectable,\n  onCancelUpload,\n  onDateClick,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  const document = message.content.document!;\n  const extension = getDocumentExtension(document) || '';\n  const { fileName, size, timestamp } = document;\n\n  const isIntersecting = useIsIntersecting(ref, observeIntersection);\n\n  const [isDownloadAllowed, setIsDownloadAllowed] = useState(false);\n  const {\n    mediaData, downloadProgress,\n  } = useMediaWithDownloadProgress(getMessageMediaHash(message, 'download'), !isDownloadAllowed);\n  const {\n    isUploading, isTransferring, transferProgress,\n  } = getMediaTransferState(message, uploadProgress || downloadProgress, isDownloadAllowed);\n\n  const hasPreview = getDocumentHasPreview(document);\n  const thumbDataUri = hasPreview ? getMessageMediaThumbDataUri(message) : undefined;\n  const localBlobUrl = hasPreview ? document.previewBlobUrl : undefined;\n  const previewData = useMedia(getMessageMediaHash(message, 'pictogram'), !isIntersecting);\n\n  const handleClick = useCallback(() => {\n    if (isUploading) {\n      if (onCancelUpload) {\n        onCancelUpload();\n      }\n    } else {\n      setIsDownloadAllowed((isAllowed) => !isAllowed);\n    }\n  }, [isUploading, onCancelUpload]);\n\n  const handleDateClick = useCallback(() => {\n    onDateClick!(message.id, message.chatId);\n  }, [onDateClick, message.id, message.chatId]);\n\n  useEffect(() => {\n    if (isDownloadAllowed && mediaData) {\n      download(mediaData, fileName);\n      setIsDownloadAllowed(false);\n    }\n  }, [fileName, mediaData, isDownloadAllowed]);\n\n  return (\n    <File\n      ref={ref}\n      name={fileName}\n      extension={extension}\n      size={size}\n      timestamp={withDate ? datetime || timestamp : undefined}\n      thumbnailDataUri={thumbDataUri}\n      previewData={localBlobUrl || previewData}\n      smaller={smaller}\n      isTransferring={isTransferring}\n      isUploading={isUploading}\n      transferProgress={transferProgress}\n      className={className}\n      sender={sender}\n      isSelectable={isSelectable}\n      isSelected={isSelected}\n      onClick={handleClick}\n      onDateClick={onDateClick ? handleDateClick : undefined}\n    />\n  );\n};\n\nexport default memo(Document);\n","import React, { FC, memo } from '../../lib/teact/teact';\nimport { OwnProps } from './StickerSetModal';\nimport { Bundles } from '../../util/moduleLoader';\n\nimport useModuleLoader from '../../hooks/useModuleLoader';\n\nconst StickerSetModalAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const StickerSetModal = useModuleLoader(Bundles.Extra, 'StickerSetModal', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return StickerSetModal ? <StickerSetModal {...props} /> : undefined;\n};\n\nexport default memo(StickerSetModalAsync);\n","import React, {\n  FC, memo, useCallback, useEffect, useRef, useState,\n} from '../../../lib/teact/teact';\n\nimport { IAnchorPosition } from '../../../types';\n\nimport { EDITABLE_INPUT_ID } from '../../../config';\nimport buildClassName from '../../../util/buildClassName';\nimport captureEscKeyListener from '../../../util/captureEscKeyListener';\nimport useShowTransition from '../../../hooks/useShowTransition';\nimport useVirtualBackdrop from '../../../hooks/useVirtualBackdrop';\nimport useFlag from '../../../hooks/useFlag';\nimport useLang from '../../../hooks/useLang';\n\nimport Button from '../../ui/Button';\n\nimport './TextFormatter.scss';\n\nexport type OwnProps = {\n  isOpen: boolean;\n  anchorPosition?: IAnchorPosition;\n  selectedRange?: Range;\n  onClose: () => void;\n};\n\ninterface ISelectedTextFormats {\n  bold?: boolean;\n  italic?: boolean;\n  underline?: boolean;\n  strikethrough?: boolean;\n  monospace?: boolean;\n}\n\nconst TEXT_FORMAT_BY_TAG_NAME: Record<string, keyof ISelectedTextFormats> = {\n  B: 'bold',\n  STRONG: 'bold',\n  I: 'italic',\n  EM: 'italic',\n  U: 'underline',\n  DEL: 'strikethrough',\n  CODE: 'monospace',\n};\n\nconst TextFormatter: FC<OwnProps> = ({\n  isOpen,\n  anchorPosition,\n  selectedRange,\n  onClose,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const containerRef = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const linkUrlInputRef = useRef<HTMLInputElement>(null);\n  const { shouldRender, transitionClassNames } = useShowTransition(isOpen);\n  const [isLinkControlOpen, openLinkControl, closeLinkControl] = useFlag();\n  const [linkUrl, setLinkUrl] = useState('');\n  const [isEditingLink, setIsEditingLink] = useState(false);\n  const [inputClassName, setInputClassName] = useState<string | undefined>();\n  const [selectedTextFormats, setSelectedTextFormats] = useState<ISelectedTextFormats>({});\n\n  useEffect(() => (isOpen ? captureEscKeyListener(onClose) : undefined), [isOpen, onClose]);\n  useVirtualBackdrop(\n    isOpen,\n    containerRef,\n    onClose,\n  );\n\n  useEffect(() => {\n    if (isLinkControlOpen) {\n      linkUrlInputRef.current!.focus();\n    } else {\n      setLinkUrl('');\n      setIsEditingLink(false);\n    }\n  }, [isLinkControlOpen]);\n\n  useEffect(() => {\n    if (!shouldRender) {\n      closeLinkControl();\n      setSelectedTextFormats({});\n      setInputClassName(undefined);\n    }\n  }, [closeLinkControl, shouldRender]);\n\n  useEffect(() => {\n    if (!isOpen || !selectedRange) {\n      return;\n    }\n\n    const selectedFormats: ISelectedTextFormats = {};\n    let { parentElement } = selectedRange.commonAncestorContainer;\n    while (parentElement && parentElement.id !== EDITABLE_INPUT_ID) {\n      const textFormat = TEXT_FORMAT_BY_TAG_NAME[parentElement.tagName];\n      if (textFormat) {\n        selectedFormats[textFormat] = true;\n      }\n\n      parentElement = parentElement.parentElement;\n    }\n\n    setSelectedTextFormats(selectedFormats);\n  }, [isOpen, selectedRange, openLinkControl]);\n\n  function restoreSelection() {\n    if (!selectedRange) {\n      return;\n    }\n\n    const selection = window.getSelection();\n    if (selection) {\n      selection.removeAllRanges();\n      selection.addRange(selectedRange);\n    }\n  }\n\n  const getSelectedText = useCallback(() => {\n    if (!selectedRange) {\n      return undefined;\n    }\n\n    return selectedRange.toString();\n  }, [selectedRange]);\n\n  const getSelectedElement = useCallback(() => {\n    if (!selectedRange) {\n      return undefined;\n    }\n\n    return selectedRange.commonAncestorContainer.parentElement;\n  }, [selectedRange]);\n\n  function updateInputStyles() {\n    const input = linkUrlInputRef.current;\n    if (!input) {\n      return;\n    }\n\n    const { offsetWidth, scrollWidth, scrollLeft } = input;\n    if (scrollWidth <= offsetWidth) {\n      setInputClassName(undefined);\n      return;\n    }\n\n    let className = '';\n    if (scrollLeft < scrollWidth - offsetWidth) {\n      className = 'mask-right';\n    }\n    if (scrollLeft > 0) {\n      className += ' mask-left';\n    }\n\n    setInputClassName(className);\n  }\n\n  function handleLinkUrlChange(e: React.ChangeEvent<HTMLInputElement>) {\n    setLinkUrl(e.target.value);\n    updateInputStyles();\n  }\n\n  function getFormatButtonClassName(key: keyof ISelectedTextFormats) {\n    if (selectedTextFormats[key]) {\n      return 'active';\n    }\n\n    if (key === 'monospace' || key === 'strikethrough') {\n      if (Object.keys(selectedTextFormats).some(\n        (fKey) => fKey !== key && !!selectedTextFormats[fKey as keyof ISelectedTextFormats],\n      )) {\n        return 'disabled';\n      }\n    } else if (selectedTextFormats.monospace || selectedTextFormats.strikethrough) {\n      return 'disabled';\n    }\n\n    return undefined;\n  }\n\n  const handleBoldText = useCallback(() => {\n    setSelectedTextFormats((selectedFormats) => {\n      // Somehow re-applying 'bold' command to already bold text doesn't work\n      document.execCommand(selectedFormats.bold ? 'removeFormat' : 'bold');\n      Object.keys(selectedFormats).forEach((key) => {\n        if ((key === 'italic' || key === 'underline') && !!selectedFormats[key]) {\n          document.execCommand(key);\n        }\n      });\n\n      return {\n        ...selectedFormats,\n        bold: !selectedFormats.bold,\n      };\n    });\n  }, []);\n\n  const handleItalicText = useCallback(() => {\n    document.execCommand('italic');\n    setSelectedTextFormats((selectedFormats) => ({\n      ...selectedFormats,\n      italic: !selectedFormats.italic,\n    }));\n  }, []);\n\n  const handleUnderlineText = useCallback(() => {\n    document.execCommand('underline');\n    setSelectedTextFormats((selectedFormats) => ({\n      ...selectedFormats,\n      underline: !selectedFormats.underline,\n    }));\n  }, []);\n\n  const handleStrikethroughText = useCallback(() => {\n    if (selectedTextFormats.strikethrough) {\n      const element = getSelectedElement();\n      if (\n        !selectedRange\n        || !element\n        || element.tagName !== 'DEL'\n        || !element.textContent\n      ) {\n        return;\n      }\n\n      element.replaceWith(element.textContent);\n      setSelectedTextFormats((selectedFormats) => ({\n        ...selectedFormats,\n        strikethrough: false,\n      }));\n\n      return;\n    }\n\n    const text = getSelectedText();\n    document.execCommand('insertHTML', false, `<del>${text}</del>`);\n    onClose();\n  }, [\n    getSelectedElement, getSelectedText, onClose,\n    selectedRange, selectedTextFormats.strikethrough,\n  ]);\n\n  const handleMonospaceText = useCallback(() => {\n    if (selectedTextFormats.monospace) {\n      const element = getSelectedElement();\n      if (\n        !selectedRange\n        || !element\n        || element.tagName !== 'CODE'\n        || !element.textContent\n      ) {\n        return;\n      }\n\n      element.replaceWith(element.textContent);\n      setSelectedTextFormats((selectedFormats) => ({\n        ...selectedFormats,\n        monospace: false,\n      }));\n      return;\n    }\n\n    const text = getSelectedText();\n    document.execCommand('insertHTML', false, `<code class=\"text-entity-code\">${text}</code>`);\n    onClose();\n  }, [\n    getSelectedElement, getSelectedText, onClose,\n    selectedRange, selectedTextFormats.monospace,\n  ]);\n\n  function handleLinkUrlConfirm() {\n    const formattedLinkUrl = linkUrl.includes('://') ? linkUrl : `http://${linkUrl}`;\n\n    if (isEditingLink) {\n      const element = getSelectedElement();\n      if (!element || element.tagName !== 'A') {\n        return;\n      }\n\n      (element as HTMLAnchorElement).href = formattedLinkUrl;\n\n      onClose();\n      return;\n    }\n\n    const text = getSelectedText();\n    restoreSelection();\n    document.execCommand('insertHTML', false, `<a href=${formattedLinkUrl} class=\"text-entity-link\">${text}</a>`);\n    onClose();\n  }\n\n  const handleKeyDown = useCallback((e: KeyboardEvent) => {\n    const HANDLERS_BY_KEY_CODE: Record<string, AnyToVoidFunction> = {\n      KeyK: openLinkControl,\n      KeyB: handleBoldText,\n      KeyU: handleUnderlineText,\n      KeyI: handleItalicText,\n      KeyM: handleMonospaceText,\n      KeyS: handleStrikethroughText,\n    };\n\n    const handler = HANDLERS_BY_KEY_CODE[e.code];\n\n    if (\n      e.altKey\n      || !(e.ctrlKey || e.metaKey)\n      || !handler\n    ) {\n      return;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n    handler();\n  }, [\n    handleBoldText, handleItalicText, handleUnderlineText,\n    handleMonospaceText, handleStrikethroughText,\n    openLinkControl,\n  ]);\n\n  useEffect(() => {\n    if (isOpen) {\n      document.addEventListener('keydown', handleKeyDown);\n    }\n\n    return () => document.removeEventListener('keydown', handleKeyDown);\n  }, [isOpen, handleKeyDown]);\n\n  const lang = useLang();\n\n  function handleContainerKeyDown(e: React.KeyboardEvent<HTMLDivElement>) {\n    if (e.key === 'Enter' && isLinkControlOpen) {\n      handleLinkUrlConfirm();\n      e.preventDefault();\n    }\n  }\n\n  if (!shouldRender) {\n    return undefined;\n  }\n\n  const className = buildClassName(\n    'TextFormatter',\n    transitionClassNames,\n    isLinkControlOpen && 'link-control-shown',\n  );\n\n  const linkUrlConfirmClassName = buildClassName(\n    'TextFormatter-link-url-confirm',\n    !!linkUrl.length && 'shown',\n  );\n\n  const style = anchorPosition\n    ? `left: ${anchorPosition.x}px; top: ${anchorPosition.y}px;--text-formatter-left: ${anchorPosition.x}px;`\n    : '';\n\n  return (\n    <div\n      ref={containerRef}\n      className={className}\n      // @ts-ignore Teact feature\n      style={style}\n      onKeyDown={handleContainerKeyDown}\n    >\n      <div className=\"TextFormatter-buttons\">\n        <Button\n          color=\"translucent\"\n          ariaLabel=\"Bold text\"\n          className={getFormatButtonClassName('bold')}\n          onClick={handleBoldText}\n        >\n          <i className=\"icon-bold\" />\n        </Button>\n        <Button\n          color=\"translucent\"\n          ariaLabel=\"Italic text\"\n          className={getFormatButtonClassName('italic')}\n          onClick={handleItalicText}\n        >\n          <i className=\"icon-italic\" />\n        </Button>\n        <Button\n          color=\"translucent\"\n          ariaLabel=\"Underlined text\"\n          className={getFormatButtonClassName('underline')}\n          onClick={handleUnderlineText}\n        >\n          <i className=\"icon-underlined\" />\n        </Button>\n        <Button\n          color=\"translucent\"\n          ariaLabel=\"Strikethrough text\"\n          className={getFormatButtonClassName('strikethrough')}\n          onClick={handleStrikethroughText}\n        >\n          <i className=\"icon-strikethrough\" />\n        </Button>\n        <Button\n          color=\"translucent\"\n          ariaLabel=\"Monospace text\"\n          className={getFormatButtonClassName('monospace')}\n          onClick={handleMonospaceText}\n        >\n          <i className=\"icon-monospace\" />\n        </Button>\n        <div className=\"TextFormatter-divider\" />\n        <Button color=\"translucent\" ariaLabel={lang('TextFormat.AddLinkTitle')} onClick={openLinkControl}>\n          <i className=\"icon-link\" />\n        </Button>\n      </div>\n\n      <div className=\"TextFormatter-link-control\">\n        <div className=\"TextFormatter-buttons\">\n          <Button color=\"translucent\" ariaLabel={lang('Cancel')} onClick={closeLinkControl}>\n            <i className=\"icon-arrow-left\" />\n          </Button>\n          <div className=\"TextFormatter-divider\" />\n\n          <div\n            className={buildClassName('TextFormatter-link-url-input-wrapper', inputClassName)}\n          >\n            <input\n              ref={linkUrlInputRef}\n              className=\"TextFormatter-link-url-input\"\n              type=\"text\"\n              value={linkUrl}\n              placeholder=\"Enter URL...\"\n              autoComplete=\"off\"\n              inputMode=\"url\"\n              onChange={handleLinkUrlChange}\n              onScroll={updateInputStyles}\n            />\n          </div>\n\n          <div className={linkUrlConfirmClassName}>\n            <div className=\"TextFormatter-divider\" />\n            <Button\n              color=\"translucent\"\n              ariaLabel={lang('Save')}\n              className=\"color-primary\"\n              onClick={handleLinkUrlConfirm}\n            >\n              <i className=\"icon-check\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default memo(TextFormatter);\n","import React, { FC, memo, useCallback } from '../../lib/teact/teact';\n\nimport { ApiMessage } from '../../api/types';\n\nimport { formatMediaDuration } from '../../util/dateFormat';\nimport {\n  getMessageMediaHash,\n  getMessageMediaThumbDataUri,\n  getMessageVideo,\n} from '../../modules/helpers';\nimport useMedia from '../../hooks/useMedia';\nimport useTransitionForMedia from '../../hooks/useTransitionForMedia';\n\nimport './Media.scss';\n\ntype OwnProps = {\n  message: ApiMessage;\n  idPrefix?: string;\n  onClick?: (messageId: number, chatId: number) => void;\n};\n\nconst Media: FC<OwnProps> = ({ message, idPrefix = 'shared-media', onClick }) => {\n  const handleClick = useCallback(() => {\n    onClick!(message.id, message.chatId);\n  }, [message.id, message.chatId, onClick]);\n\n  const thumbDataUri = getMessageMediaThumbDataUri(message);\n  const mediaBlobUrl = useMedia(getMessageMediaHash(message, 'pictogram'));\n  const {\n    shouldRenderThumb, shouldRenderFullMedia, transitionClassNames,\n  } = useTransitionForMedia(mediaBlobUrl, 'slow');\n\n  const video = getMessageVideo(message);\n\n  return (\n    <div id={`${idPrefix}${message.id}`} className=\"Media scroll-item\" onClick={onClick ? handleClick : undefined}>\n      {shouldRenderThumb && (\n        <img src={thumbDataUri} alt=\"\" />\n      )}\n      {shouldRenderFullMedia && (\n        <img src={mediaBlobUrl} className={`${transitionClassNames} full-media`} alt=\"\" />\n      )}\n      {video && <span className=\"video-duration\">{video.isGif ? 'GIF' : formatMediaDuration(video.duration)}</span>}\n    </div>\n  );\n};\n\nexport default memo(Media);\n","import React, {\n  FC, memo, useCallback, useEffect, useMemo, useRef, useState,\n} from '../../lib/teact/teact';\nimport { withGlobal } from '../../lib/teact/teactn';\n\nimport {\n  ApiAudio, ApiMessage, ApiVoice,\n} from '../../api/types';\nimport { ISettings } from '../../types';\n\nimport { IS_MOBILE_SCREEN } from '../../util/environment';\nimport { formatMediaDateTime, formatMediaDuration, formatPastTimeShort } from '../../util/dateFormat';\nimport {\n  getMediaDuration,\n  getMediaTransferState,\n  getMessageKey,\n  getMessageMediaFormat,\n  getMessageMediaHash,\n  isMessageLocal,\n  isOwnMessage,\n} from '../../modules/helpers';\nimport { renderWaveformToDataUri } from './helpers/waveform';\nimport buildClassName from '../../util/buildClassName';\nimport renderText from './helpers/renderText';\nimport { decodeWaveform, interpolateArray } from '../../util/waveform';\nimport useMediaWithDownloadProgress from '../../hooks/useMediaWithDownloadProgress';\nimport useShowTransition from '../../hooks/useShowTransition';\nimport useBuffering from '../../hooks/useBuffering';\nimport useAudioPlayer from '../../hooks/useAudioPlayer';\nimport useLang from '../../hooks/useLang';\n\nimport Button from '../ui/Button';\nimport ProgressSpinner from '../ui/ProgressSpinner';\nimport Link from '../ui/Link';\n\nimport './Audio.scss';\n\ntype OwnProps = {\n  message: ApiMessage;\n  senderTitle?: string;\n  uploadProgress?: number;\n  renderingFor?: 'searchResult' | 'sharedMedia';\n  date?: number;\n  lastSyncTime?: number;\n  className?: string;\n  isSelectable?: boolean;\n  isSelected?: boolean;\n  onPlay: (messageId: number, chatId: number) => void;\n  onReadMedia?: () => void;\n  onCancelUpload?: () => void;\n  onDateClick?: (messageId: number, chatId: number) => void;\n};\n\ntype StateProps = {\n  theme: ISettings['theme'];\n};\n\ninterface ISeekMethods {\n  handleStartSeek: (e: React.MouseEvent<HTMLElement>) => void;\n  handleSeek: (e: React.MouseEvent<HTMLElement>) => void;\n  handleStopSeek: () => void;\n}\n\nconst AVG_VOICE_DURATION = 30;\nconst MIN_SPIKES = IS_MOBILE_SCREEN ? 20 : 25;\nconst MAX_SPIKES = IS_MOBILE_SCREEN ? 50 : 75;\n// This is needed for browsers requiring user interaction before playing.\nconst PRELOAD = true;\n\nconst Audio: FC<OwnProps & StateProps> = ({\n  theme,\n  message,\n  senderTitle,\n  uploadProgress,\n  renderingFor,\n  date,\n  lastSyncTime,\n  className,\n  isSelectable,\n  isSelected,\n  onPlay,\n  onReadMedia,\n  onCancelUpload,\n  onDateClick,\n}) => {\n  const { content: { audio, voice }, isMediaUnread } = message;\n  const isVoice = Boolean(voice);\n  const isSeeking = useRef<boolean>(false);\n\n  const [isActivated, setIsActivated] = useState(false);\n  const shouldDownload = (isActivated || PRELOAD) && lastSyncTime;\n\n  const { mediaData, downloadProgress } = useMediaWithDownloadProgress(\n    getMessageMediaHash(message, 'inline'),\n    !shouldDownload,\n    getMessageMediaFormat(message, 'inline'),\n  );\n\n  function handleForcePlay() {\n    setIsActivated(true);\n    onPlay(message.id, message.chatId);\n  }\n\n  const {\n    isBuffered, bufferedProgress, bufferingHandlers, checkBuffering,\n  } = useBuffering();\n\n  const {\n    isPlaying, playProgress, playPause, setCurrentTime, duration,\n  } = useAudioPlayer(\n    getMessageKey(message),\n    getMediaDuration(message)!,\n    mediaData,\n    bufferingHandlers,\n    checkBuffering,\n    isActivated,\n    handleForcePlay,\n    isMessageLocal(message),\n  );\n\n  useEffect(() => {\n    setIsActivated(isPlaying);\n  }, [isPlaying]);\n\n  const {\n    isUploading, isTransferring, transferProgress,\n  } = getMediaTransferState(message, uploadProgress || downloadProgress, isActivated && !isBuffered);\n\n  const {\n    shouldRender: shouldRenderSpinner,\n    transitionClassNames: spinnerClassNames,\n  } = useShowTransition(isTransferring);\n\n  const handleButtonClick = useCallback(() => {\n    if (isUploading) {\n      if (onCancelUpload) {\n        onCancelUpload();\n      }\n\n      return;\n    }\n\n    if (!isPlaying) {\n      onPlay(message.id, message.chatId);\n    }\n\n    setIsActivated(!isActivated);\n    playPause();\n  }, [isPlaying, isUploading, message.id, message.chatId, onCancelUpload, onPlay, playPause, isActivated]);\n\n  useEffect(() => {\n    if (isPlaying && onReadMedia && isMediaUnread) {\n      onReadMedia();\n    }\n  }, [isPlaying, isMediaUnread, onReadMedia]);\n\n  const handleSeek = useCallback((e: React.MouseEvent<HTMLElement>) => {\n    if (isSeeking.current) {\n      const seekBar = e.currentTarget.closest('.seekline,.waveform');\n      if (seekBar) {\n        const { width, left } = seekBar.getBoundingClientRect();\n        setCurrentTime(duration * ((e.clientX - left) / width));\n      }\n    }\n  }, [duration, setCurrentTime]);\n\n  const handleStartSeek = useCallback((e: React.MouseEvent<HTMLElement>) => {\n    isSeeking.current = true;\n    handleSeek(e);\n  }, [handleSeek]);\n\n  const handleStopSeek = useCallback(() => {\n    isSeeking.current = false;\n  }, []);\n\n  const handleDateClick = useCallback(() => {\n    onDateClick!(message.id, message.chatId);\n  }, [onDateClick, message.id, message.chatId]);\n\n  useLang();\n\n  function getFirstLine() {\n    if (isVoice) {\n      return senderTitle || 'Voice';\n    }\n\n    const { title, fileName } = audio!;\n\n    return title || fileName;\n  }\n\n  function getSecondLine() {\n    if (isVoice) {\n      return formatMediaDuration(voice!.duration);\n    }\n\n    const { performer } = audio!;\n\n    return (\n      <>\n        {performer && renderText(performer)}\n        {performer && senderTitle && <span>&bull;</span>}\n        {senderTitle && renderText(senderTitle)}\n      </>\n    );\n  }\n\n  const seekHandlers = { handleStartSeek, handleSeek, handleStopSeek };\n  const isOwn = isOwnMessage(message);\n  const renderedWaveform = useMemo(\n    () => voice && renderWaveform(voice, playProgress, isOwn, seekHandlers, theme),\n    [voice, playProgress, isOwn, seekHandlers, theme],\n  );\n\n  const fullClassName = buildClassName(\n    'Audio media-inner',\n    className,\n    isOwn && !renderingFor && 'own',\n    renderingFor && 'bigger',\n    isSelected && 'audio-is-selected',\n  );\n\n  const buttonClassNames = ['toggle-play'];\n  if (shouldRenderSpinner) {\n    buttonClassNames.push('loading');\n  } else if (isPlaying) {\n    buttonClassNames.push('pause');\n  } else if (!isPlaying) {\n    buttonClassNames.push('play');\n  }\n\n  const showSeekline = isPlaying || (playProgress > 0 && playProgress < 1);\n  const contentClassName = buildClassName('content', showSeekline && 'with-seekline');\n\n  function renderSearchResult() {\n    return (\n      <>\n        <div className={contentClassName}>\n          <div className=\"content-row\">\n            <p className=\"title\">{renderText(getFirstLine())}</p>\n\n            <div className=\"message-date\">\n              {date && (\n                <Link\n                  className=\"date\"\n                  onClick={handleDateClick}\n                >\n                  {formatPastTimeShort(date * 1000)}\n                </Link>\n              )}\n            </div>\n          </div>\n\n          {showSeekline && renderSeekline(playProgress, bufferedProgress, seekHandlers)}\n          {!showSeekline && (\n            <p className=\"duration\">\n              {playProgress > 0 ? `${formatMediaDuration(duration * playProgress)} / ` : undefined}\n              {getSecondLine()}\n            </p>\n          )}\n        </div>\n      </>\n    );\n  }\n\n  return (\n    <div className={fullClassName}>\n      {isSelectable && (\n        <div className=\"message-select-control\">\n          {isSelected && <i className=\"icon-select\" />}\n        </div>\n      )}\n      <Button\n        round\n        ripple={!IS_MOBILE_SCREEN}\n        size={renderingFor ? 'smaller' : 'tiny'}\n        className={buttonClassNames.join(' ')}\n        ariaLabel={isPlaying ? 'Pause audio' : 'Play audio'}\n        onClick={handleButtonClick}\n      >\n        <i className=\"icon-play\" />\n        <i className=\"icon-pause\" />\n      </Button>\n      {shouldRenderSpinner && (\n        <div className={buildClassName('media-loading', spinnerClassNames)}>\n          <ProgressSpinner\n            progress={transferProgress}\n            transparent\n            size={renderingFor ? 'm' : 's'}\n            onClick={handleButtonClick}\n          />\n        </div>\n      )}\n      {renderingFor === 'searchResult' && renderSearchResult()}\n      {renderingFor !== 'searchResult' && audio && renderAudio(\n        audio, isPlaying, playProgress, bufferedProgress, seekHandlers, date,\n        onDateClick ? handleDateClick : undefined,\n      )}\n      {renderingFor !== 'searchResult' && voice && renderVoice(voice, renderedWaveform, isMediaUnread)}\n    </div>\n  );\n};\n\nfunction renderAudio(\n  audio: ApiAudio,\n  isPlaying: boolean,\n  playProgress: number,\n  bufferedProgress: number,\n  seekHandlers: ISeekMethods,\n  date?: number,\n  handleDateClick?: () => void,\n) {\n  const {\n    title, performer, duration, fileName,\n  } = audio;\n  const showSeekline = isPlaying || (playProgress > 0 && playProgress < 1);\n\n  return (\n    <div className=\"content\">\n      <p className=\"title\">{renderText(title || fileName)}</p>\n      {showSeekline && renderSeekline(playProgress, bufferedProgress, seekHandlers)}\n      {!showSeekline && (\n        <div className=\"meta\">\n          <span className=\"performer\">{renderText(performer || 'Unknown')}</span>\n          {date && (\n            <>\n              {' '}\n              &bull;\n              {' '}\n              <Link className=\"date\" onClick={handleDateClick}>{formatMediaDateTime(date * 1000)}</Link>\n            </>\n          )}\n        </div>\n      )}\n      <p className=\"duration\">\n        {playProgress > 0 ? `${formatMediaDuration(duration * playProgress)} / ` : undefined}\n        {formatMediaDuration(duration)}\n      </p>\n    </div>\n  );\n}\n\nfunction renderVoice(voice: ApiVoice, renderedWaveform: any, isMediaUnread?: boolean) {\n  return (\n    <div className=\"content\">\n      {renderedWaveform}\n      <p className=\"voice-duration\">\n        {formatMediaDuration(voice.duration)}\n        {isMediaUnread && <span>&bull;</span>}\n      </p>\n    </div>\n  );\n}\n\nfunction renderWaveform(\n  voice: ApiVoice,\n  playProgress = 0,\n  isOwn = false,\n  { handleStartSeek, handleSeek, handleStopSeek }: ISeekMethods,\n  theme: ISettings['theme'],\n) {\n  const { waveform, duration } = voice;\n\n  if (!waveform) {\n    return undefined;\n  }\n\n  const fillColor = theme === 'dark' ? '#494B75' : '#CBCBCB';\n  const fillOwnColor = theme === 'dark' ? '#C69C85' : '#B0DEA6';\n  const progressFillColor = theme === 'dark' ? '#868DF5' : '#54a3e6';\n  const progressFillOwnColor = theme === 'dark' ? '#FFFFFF' : '#53ad53';\n  const durationFactor = Math.min(duration / AVG_VOICE_DURATION, 1);\n  const spikesCount = Math.round(MIN_SPIKES + (MAX_SPIKES - MIN_SPIKES) * durationFactor);\n  const decodedWaveform = decodeWaveform(new Uint8Array(waveform));\n  const { data: spikes, peak } = interpolateArray(decodedWaveform, spikesCount);\n  const { src, width, height } = renderWaveformToDataUri(spikes, playProgress, {\n    peak,\n    fillStyle: isOwn ? fillOwnColor : fillColor,\n    progressFillStyle: isOwn ? progressFillOwnColor : progressFillColor,\n  });\n\n  return (\n    // eslint-disable-next-line jsx-a11y/no-noninteractive-element-interactions\n    <img\n      src={src}\n      alt=\"\"\n      width={width}\n      height={height}\n      className=\"waveform\"\n      draggable={false}\n      onMouseDown={handleStartSeek}\n      onMouseMove={handleSeek}\n      onMouseUp={handleStopSeek}\n    />\n  );\n}\n\nfunction renderSeekline(\n  playProgress: number,\n  bufferedProgress: number,\n  { handleStartSeek, handleSeek, handleStopSeek }: ISeekMethods,\n) {\n  return (\n    <div\n      className=\"seekline no-selection\"\n      onMouseDown={handleStartSeek}\n      onMouseMove={handleSeek}\n      onMouseUp={handleStopSeek}\n    >\n      <span className=\"seekline-buffered-progress\">\n        <i\n          // @ts-ignore\n          style={`transform: translateX(${bufferedProgress * 100}%)`}\n        />\n      </span>\n      <span className=\"seekline-play-progress\">\n        <i\n          // @ts-ignore\n          style={`transform: translateX(${playProgress * 100}%)`}\n        />\n      </span>\n      <span className=\"seekline-thumb\">\n        <i\n          // @ts-ignore\n          style={`transform: translateX(${playProgress * 100}%)`}\n        />\n      </span>\n    </div>\n  );\n}\n\nexport default memo(withGlobal<OwnProps>((global) => ({ theme: global.settings.byKey.theme }))(Audio));\n","/* eslint-disable no-bitwise */\n\n// eslint-disable-next-line max-len\n// Ref: https://github.com/telegramdesktop/tdesktop/blob/0743e71ab6b928d2ee5bae1aed991849b1e2b291/Telegram/SourceFiles/data/data_document.cpp#L1018\nexport function decodeWaveform(encoded5bit: Uint8Array) {\n  const bitsCount = encoded5bit.length * 8;\n  const valuesCount = Math.floor(bitsCount / 5);\n  if (!valuesCount) {\n    return [];\n  }\n\n  // Read each 5 bit of encoded5bit as 0-31 unsigned char.\n  // We count the index of the byte in which the desired 5-bit sequence starts.\n  // And then we read a uint16 starting from that byte to guarantee to get all of those 5 bits.\n  //\n  // BUT! if it is the last byte we have, we're not allowed to read a uint16 starting with it.\n  // Because it will be an overflow (we'll access one byte after the available memory).\n  // We see, that only the last 5 bits could start in the last available byte and be problematic.\n  // So we read in a general way all the entries in a general way except the last one.\n  const result = Array(valuesCount);\n  const bitsData = encoded5bit;\n  for (let i = 0, l = valuesCount - 1; i !== l; ++i) {\n    const byteIndex = Math.floor((i * 5) / 8);\n    const bitShift = Math.floor((i * 5) % 8);\n    const value = bitsData[byteIndex] + (bitsData[byteIndex + 1] << 8);\n    result[i] = ((value >> bitShift) & 0x1F);\n  }\n  const lastByteIndex = Math.floor(((valuesCount - 1) * 5) / 8);\n  const lastBitShift = Math.floor(((valuesCount - 1) * 5) % 8);\n  const lastValue = bitsData[lastByteIndex] + (bitsData[lastByteIndex + 1] << 8);\n  result[valuesCount - 1] = (lastValue >> lastBitShift) & 0x1F;\n\n  return result;\n}\n\nexport function interpolateArray(data: number[], fitCount: number) {\n  let peak = 0;\n  const newData = new Array(fitCount);\n  const springFactor = data.length / fitCount;\n  const leftFiller = data[0];\n  const rightFiller = data[data.length - 1];\n  for (let i = 0; i < fitCount; i++) {\n    const idx = Math.floor(i * springFactor);\n    const val = ((data[idx - 1] ?? leftFiller) + (data[idx] ?? leftFiller) + (data[idx + 1] ?? rightFiller)) / 3;\n    newData[i] = val;\n    if (peak < val) {\n      peak = val;\n    }\n  }\n  return { data: newData, peak };\n}\n","type IWaveformProps = {\n  peak: number;\n  fillStyle: string;\n  progressFillStyle: string;\n};\n\nconst SPIKE_WIDTH = 2;\nconst SPIKE_STEP = 4;\nconst SPIKE_RADIUS = 1;\nconst HEIGHT = 23;\n\nexport function renderWaveformToDataUri(\n  spikes: number[],\n  progress: number,\n  {\n    peak, fillStyle, progressFillStyle,\n  }: IWaveformProps,\n) {\n  const width = spikes.length * SPIKE_STEP;\n  const height = HEIGHT;\n\n  const canvas = document.createElement('canvas');\n  canvas.width = width * 2;\n  canvas.height = height * 2;\n  canvas.style.width = `${width}px`;\n  canvas.style.height = `${height}px`;\n\n  const ctx = canvas.getContext('2d')!;\n  ctx.scale(2, 2);\n\n  spikes.forEach((item, i) => {\n    ctx.globalAlpha = (i / spikes.length >= progress) ? 0.5 : 1;\n    ctx.fillStyle = progress > i / spikes.length ? progressFillStyle : fillStyle;\n    const spikeHeight = Math.max(2, HEIGHT * (item / Math.max(1, peak)));\n    roundedRectangle(ctx, i * SPIKE_STEP, height, SPIKE_WIDTH, spikeHeight, SPIKE_RADIUS);\n    ctx.fill();\n  });\n\n  return {\n    src: canvas.toDataURL(),\n    width,\n    height,\n  };\n}\n\nfunction roundedRectangle(\n  ctx: CanvasRenderingContext2D, x: number, y: number, width: number, height: number, radius: number,\n) {\n  if (width < 2 * radius) {\n    radius = width / 2;\n  }\n  if (height < 2 * radius) {\n    radius = height / 2;\n  }\n\n  ctx.beginPath();\n  ctx.moveTo(x + radius, y);\n  ctx.arcTo(x + width, y, x + width, y - height, radius);\n  ctx.arcTo(x + width, y - height, x, y - height, radius);\n  ctx.arcTo(x, y - height, x, y, radius);\n  ctx.arcTo(x, y, x + width, y, radius);\n  ctx.closePath();\n}\n","import React, {\n  FC, useLayoutEffect, useRef, memo,\n} from '../../lib/teact/teact';\n\nimport buildClassName from '../../util/buildClassName';\n\nimport './Tab.scss';\n\ntype OwnProps = {\n  className?: string;\n  title: string;\n  active?: boolean;\n  badgeCount?: number;\n  isBadgeActive?: boolean;\n  previousActiveTab?: number;\n  onClick: (arg: number) => void;\n  clickArg: number;\n};\n\nconst Tab: FC<OwnProps> = ({\n  className,\n  title,\n  active,\n  badgeCount,\n  isBadgeActive,\n  previousActiveTab,\n  onClick,\n  clickArg,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const tabRef = useRef<HTMLButtonElement>(null);\n\n  useLayoutEffect(() => {\n    if (!active || previousActiveTab === undefined) {\n      return;\n    }\n\n    const tab = tabRef.current!;\n    const indicator = tab.querySelector('i')!;\n    const currentIndicator = tab.parentElement!.children[previousActiveTab].querySelector('i')!;\n\n    currentIndicator.classList.remove('animate');\n    indicator.classList.remove('animate');\n\n    // We move and resize our indicator so it repeats the position and size of the previous one.\n    const shiftLeft = currentIndicator.parentElement!.offsetLeft - indicator.parentElement!.offsetLeft;\n    const scaleFactor = currentIndicator.clientWidth / indicator.clientWidth;\n    indicator.style.transform = `translate3d(${shiftLeft}px, 0, 0) scale3d(${scaleFactor}, 1, 1)`;\n\n    // 3 AFs needed here to synchronize animations with Transition component\n    requestAnimationFrame(() => {\n      requestAnimationFrame(() => {\n        requestAnimationFrame(() => {\n          // Now we remove the transform to let it animate to its own position and size.\n          indicator.classList.add('animate');\n          indicator.style.transform = 'none';\n        });\n      });\n    });\n  }, [active, previousActiveTab]);\n\n  return (\n    <button\n      type=\"button\"\n      className={buildClassName('Tab', className, active && 'active')}\n      onClick={() => onClick(clickArg)}\n      ref={tabRef}\n    >\n      <span>\n        {title}\n        {!!badgeCount && (\n          <span className={buildClassName('badge', isBadgeActive && 'active')}>{badgeCount}</span>\n        )}\n        <i />\n      </span>\n    </button>\n  );\n};\n\nexport default memo(Tab);\n","import React, {\n  FC, memo, useRef, useEffect,\n} from '../../lib/teact/teact';\n\nimport fastSmoothScrollHorizontal from '../../util/fastSmoothScrollHorizontal';\nimport usePrevious from '../../hooks/usePrevious';\nimport useHorizontalScroll from '../../hooks/useHorizontalScroll';\nimport useLang from '../../hooks/useLang';\n\nimport Tab from './Tab';\n\nimport './TabList.scss';\n\nexport type TabWithProperties = {\n  title: string;\n  badgeCount?: number;\n  isBadgeActive?: boolean;\n};\n\ntype OwnProps = {\n  tabs: readonly TabWithProperties[];\n  activeTab: number;\n  big?: boolean;\n  onSwitchTab: (index: number) => void;\n};\n\nconst TAB_SCROLL_THRESHOLD_PX = 16;\n\nconst TabList: FC<OwnProps> = ({\n  tabs, activeTab, big, onSwitchTab,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const containerRef = useRef<HTMLDivElement>(null);\n  const previousActiveTab = usePrevious(activeTab);\n\n  useHorizontalScroll(containerRef);\n\n  // Scroll container to place active tab in the center\n  useEffect(() => {\n    const container = containerRef.current!;\n    if (container.scrollWidth <= container.offsetWidth) {\n      return;\n    }\n\n    const activeTabElement = container.querySelector('.Tab.active') as HTMLElement | null;\n    if (activeTabElement) {\n      const newLeft = activeTabElement.offsetLeft - (container.offsetWidth / 2) + (activeTabElement.offsetWidth / 2);\n\n      // Prevent scrolling by only a couple of pixels, which doesn't look smooth\n      if (Math.abs(newLeft - container.scrollLeft) < TAB_SCROLL_THRESHOLD_PX) {\n        return;\n      }\n\n      fastSmoothScrollHorizontal(container, newLeft);\n    }\n  }, [activeTab]);\n\n  const lang = useLang();\n\n  return (\n    <div className={`TabList no-selection no-scrollbar ${big ? 'big' : ''}`} ref={containerRef}>\n      {tabs.map((tab, i) => (\n        <Tab\n          key={tab.title}\n          title={lang(tab.title)}\n          active={i === activeTab}\n          badgeCount={tab.badgeCount}\n          isBadgeActive={tab.isBadgeActive}\n          previousActiveTab={previousActiveTab}\n          onClick={onSwitchTab}\n          clickArg={i}\n        />\n      ))}\n    </div>\n  );\n};\n\nexport default memo(TabList);\n","import { ApiError } from '../api/types';\n\nconst READABLE_ERROR_MESSAGES: Record<string, string> = {\n  CHAT_RESTRICTED: 'You can\\'t send messages in this chat, you were restricted',\n  CHAT_WRITE_FORBIDDEN: 'You can\\'t write in this chat',\n  CHAT_SEND_POLL_FORBIDDEN: 'You can\\'t create polls in this chat',\n  CHAT_SEND_STICKERS_FORBIDDEN: 'You can\\'t send stickers in this chat',\n  CHAT_SEND_GIFS_FORBIDDEN: 'You can\\'t send gifs in this chat',\n  CHAT_SEND_MEDIA_FORBIDDEN: 'You can\\'t send media in this chat',\n  CHAT_LINK_EXISTS: 'The chat is public, you can\\'t hide the history to new users',\n  // eslint-disable-next-line max-len\n  SLOWMODE_WAIT_X: 'Slowmode is enabled in this chat: you must wait for the specified number of seconds before sending another message to the chat.',\n  USER_BANNED_IN_CHANNEL: 'You\\'re banned from sending messages in supergroups / channels',\n  USER_IS_BLOCKED: 'You were blocked by this user',\n  YOU_BLOCKED_USER: 'You blocked this user',\n  IMAGE_PROCESS_FAILED: 'Failure while processing image',\n  MEDIA_EMPTY: 'The provided media object is invalid',\n  MEDIA_INVALID: 'Media invalid',\n  PHOTO_EXT_INVALID: 'The extension of the photo is invalid',\n  PHOTO_INVALID_DIMENSIONS: 'The photo dimensions are invalid',\n  PHOTO_SAVE_FILE_INVALID: 'Internal issues, try again later',\n  // eslint-disable-next-line max-len\n  MESSAGE_DELETE_FORBIDDEN: 'You can\\'t delete one of the messages you tried to delete, most likely because it is a service message.',\n  MESSAGE_POLL_CLOSED: 'Poll closed',\n  MESSAGE_EDIT_TIME_EXPIRED: 'You can\\'t edit this message anymore.',\n  CHAT_ADMIN_REQUIRED: 'You must be an admin in this chat to do this',\n  PINNED_DIALOGS_TOO_MUCH: 'Sorry, you can only pin 5 chats to the top',\n  DIALOG_FILTERS_TOO_MUCH: 'Sorry, you can\\'t have more than 10 folders',\n  CHANNEL_PRIVATE: 'This channel is private',\n  MEDIA_CAPTION_TOO_LONG: 'The provided caption is too long',\n  ADDRESS_STREET_LINE1_INVALID: 'The address you provided is not valid',\n  ADDRESS_STREET_LINE2_INVALID: 'The address you provided is not valid',\n  ADDRESS_CITY_INVALID: 'The city you provided is not valid',\n  ADDRESS_COUNTRY_INVALID: 'The country you provided is not valid',\n  ADDRESS_POSTCODE_INVALID: 'The postcode you provided is not valid',\n  ADDRESS_STATE_INVALID: 'The state you provided is not valid',\n  REQ_INFO_NAME_INVALID: 'The name you provided is not valid',\n  REQ_INFO_PHONE_INVALID: 'The phone you provided is not valid',\n  REQ_INFO_EMAIL_INVALID: 'The email you provided is not valid',\n  // TODO Bring back after fixing the weird bug\n  // CHANNEL_INVALID: 'An error occurred. Please try again later',\n  LINK_NOT_MODIFIED: 'This discussion is already linked to the channel',\n\n  // Non-API errors\n  SERVICE_WORKER_DISABLED: 'Service Worker is disabled. Please reload the page without holding <Shift> key.',\n  // eslint-disable-next-line max-len\n  CAPTION_TOO_LONG_PLEASE_REMOVE_CHARACTERS: 'The provided caption is too long. Please remove {EXTRA_CHARS_COUNT} character{PLURAL_S}.',\n  // eslint-disable-next-line max-len\n  FRESH_RESET_AUTHORISATION_FORBIDDEN: 'You can’t logout other sessions if less than 24 hours have passed since you logged on the current session',\n\n  BOTS_TOO_MUCH: 'There are too many bots in this chat/channel',\n  BOT_GROUPS_BLOCKED: 'This bot can\\'t be added to groups',\n  USERS_TOO_MUCH: 'The maximum number of users has been exceeded',\n  USER_CHANNELS_TOO_MUCH: 'One of the users you tried to add is already in too many channels/supergroups',\n  USER_KICKED: 'This user was kicked from this supergroup/channel',\n  USER_NOT_MUTUAL_CONTACT: 'The provided user is not a mutual contact',\n  USER_PRIVACY_RESTRICTED: 'The user\\'s privacy settings do not allow you to do this',\n  INVITE_HASH_EMPTY: 'The invite hash is empty',\n  INVITE_HASH_EXPIRED: 'The invite link has expired',\n  INVITE_HASH_INVALID: 'The invite hash is invalid',\n  CHANNELS_TOO_MUCH: 'You have joined too many channels/supergroups',\n  USER_ALREADY_PARTICIPANT: 'You already in the group',\n};\n\nexport default function getReadableErrorText(error: ApiError) {\n  const { message, isSlowMode, textParams } = error;\n  // Currently Telegram API doesn't return `SLOWMODE_WAIT_X` error as described in the docs\n  if (isSlowMode) {\n    const extraPartIndex = message.indexOf(' (caused by');\n    return extraPartIndex > 0 ? message.substring(0, extraPartIndex) : message;\n  }\n  let errorMessage = READABLE_ERROR_MESSAGES[message];\n  if (errorMessage && textParams) {\n    errorMessage = Object.keys(textParams).reduce((acc, current) => {\n      return acc.replace(current, textParams[current]);\n    }, errorMessage as string);\n  }\n  return errorMessage;\n}\n","import { useMemo } from '../lib/teact/teact';\nimport { getDispatch } from '../lib/teact/teactn';\nimport { ApiChat, ApiUser } from '../api/types';\nimport {\n  isChatArchived, getCanDeleteChat, isChatPrivate, isChatChannel,\n} from '../modules/helpers';\nimport useLang from './useLang';\n\nexport default ({\n  chat,\n  privateChatUser,\n  handleDelete,\n  folderId,\n  isPinned,\n}: {\n  chat: ApiChat | undefined;\n  privateChatUser: ApiUser | undefined;\n  handleDelete: () => void;\n  folderId?: number;\n  isPinned?: boolean;\n}) => {\n  const lang = useLang();\n\n  const {\n    toggleChatPinned,\n    updateChatMutedState,\n    toggleChatArchived,\n    toggleChatUnread,\n  } = getDispatch();\n\n  return useMemo(() => {\n    if (!chat) {\n      return undefined;\n    }\n\n    const isChatWithSelf = privateChatUser && privateChatUser.isSelf;\n\n    const actionUnreadMark = chat.unreadCount || chat.hasUnreadMark\n      ? { title: lang('MarkAsRead'), icon: 'readchats', handler: () => toggleChatUnread({ id: chat.id }) }\n      : { title: lang('MarkAsUnread'), icon: 'unread', handler: () => toggleChatUnread({ id: chat.id }) };\n\n    const actionPin = isPinned\n      ? {\n        title: lang('UnpinFromTop'),\n        icon: 'unpin',\n        handler: () => toggleChatPinned({ id: chat.id, folderId }),\n      }\n      : { title: lang('PinToTop'), icon: 'pin', handler: () => toggleChatPinned({ id: chat.id, folderId }) };\n\n    const actionMute = chat.isMuted\n      ? {\n        title: lang('ChatList.Unmute'),\n        icon: 'unmute',\n        handler: () => updateChatMutedState({ chatId: chat.id, isMuted: false }),\n      }\n      : {\n        title: lang('ChatList.Mute'),\n        icon: 'mute',\n        handler: () => updateChatMutedState({ chatId: chat.id, isMuted: true }),\n      };\n\n    const actionArchive = isChatArchived(chat)\n      ? { title: lang('Unarchive'), icon: 'unarchive', handler: () => toggleChatArchived({ id: chat.id }) }\n      : { title: lang('Archive'), icon: 'archive', handler: () => toggleChatArchived({ id: chat.id }) };\n\n    const actionDelete = {\n      title: isChatPrivate(chat.id)\n        ? lang('Delete')\n        : lang(getCanDeleteChat(chat)\n          ? 'DeleteChat'\n          : (isChatChannel(chat) ? 'LeaveChannel' : 'Group.LeaveGroup')),\n      icon: 'delete',\n      destructive: true,\n      handler: handleDelete,\n    };\n\n    return [\n      actionUnreadMark,\n      actionPin,\n      ...(!isChatWithSelf ? [\n        actionMute,\n        actionArchive,\n      ] : []),\n      actionDelete,\n    ];\n  }, [\n    chat, privateChatUser, lang, isPinned, handleDelete, toggleChatUnread, toggleChatPinned, folderId,\n    updateChatMutedState, toggleChatArchived,\n  ]);\n};\n","import React, { FC, memo } from '../../lib/teact/teact';\n\nimport { ApiMessage, ApiMessageOutgoingStatus } from '../../api/types';\nimport { formatPastTimeShort } from '../../util/dateFormat';\nimport MessageOutgoingStatus from './MessageOutgoingStatus';\nimport './LastMessageMeta.scss';\n\ntype OwnProps = {\n  message: ApiMessage;\n  outgoingStatus?: ApiMessageOutgoingStatus;\n};\n\nconst LastMessageMeta: FC<OwnProps> = ({ message, outgoingStatus }) => {\n  return (\n    <div className=\"LastMessageMeta\">\n      {outgoingStatus && (\n        <MessageOutgoingStatus status={outgoingStatus} />\n      )}\n      <span className=\"time\">{formatPastTimeShort(message.date * 1000)}</span>\n    </div>\n  );\n};\n\nexport default memo(LastMessageMeta);\n","import React, { FC, memo } from '../../lib/teact/teact';\n\nimport { ApiMessageOutgoingStatus } from '../../api/types';\n\nimport Transition from '../ui/Transition';\n\nimport './MessageOutgoingStatus.scss';\n\ntype OwnProps = {\n  status: ApiMessageOutgoingStatus;\n};\n\nenum Keys {\n  failed, pending, succeeded, read,\n}\n\nconst MessageOutgoingStatus: FC<OwnProps> = ({ status }) => {\n  return (\n    <div className=\"MessageOutgoingStatus\">\n      <Transition name=\"reveal\" activeKey={Keys[status]}>\n        {() => (\n          <i className={`icon-message-${status}`} />\n        )}\n      </Transition>\n    </div>\n  );\n};\n\nexport default memo(MessageOutgoingStatus);\n","import { useState, useEffect } from '../lib/teact/teact';\nimport { IAnchorPosition } from '../types';\n\nexport default (\n  anchor: IAnchorPosition | undefined,\n  getTriggerElement: () => HTMLElement | null,\n  getRootElement: () => HTMLElement | null,\n  getMenuElement: () => HTMLElement | null,\n  extraPaddingX = 0,\n  extraTopPadding = 0,\n) => {\n  const [positionX, setPositionX] = useState<'right' | 'left'>('right');\n  const [positionY, setPositionY] = useState<'top' | 'bottom'>('bottom');\n  const [style, setStyle] = useState('');\n\n  useEffect(() => {\n    const triggerEl = getTriggerElement();\n    if (!anchor || !triggerEl) {\n      return;\n    }\n\n    let { x, y } = anchor;\n    const emptyRect = {\n      width: 0, left: 0, height: 0, top: 0,\n    };\n\n    const menuEl = getMenuElement();\n    const rootEl = getRootElement();\n\n    const triggerRect = triggerEl.getBoundingClientRect();\n    const menuRect = menuEl ? { width: menuEl.offsetWidth, height: menuEl.offsetHeight } : emptyRect;\n    const rootRect = rootEl ? rootEl.getBoundingClientRect() : emptyRect;\n\n    if (x + menuRect.width + extraPaddingX < rootRect.width + rootRect.left) {\n      setPositionX('left');\n      x += 3;\n    } else if (x - menuRect.width > 0) {\n      setPositionX('right');\n      x -= 3;\n    } else {\n      setPositionX('left');\n      x = 16;\n    }\n\n    if (y + menuRect.height < rootRect.height + rootRect.top) {\n      setPositionY('top');\n    } else {\n      setPositionY('bottom');\n\n      if (y - menuRect.height < rootRect.top + extraTopPadding) {\n        y = rootRect.top + extraTopPadding + menuRect.height;\n      }\n    }\n\n    setStyle(`left: ${x - triggerRect.left}px; top: ${y - triggerRect.top}px;`);\n  }, [\n    anchor, extraPaddingX, extraTopPadding,\n    getMenuElement, getRootElement, getTriggerElement,\n  ]);\n\n  return {\n    positionX,\n    positionY,\n    style,\n  };\n};\n","import React, { FC, useRef } from '../../lib/teact/teact';\n\nimport useShowTransition from '../../hooks/useShowTransition';\nimport usePrevious from '../../hooks/usePrevious';\nimport buildClassName from '../../util/buildClassName';\n\ntype ChildrenFn = () => any;\n\ntype OwnProps = {\n  isOpen: boolean;\n  isCustom?: boolean;\n  id?: string;\n  className?: string;\n  onClick?: (e: React.MouseEvent<HTMLElement, MouseEvent>) => void;\n  children: ChildrenFn;\n};\n\nconst ShowTransition: FC<OwnProps> = ({\n  isOpen, isCustom, id, className, onClick, children,\n}) => {\n  const { shouldRender, transitionClassNames } = useShowTransition(\n    isOpen, undefined, undefined, isCustom ? false : undefined,\n  );\n  const prevIsOpen = usePrevious(isOpen);\n  const prevChildren = usePrevious(children);\n  const fromChildrenRef = useRef<ChildrenFn>();\n\n  if (prevIsOpen && !isOpen) {\n    fromChildrenRef.current = prevChildren;\n  }\n\n  return (\n    shouldRender && (\n      <div id={id} className={buildClassName(className, transitionClassNames)} onClick={onClick}>\n        {isOpen ? children() : fromChildrenRef.current!()}\n      </div>\n    )\n  );\n};\n\nexport default ShowTransition;\n","import { useRef } from '../lib/teact/teact';\n\nimport usePrevious from './usePrevious';\nimport useForceUpdate from './useForceUpdate';\nimport useOnChange from './useOnChange';\n\nexport default function usePrevDuringAnimation(current: any, duration?: number) {\n  const prev = usePrevious(current, true);\n  const timeoutRef = useRef<number>();\n  const forceUpdate = useForceUpdate();\n  // eslint-disable-next-line no-null/no-null\n  const isCurrentPresent = current !== undefined && current !== null;\n  // eslint-disable-next-line no-null/no-null\n  const isPrevPresent = prev !== undefined && prev !== null;\n\n  if (isCurrentPresent && timeoutRef.current) {\n    clearTimeout(timeoutRef.current);\n    timeoutRef.current = undefined;\n  }\n\n  useOnChange(() => {\n    // When `current` becomes empty\n    if (duration && !isCurrentPresent && isPrevPresent && !timeoutRef.current) {\n      timeoutRef.current = window.setTimeout(() => {\n        timeoutRef.current = undefined;\n        forceUpdate();\n      }, duration);\n    }\n  }, [current]);\n\n  return !timeoutRef.current || !duration || isCurrentPresent ? current : prev;\n}\n","import {\n  useCallback, useEffect, useRef, useState,\n} from '../lib/teact/teact';\n\nimport { register } from '../util/audioPlayer';\nimport useEffectWithPrevDeps from './useEffectWithPrevDeps';\nimport { isSafariPatchInProgress } from '../util/patchSafariProgressiveAudio';\nimport useOnChange from './useOnChange';\n\ntype Handler = (e: Event) => void;\n\nexport default (\n  trackId: string,\n  originalDuration: number, // Sometimes incorrect for voice messages\n  src?: string,\n  handlers?: Record<string, Handler>,\n  onInit?: (element: HTMLAudioElement) => void,\n  shouldPlay = false,\n  onForcePlay?: NoneToVoidFunction,\n  noPlaylist = false,\n) => {\n  // eslint-disable-next-line no-null/no-null\n  const controllerRef = useRef<ReturnType<typeof register>>(null);\n\n  const [isPlaying, setIsPlaying] = useState(false);\n  let isPlayingSync = isPlaying;\n\n  const [playProgress, setPlayProgress] = useState<number>(0);\n\n  useOnChange(() => {\n    controllerRef.current = register(trackId, (eventName, e) => {\n      switch (eventName) {\n        case 'onPlay':\n          setIsPlaying(true);\n          break;\n        case 'onPause':\n          setIsPlaying(false);\n          break;\n        case 'onTimeUpdate': {\n          const { proxy } = controllerRef.current!;\n          const duration = proxy.duration && Number.isFinite(proxy.duration) ? proxy.duration : originalDuration;\n          setPlayProgress(proxy.currentTime / duration);\n          break;\n        }\n      }\n\n      if (handlers && handlers[eventName]) {\n        handlers[eventName](e);\n      }\n    }, onForcePlay);\n\n    const { proxy } = controllerRef.current!;\n\n    if (!isPlaying && !proxy.paused) {\n      setIsPlaying(true);\n      isPlayingSync = true;\n    }\n\n    if (onInit) {\n      onInit(proxy);\n    }\n  }, [trackId]);\n\n  const {\n    play, pause, setCurrentTime, proxy, destroy,\n  } = controllerRef.current!;\n  const duration = proxy.duration && Number.isFinite(proxy.duration) ? proxy.duration : originalDuration;\n\n  // RAF progress\n  useEffect(() => {\n    if (duration && !isSafariPatchInProgress(proxy)) {\n      setPlayProgress(proxy.currentTime / duration);\n    }\n  }, [duration, playProgress, proxy]);\n\n  // Cleanup\n  useEffect(() => () => {\n    destroy(noPlaylist);\n  }, [destroy, noPlaylist]);\n\n  // Autoplay once `src` is present\n  useEffectWithPrevDeps(([prevShouldPlay, prevSrc]) => {\n    if (prevShouldPlay === shouldPlay && src === prevSrc) {\n      return;\n    }\n\n    // When paused by another player\n    if (proxy.src && proxy.paused) {\n      return;\n    }\n\n    if (shouldPlay && src && !isPlaying) {\n      play(src);\n    }\n  }, [shouldPlay, src, isPlaying, play, proxy.src, proxy.paused]);\n\n  const playPause = useCallback(() => {\n    if (isPlaying) {\n      pause();\n    } else if (src) {\n      play(src);\n    }\n  }, [src, pause, play, isPlaying]);\n\n  return {\n    isPlaying: isPlayingSync,\n    playProgress,\n    playPause,\n    setCurrentTime,\n    audioProxy: proxy,\n    duration,\n  };\n};\n","import { IS_SAFARI } from './environment';\nimport safePlay from './safePlay';\nimport { patchSafariProgressiveAudio, isSafariPatchInProgress } from './patchSafariProgressiveAudio';\nimport { getDispatch } from '../lib/teact/teactn';\nimport { parseMessageKey } from '../modules/helpers';\n\ntype Handler = (eventName: string, e: Event) => void;\n\ninterface Track {\n  audio: HTMLAudioElement;\n  proxy: HTMLAudioElement;\n  handlers: Handler[];\n  onForcePlay?: NoneToVoidFunction;\n}\n\nconst tracks = new Map<string, Track>();\nlet queue: string[] = [];\n\nlet currentTrackId: string | undefined;\n\nfunction createAudio(trackId: string, onForcePlay?: NoneToVoidFunction) {\n  const audio = new Audio();\n\n  function handleEvent(eventName: string) {\n    return (e: Event) => {\n      if (!tracks.has(trackId)) {\n        return;\n      }\n\n      if (isSafariPatchInProgress(audio)) {\n        return;\n      }\n\n      tracks.get(trackId)!.handlers.forEach((handler) => {\n        handler(eventName, e);\n      });\n    };\n  }\n\n  audio.addEventListener('timeupdate', handleEvent('onTimeUpdate'));\n  audio.addEventListener('play', handleEvent('onPlay'));\n  audio.addEventListener('pause', handleEvent('onPause'));\n  audio.addEventListener('loadstart', handleEvent('onLoadStart'));\n  audio.addEventListener('loadeddata', handleEvent('onLoadedData'));\n  audio.addEventListener('playing', handleEvent('onPlaying'));\n  audio.addEventListener('ended', () => {\n    if (isSafariPatchInProgress(audio)) {\n      return;\n    }\n\n    const nextTrackId = queue[queue.indexOf(trackId) + 1];\n    if (!nextTrackId) {\n      return;\n    }\n\n    if (!tracks.has(nextTrackId)) {\n      // A bit hacky way to continue playlist when switching chat\n      getDispatch().openAudioPlayer(parseMessageKey(nextTrackId));\n\n      return;\n    }\n\n    const nextTrack = tracks.get(nextTrackId)!;\n\n    if (nextTrack.onForcePlay) {\n      nextTrack.onForcePlay();\n    }\n\n    currentTrackId = nextTrackId;\n\n    if (nextTrack.audio.src) {\n      safePlay(nextTrack.audio);\n    }\n  });\n\n  return {\n    audio,\n    proxy: new Proxy(audio, {\n      get: (origin, key: keyof HTMLAudioElement) => origin[key],\n    }),\n    handlers: [],\n    onForcePlay,\n  };\n}\n\nexport function stopCurrentAudio() {\n  const currentTrack = currentTrackId && tracks.get(currentTrackId);\n  if (currentTrack) {\n    currentTrack.audio.pause();\n  }\n}\n\nexport function register(trackId: string, handler: Handler, onForcePlay?: NoneToVoidFunction) {\n  if (!tracks.has(trackId)) {\n    tracks.set(trackId, createAudio(trackId, onForcePlay));\n\n    if (!queue.includes(trackId)) {\n      queue.push(trackId);\n    }\n  }\n\n  const { audio, proxy, handlers } = tracks.get(trackId)!;\n\n  handlers.push(handler);\n\n  return {\n    play(src: string) {\n      if (currentTrackId && currentTrackId !== trackId) {\n        tracks.get(currentTrackId)!.audio.pause();\n      }\n\n      currentTrackId = trackId;\n\n      if (!audio.src) {\n        audio.src = src;\n        audio.preload = 'auto';\n\n        if (src.includes('/progressive/') && IS_SAFARI) {\n          patchSafariProgressiveAudio(audio);\n        }\n      }\n\n      safePlay(audio);\n    },\n\n    pause() {\n      if (currentTrackId === trackId) {\n        audio.pause();\n      }\n    },\n\n    setCurrentTime(time: number) {\n      if (currentTrackId === trackId) {\n        audio.currentTime = time;\n      }\n    },\n\n    proxy,\n\n    destroy(shouldRemoveFromQueue = false) {\n      const track = tracks.get(trackId);\n      if (!track) {\n        return;\n      }\n\n      track.handlers = track.handlers.filter((h) => h !== handler);\n\n      if (!track.handlers.length) {\n        track.audio.pause();\n        tracks.delete(trackId);\n\n        if (shouldRemoveFromQueue) {\n          queue = queue.filter((id) => id !== trackId);\n        }\n\n        if (trackId === currentTrackId) {\n          currentTrackId = undefined;\n        }\n      }\n    },\n  };\n}\n","export default function download(url: string, filename: string) {\n  const link = document.createElement('a');\n  link.href = url;\n  link.download = filename;\n  link.click();\n}\n","import { RefObject } from 'react';\nimport React, { FC, memo, useRef } from '../../lib/teact/teact';\n\nimport useShowTransition from '../../hooks/useShowTransition';\nimport useTransitionForMedia from '../../hooks/useTransitionForMedia';\nimport buildClassName from '../../util/buildClassName';\nimport { formatMediaDateTime, formatPastTimeShort } from '../../util/dateFormat';\nimport { getColorFromExtension, getFileSizeString } from './helpers/documentInfo';\nimport { getDocumentThumbnailDimensions } from './helpers/mediaDimensions';\nimport renderText from './helpers/renderText';\n\nimport ProgressSpinner from '../ui/ProgressSpinner';\nimport Link from '../ui/Link';\n\nimport './File.scss';\n\ntype OwnProps = {\n  ref?: RefObject<HTMLDivElement>;\n  name: string;\n  extension?: string;\n  size: number;\n  timestamp?: number;\n  sender?: string;\n  thumbnailDataUri?: string;\n  previewData?: string;\n  className?: string;\n  smaller?: boolean;\n  isTransferring?: boolean;\n  isUploading?: boolean;\n  isSelectable?: boolean;\n  isSelected?: boolean;\n  transferProgress?: number;\n  onClick?: () => void;\n  onDateClick?: (e: React.MouseEvent<HTMLAnchorElement>) => void;\n};\n\nconst File: FC<OwnProps> = ({\n  ref,\n  name,\n  size,\n  extension = '',\n  timestamp,\n  sender,\n  thumbnailDataUri,\n  previewData,\n  className,\n  smaller,\n  isTransferring,\n  isUploading,\n  isSelectable,\n  isSelected,\n  transferProgress,\n  onClick,\n  onDateClick,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  let elementRef = useRef<HTMLDivElement>(null);\n  if (ref) {\n    elementRef = ref;\n  }\n\n  const {\n    shouldRender: shouldSpinnerRender,\n    transitionClassNames: spinnerClassNames,\n  } = useShowTransition(isTransferring, undefined, true);\n  const color = getColorFromExtension(extension);\n  const sizeString = getFileSizeString(size);\n\n  const {\n    shouldRenderThumb, shouldRenderFullMedia, transitionClassNames,\n  } = useTransitionForMedia(previewData, 'slow');\n  const { width, height } = getDocumentThumbnailDimensions(smaller);\n\n  const fullClassName = buildClassName(\n    'File',\n    className,\n    smaller && 'smaller',\n    onClick && !isUploading && 'interactive',\n    isSelected && 'file-is-selected',\n  );\n\n  return (\n    <div ref={elementRef} className={fullClassName}>\n      {isSelectable && (\n        <div className=\"message-select-control\">\n          {isSelected && <i className=\"icon-select\" />}\n        </div>\n      )}\n      <div className=\"file-icon-container\" onClick={isUploading ? undefined : onClick}>\n        {thumbnailDataUri || previewData ? (\n          <div className=\"file-preview media-inner\">\n            {shouldRenderThumb && (\n              <img\n                src={thumbnailDataUri}\n                width={width}\n                height={height}\n                className=\"thumbnail\"\n                alt=\"\"\n              />\n            )}\n            {shouldRenderFullMedia && (\n              <img\n                src={previewData}\n                className={`full-media ${transitionClassNames}`}\n                width={width}\n                height={height}\n                alt=\"\"\n              />\n            )}\n          </div>\n        ) : (\n          <div className={`file-icon ${color}`}>\n            {extension.length <= 4 && (\n              <span className=\"file-ext\">{extension}</span>\n            )}\n          </div>\n        )}\n        {shouldSpinnerRender && (\n          <div className={buildClassName('file-progress', color, spinnerClassNames)}>\n            <ProgressSpinner\n              progress={transferProgress}\n              size={smaller ? 's' : 'm'}\n              onClick={isUploading ? onClick : undefined}\n            />\n          </div>\n        )}\n        {onClick && <i className={buildClassName('icon-download', shouldSpinnerRender && 'hidden')} />}\n      </div>\n      <div className=\"file-info\">\n        <div className=\"file-title\">{renderText(name)}</div>\n        <div className=\"file-subtitle\">\n          <span>\n            {isTransferring && transferProgress ? `${Math.round(transferProgress * 100)}%` : sizeString}\n          </span>\n          {sender && <span className=\"file-sender\">{renderText(sender)}</span>}\n          {!sender && timestamp && (\n            <>\n              {' '}\n              <Link onClick={onDateClick}>{formatMediaDateTime(timestamp * 1000)}</Link>\n            </>\n          )}\n        </div>\n      </div>\n      {sender && timestamp && (\n        <Link onClick={onDateClick}>{formatPastTimeShort(timestamp * 1000)}</Link>\n      )}\n    </div>\n  );\n};\n\nexport default memo(File);\n","/* eslint-disable no-nested-ternary */\n/* eslint-disable no-bitwise */\n/* eslint-disable no-multi-assign */\n/* eslint-disable no-cond-assign */\n/* eslint-disable no-param-reassign */\n/* eslint-disable prefer-const */\n/* eslint-disable eqeqeq */\n\n/*\nSuperfast Blur - a fast Box Blur For Canvas\n\nVersion:     0.5\nAuthor:        Mario Klingemann\nContact:     mario@quasimondo.com\nWebsite:    http://www.quasimondo.com/BoxBlurForCanvas\nTwitter:    @quasimondo\n\nIn case you find this class useful - especially in commercial projects -\nI am not totally unhappy for a small donation to my PayPal account\nmario@quasimondo.de\n\nOr support me on flattr:\nhttps://flattr.com/thing/140066/Superfast-Blur-a-pretty-fast-Box-Blur-Effect-for-CanvasJavascript\n\nCopyright (c) 2011 Mario Klingemann\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n*/\n\n// eslint-disable-next-line max-len\nconst mul_table = [1, 57, 41, 21, 203, 34, 97, 73, 227, 91, 149, 62, 105, 45, 39, 137, 241, 107, 3, 173, 39, 71, 65, 238, 219, 101, 187, 87, 81, 151, 141, 133, 249, 117, 221, 209, 197, 187, 177, 169, 5, 153, 73, 139, 133, 127, 243, 233, 223, 107, 103, 99, 191, 23, 177, 171, 165, 159, 77, 149, 9, 139, 135, 131, 253, 245, 119, 231, 224, 109, 211, 103, 25, 195, 189, 23, 45, 175, 171, 83, 81, 79, 155, 151, 147, 9, 141, 137, 67, 131, 129, 251, 123, 30, 235, 115, 113, 221, 217, 53, 13, 51, 50, 49, 193, 189, 185, 91, 179, 175, 43, 169, 83, 163, 5, 79, 155, 19, 75, 147, 145, 143, 35, 69, 17, 67, 33, 65, 255, 251, 247, 243, 239, 59, 29, 229, 113, 111, 219, 27, 213, 105, 207, 51, 201, 199, 49, 193, 191, 47, 93, 183, 181, 179, 11, 87, 43, 85, 167, 165, 163, 161, 159, 157, 155, 77, 19, 75, 37, 73, 145, 143, 141, 35, 138, 137, 135, 67, 33, 131, 129, 255, 63, 250, 247, 61, 121, 239, 237, 117, 29, 229, 227, 225, 111, 55, 109, 216, 213, 211, 209, 207, 205, 203, 201, 199, 197, 195, 193, 48, 190, 47, 93, 185, 183, 181, 179, 178, 176, 175, 173, 171, 85, 21, 167, 165, 41, 163, 161, 5, 79, 157, 78, 154, 153, 19, 75, 149, 74, 147, 73, 144, 143, 71, 141, 140, 139, 137, 17, 135, 134, 133, 66, 131, 65, 129, 1];\n// eslint-disable-next-line max-len\nconst shg_table = [0, 9, 10, 10, 14, 12, 14, 14, 16, 15, 16, 15, 16, 15, 15, 17, 18, 17, 12, 18, 16, 17, 17, 19, 19, 18, 19, 18, 18, 19, 19, 19, 20, 19, 20, 20, 20, 20, 20, 20, 15, 20, 19, 20, 20, 20, 21, 21, 21, 20, 20, 20, 21, 18, 21, 21, 21, 21, 20, 21, 17, 21, 21, 21, 22, 22, 21, 22, 22, 21, 22, 21, 19, 22, 22, 19, 20, 22, 22, 21, 21, 21, 22, 22, 22, 18, 22, 22, 21, 22, 22, 23, 22, 20, 23, 22, 22, 23, 23, 21, 19, 21, 21, 21, 23, 23, 23, 22, 23, 23, 21, 23, 22, 23, 18, 22, 23, 20, 22, 23, 23, 23, 21, 22, 20, 22, 21, 22, 24, 24, 24, 24, 24, 22, 21, 24, 23, 23, 24, 21, 24, 23, 24, 22, 24, 24, 22, 24, 24, 22, 23, 24, 24, 24, 20, 23, 22, 23, 24, 24, 24, 24, 24, 24, 24, 23, 21, 23, 22, 23, 24, 24, 24, 22, 24, 24, 24, 23, 22, 24, 24, 25, 23, 25, 25, 23, 24, 25, 25, 24, 22, 25, 25, 25, 24, 23, 24, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 25, 23, 25, 23, 24, 25, 25, 25, 25, 25, 25, 25, 25, 25, 24, 22, 25, 25, 23, 25, 25, 20, 24, 25, 24, 25, 25, 22, 24, 25, 24, 25, 24, 25, 25, 24, 25, 25, 25, 25, 22, 25, 25, 25, 24, 25, 24, 25, 18];\n\nexport default function boxBlurCanvasRGB(context, top_x, top_y, width, height, radius, iterations) {\n  if (Number.isNaN(radius) || radius < 1) return;\n\n  radius |= 0;\n\n  if (Number.isNaN(iterations)) iterations = 1;\n  iterations |= 0;\n  if (iterations > 3) iterations = 3;\n  if (iterations < 1) iterations = 1;\n\n  const imageData = context.getImageData(top_x, top_y, width, height);\n\n  const pixels = imageData.data;\n\n  let rsum;\n  let gsum;\n  let bsum;\n  let x;\n  let y;\n  let i;\n  let p;\n  let p1;\n  let p2;\n  let yp;\n  let yi;\n  let yw;\n  let wm = width - 1;\n  let hm = height - 1;\n  let rad1 = radius + 1;\n\n  let r = [];\n  let g = [];\n  let b = [];\n\n  let mul_sum = mul_table[radius];\n  let shg_sum = shg_table[radius];\n\n  let vmin = [];\n  let vmax = [];\n\n  while (iterations-- > 0) {\n    yw = yi = 0;\n\n    for (y = 0; y < height; y++) {\n      rsum = pixels[yw] * rad1;\n      gsum = pixels[yw + 1] * rad1;\n      bsum = pixels[yw + 2] * rad1;\n\n      for (i = 1; i <= radius; i++) {\n        p = yw + (((i > wm ? wm : i)) << 2);\n        rsum += pixels[p++];\n        gsum += pixels[p++];\n        bsum += pixels[p++];\n      }\n\n      for (x = 0; x < width; x++) {\n        r[yi] = rsum;\n        g[yi] = gsum;\n        b[yi] = bsum;\n\n        if (y == 0) {\n          vmin[x] = ((p = x + rad1) < wm ? p : wm) << 2;\n          vmax[x] = ((p = x - radius) > 0 ? p << 2 : 0);\n        }\n\n        p1 = yw + vmin[x];\n        p2 = yw + vmax[x];\n\n        rsum += pixels[p1++] - pixels[p2++];\n        gsum += pixels[p1++] - pixels[p2++];\n        bsum += pixels[p1++] - pixels[p2++];\n\n        yi++;\n      }\n      yw += (width << 2);\n    }\n\n    for (x = 0; x < width; x++) {\n      yp = x;\n      rsum = r[yp] * rad1;\n      gsum = g[yp] * rad1;\n      bsum = b[yp] * rad1;\n\n      for (i = 1; i <= radius; i++) {\n        yp += (i > hm ? 0 : width);\n        rsum += r[yp];\n        gsum += g[yp];\n        bsum += b[yp];\n      }\n\n      yi = x << 2;\n      for (y = 0; y < height; y++) {\n        pixels[yi] = (rsum * mul_sum) >>> shg_sum;\n        pixels[yi + 1] = (gsum * mul_sum) >>> shg_sum;\n        pixels[yi + 2] = (bsum * mul_sum) >>> shg_sum;\n\n        if (x == 0) {\n          vmin[y] = ((p = y + rad1) < hm ? p : hm) * width;\n          vmax[y] = ((p = y - radius) > 0 ? p * width : 0);\n        }\n\n        p1 = x + vmin[y];\n        p2 = x + vmax[y];\n\n        rsum += r[p1] - r[p2];\n        gsum += g[p1] - g[p2];\n        bsum += b[p1] - b[p2];\n\n        yi += width << 2;\n      }\n    }\n  }\n\n  context.putImageData(imageData, top_x, top_y);\n}\n","import React, {\n  FC,\n  memo,\n  useCallback,\n  useEffect,\n  useRef,\n  useState,\n} from '../../lib/teact/teact';\n\nimport { ANIMATION_END_DELAY } from '../../config';\nimport useShowTransition from '../../hooks/useShowTransition';\nimport { TextPart } from '../common/helpers/renderMessageText';\nimport buildClassName from '../../util/buildClassName';\nimport captureEscKeyListener from '../../util/captureEscKeyListener';\n\nimport Portal from './Portal';\n\nimport './Notification.scss';\n\ntype OwnProps = {\n  containerId?: string;\n  message: TextPart[];\n  duration?: number;\n  onDismiss: () => void;\n};\n\nconst DEFAULT_DURATION = 3000;\nconst ANIMATION_DURATION = 150;\n\nconst Notification: FC<OwnProps> = ({\n  message, duration = DEFAULT_DURATION, containerId, onDismiss,\n}) => {\n  const [isOpen, setIsOpen] = useState(true);\n  // eslint-disable-next-line no-null/no-null\n  const timerRef = useRef<number | undefined>(null);\n\n  const { transitionClassNames } = useShowTransition(isOpen);\n\n  const closeAndDismiss = useCallback(() => {\n    setIsOpen(false);\n    setTimeout(onDismiss, ANIMATION_DURATION + ANIMATION_END_DELAY);\n  }, [onDismiss]);\n\n  useEffect(() => (isOpen ? captureEscKeyListener(closeAndDismiss) : undefined), [isOpen, closeAndDismiss]);\n\n  useEffect(() => {\n    timerRef.current = window.setTimeout(closeAndDismiss, duration);\n\n    return () => {\n      if (timerRef.current) {\n        clearTimeout(timerRef.current);\n        timerRef.current = undefined;\n      }\n    };\n  }, [duration, closeAndDismiss]);\n\n  const handleMouseEnter = useCallback(() => {\n    if (timerRef.current) {\n      clearTimeout(timerRef.current);\n      timerRef.current = undefined;\n    }\n  }, []);\n\n  const handleMouseLeave = useCallback(() => {\n    timerRef.current = window.setTimeout(closeAndDismiss, duration);\n  }, [duration, closeAndDismiss]);\n\n  return (\n    <Portal className=\"Notification-container\" containerId={containerId}>\n      <div\n        className={buildClassName('Notification', transitionClassNames)}\n        onClick={closeAndDismiss}\n        onMouseEnter={handleMouseEnter}\n        onMouseLeave={handleMouseLeave}\n      >\n        <div className=\"content\">\n          {message}\n        </div>\n      </div>\n    </Portal>\n  );\n};\n\nexport default memo(Notification);\n","import { EDITABLE_INPUT_ID } from '../../../../config';\n\nconst MAX_NESTING_PARENTS = 5;\n\nexport function isSelectionInsideInput(selectionRange: Range) {\n  const { commonAncestorContainer } = selectionRange;\n  let parentNode: HTMLElement | null = commonAncestorContainer as HTMLElement;\n  let iterations = 1;\n  while (parentNode && parentNode.id !== EDITABLE_INPUT_ID && iterations < MAX_NESTING_PARENTS) {\n    parentNode = parentNode.parentElement;\n    iterations++;\n  }\n\n  return Boolean(parentNode && parentNode.id === EDITABLE_INPUT_ID);\n}\n","import {\n  useCallback, useEffect, useMemo, useState,\n} from '../../../../lib/teact/teact';\n\nimport { EDITABLE_INPUT_ID } from '../../../../config';\nimport { IS_MOBILE_SCREEN } from '../../../../util/environment';\nimport {\n  EmojiData, EmojiModule, EmojiRawData, uncompressEmoji,\n} from '../../../../util/emoji';\nimport useFlag from '../../../../hooks/useFlag';\nimport focusEditableElement from '../../../../util/focusEditableElement';\n\nlet emojiDataPromise: Promise<EmojiModule>;\nlet emojiRawData: EmojiRawData;\nlet emojiData: EmojiData;\n\nconst RE_NOT_EMOJI_SEARCH = /[^-_:\\p{L}\\p{N}]+/iu;\nconst EMOJIS_LIMIT = 36;\n\nexport default function useEmojiTooltip(\n  isAllowed: boolean,\n  html: string,\n  recentEmojiIds: string[],\n  inputId = EDITABLE_INPUT_ID,\n  onUpdateHtml: (html: string) => void,\n) {\n  const [isOpen, markIsOpen, unmarkIsOpen] = useFlag();\n  const [emojiIds, setEmojiIds] = useState<string[]>([]);\n  const [filteredEmojis, setFilteredEmojis] = useState<Emoji[]>([]);\n\n  const recentEmojis = useMemo(\n    () => {\n      if (!emojiIds.length || !recentEmojiIds.length) {\n        return [];\n      }\n\n      return recentEmojiIds\n        .map((emojiId) => emojiData.emojis[emojiId])\n        .filter<Emoji>(Boolean as any);\n    },\n    [emojiIds, recentEmojiIds],\n  );\n\n  // Initialize data on first render.\n  useEffect(() => {\n    const exec = () => {\n      setEmojiIds(Object.keys(emojiData.emojis));\n    };\n\n    if (emojiData) {\n      exec();\n    } else {\n      ensureEmojiData()\n        .then(exec);\n    }\n  }, []);\n\n  useEffect(() => {\n    if (!isAllowed || !html || !emojiIds.length) {\n      unmarkIsOpen();\n      return;\n    }\n\n    const code = getEmojiCode(html);\n    if (!code) {\n      setFilteredEmojis([]);\n      unmarkIsOpen();\n      return;\n    }\n\n    const filter = code.substr(1);\n    const matched = filter === ''\n      ? recentEmojis\n      : emojiIds\n        .filter((emojiId) => emojiData.emojis[emojiId].names.find((name) => name.includes(filter)))\n        .slice(0, EMOJIS_LIMIT)\n        .map((emojiId) => emojiData.emojis[emojiId]);\n\n    if (matched.length) {\n      markIsOpen();\n      setFilteredEmojis(matched);\n    } else {\n      unmarkIsOpen();\n    }\n  }, [emojiIds, html, isAllowed, markIsOpen, recentEmojis, unmarkIsOpen]);\n\n  const insertEmoji = useCallback((textEmoji: string) => {\n    const atIndex = html.lastIndexOf(':');\n    if (atIndex !== -1) {\n      onUpdateHtml(`${html.substr(0, atIndex)}${textEmoji}`);\n      const messageInput = document.getElementById(inputId)!;\n      if (!IS_MOBILE_SCREEN) {\n        requestAnimationFrame(() => {\n          focusEditableElement(messageInput, true);\n        });\n      }\n    }\n\n    unmarkIsOpen();\n  }, [html, inputId, onUpdateHtml, unmarkIsOpen]);\n\n  return {\n    isEmojiTooltipOpen: isOpen,\n    closeEmojiTooltip: unmarkIsOpen,\n    filteredEmojis,\n    insertEmoji,\n  };\n}\n\nfunction getEmojiCode(html: string) {\n  const tempEl = document.createElement('div');\n  tempEl.innerHTML = html.replace('<br>', '\\n');\n  const text = tempEl.innerText;\n\n  const lastSymbol = text[text.length - 1];\n  const lastWord = text.split(RE_NOT_EMOJI_SEARCH).pop();\n\n  if (\n    !text.length || RE_NOT_EMOJI_SEARCH.test(lastSymbol)\n    || !lastWord || !lastWord.startsWith(':')\n  ) {\n    return undefined;\n  }\n\n  return lastWord.toLowerCase();\n}\n\nasync function ensureEmojiData() {\n  if (!emojiDataPromise) {\n    emojiDataPromise = import('emoji-data-ios/emoji-data.json') as unknown as Promise<EmojiModule>;\n    emojiRawData = (await emojiDataPromise).default;\n\n    emojiData = uncompressEmoji(emojiRawData);\n  }\n\n  return emojiDataPromise;\n}\n","import React, { FC, memo } from '../../../lib/teact/teact';\nimport { OwnProps } from './EmojiTooltip';\nimport { Bundles } from '../../../util/moduleLoader';\n\nimport useModuleLoader from '../../../hooks/useModuleLoader';\n\nconst EmojiTooltipAsync: FC<OwnProps> = (props) => {\n  const { isOpen } = props;\n  const EmojiTooltip = useModuleLoader(Bundles.Extra, 'EmojiTooltip', !isOpen);\n\n  // eslint-disable-next-line react/jsx-props-no-spreading\n  return EmojiTooltip ? <EmojiTooltip {...props} /> : undefined;\n};\n\nexport default memo(EmojiTooltipAsync);\n","import { ChangeEvent } from 'react';\nimport React, {\n  FC, useEffect, useRef, memo, useState, useCallback,\n} from '../../../lib/teact/teact';\nimport { withGlobal } from '../../../lib/teact/teactn';\n\nimport { GlobalActions } from '../../../global/types';\nimport { IAnchorPosition, ISettings } from '../../../types';\n\nimport { EDITABLE_INPUT_ID } from '../../../config';\nimport { selectCurrentMessageList, selectReplyingToId } from '../../../modules/selectors';\nimport { debounce } from '../../../util/schedulers';\nimport focusEditableElement from '../../../util/focusEditableElement';\nimport buildClassName from '../../../util/buildClassName';\nimport { pick } from '../../../util/iteratees';\nimport {\n  IS_ANDROID, IS_IOS, IS_MOBILE_SCREEN, IS_TOUCH_ENV,\n} from '../../../util/environment';\nimport captureKeyboardListeners from '../../../util/captureKeyboardListeners';\nimport useLayoutEffectWithPrevDeps from '../../../hooks/useLayoutEffectWithPrevDeps';\nimport useFlag from '../../../hooks/useFlag';\nimport parseEmojiOnlyString from '../../common/helpers/parseEmojiOnlyString';\nimport { isSelectionInsideInput } from './helpers/selection';\n\nimport TextFormatter from './TextFormatter';\n\nconst CONTEXT_MENU_CLOSE_DELAY_MS = 100;\n// Focus slows down animation, also it breaks transition layout in Chrome\nconst FOCUS_DELAY_MS = 350;\nconst TRANSITION_DURATION_FACTOR = 50;\n\ntype OwnProps = {\n  id: string;\n  editableInputId?: string;\n  html: string;\n  placeholder: string;\n  shouldSetFocus: boolean;\n  shouldSupressFocus?: boolean;\n  shouldSupressTextFormatter?: boolean;\n  onUpdate: (html: string) => void;\n  onSupressedFocus?: () => void;\n  onSend: () => void;\n};\n\ntype StateProps = {\n  currentChatId?: number;\n  replyingToId?: number;\n  noTabCapture?: boolean;\n  messageSendKeyCombo?: ISettings['messageSendKeyCombo'];\n};\n\ntype DispatchProps = Pick<GlobalActions, 'editLastMessage'>;\n\nconst MAX_INPUT_HEIGHT = IS_MOBILE_SCREEN ? 256 : 416;\nconst TAB_INDEX_PRIORITY_TIMEOUT = 2000;\nconst TEXT_FORMATTER_SAFE_AREA_PX = 90;\n// For some reason Safari inserts `<br>` after user removes text from input\nconst SAFARI_BR = '<br>';\n\nfunction clearSelection() {\n  const selection = window.getSelection();\n  if (!selection) {\n    return;\n  }\n\n  if (selection.removeAllRanges) {\n    selection.removeAllRanges();\n  } else if (selection.empty) {\n    selection.empty();\n  }\n}\n\nconst MessageInput: FC<OwnProps & StateProps & DispatchProps> = ({\n  id,\n  editableInputId,\n  html,\n  placeholder,\n  shouldSetFocus,\n  shouldSupressFocus,\n  shouldSupressTextFormatter,\n  onUpdate,\n  onSupressedFocus,\n  onSend,\n  currentChatId,\n  replyingToId,\n  noTabCapture,\n  messageSendKeyCombo,\n  editLastMessage,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const inputRef = useRef<HTMLDivElement>(null);\n  // eslint-disable-next-line no-null/no-null\n  const cloneRef = useRef<HTMLDivElement>(null);\n\n  const isContextMenuOpenRef = useRef(false);\n  const [isTextFormatterOpen, openTextFormatter, closeTextFormatter] = useFlag();\n  const [textFormatterAnchorPosition, setTextFormatterAnchorPosition] = useState<IAnchorPosition>();\n  const [selectedRange, setSelectedRange] = useState<Range>();\n\n  useEffect(() => {\n    updateInputHeight(false);\n  }, []);\n\n  useLayoutEffectWithPrevDeps(([prevHtml]) => {\n    if (html !== inputRef.current!.innerHTML) {\n      inputRef.current!.innerHTML = html;\n    }\n\n    if (html !== cloneRef.current!.innerHTML) {\n      cloneRef.current!.innerHTML = html;\n    }\n\n    if (prevHtml !== undefined && prevHtml !== html) {\n      updateInputHeight(!html.length);\n    }\n  }, [html]);\n\n  const focusInput = useCallback(() => {\n    // Avoid focusing during animation\n    if (inputRef.current!.closest('.from, .to')) {\n      setTimeout(focusInput, FOCUS_DELAY_MS);\n      return;\n    }\n\n    focusEditableElement(inputRef.current!);\n  }, []);\n\n  const handleCloseTextFormatter = useCallback(() => {\n    closeTextFormatter();\n    clearSelection();\n  }, [closeTextFormatter]);\n\n  function checkSelection() {\n    // Disable the formatter on iOS devices for now.\n    if (IS_IOS) {\n      return;\n    }\n\n    const selection = window.getSelection();\n    if (!selection || !selection.rangeCount || isContextMenuOpenRef.current) {\n      closeTextFormatter();\n      return;\n    }\n\n    const selectionRange = selection.getRangeAt(0);\n    const selectedText = selectionRange.toString().trim();\n    if (\n      shouldSupressTextFormatter\n      || !isSelectionInsideInput(selectionRange)\n      || !selectedText\n      || parseEmojiOnlyString(selectedText)\n      || !selectionRange.START_TO_END\n    ) {\n      closeTextFormatter();\n      return;\n    }\n\n    const selectionRect = selectionRange.getBoundingClientRect();\n    const inputRect = inputRef.current!.getBoundingClientRect();\n\n    let x = (selectionRect.left + selectionRect.width / 2) - inputRect.left;\n\n    if (x < TEXT_FORMATTER_SAFE_AREA_PX) {\n      x = TEXT_FORMATTER_SAFE_AREA_PX;\n    } else if (x > inputRect.width - TEXT_FORMATTER_SAFE_AREA_PX) {\n      x = inputRect.width - TEXT_FORMATTER_SAFE_AREA_PX;\n    }\n\n    setTextFormatterAnchorPosition({\n      x,\n      y: selectionRect.top - inputRect.top,\n    });\n\n    setSelectedRange(selectionRange);\n    openTextFormatter();\n  }\n\n  function handleMouseDown(event: React.MouseEvent<HTMLDivElement, MouseEvent>) {\n    function handleMouseUp() {\n      checkSelection();\n\n      event.target.removeEventListener('mouseup', handleMouseUp);\n    }\n\n    if (event.button !== 2) {\n      event.target.addEventListener('mouseup', handleMouseUp);\n      return;\n    }\n\n    if (isContextMenuOpenRef.current === true) {\n      return;\n    }\n\n    isContextMenuOpenRef.current = true;\n\n    function closeContextMenuMouseListener() {\n      setTimeout(() => {\n        isContextMenuOpenRef.current = false;\n      }, CONTEXT_MENU_CLOSE_DELAY_MS);\n\n      window.removeEventListener('mouseup', closeContextMenuMouseListener);\n    }\n\n    function closeContextMenuKeyListener(e: KeyboardEvent) {\n      if (e.key !== 'Esc' && e.key !== 'Escape') {\n        return;\n      }\n\n      setTimeout(() => {\n        isContextMenuOpenRef.current = false;\n      }, CONTEXT_MENU_CLOSE_DELAY_MS);\n\n      window.removeEventListener('keydown', closeContextMenuKeyListener);\n    }\n\n    document.addEventListener('mousedown', closeContextMenuMouseListener);\n    document.addEventListener('keydown', closeContextMenuKeyListener);\n  }\n\n  function handleKeyDown(e: React.KeyboardEvent<HTMLDivElement>) {\n    function handleKeyUp() {\n      checkSelection();\n\n      e.target.removeEventListener('keyup', handleKeyUp);\n    }\n\n    if (e.key === 'Enter' && !e.shiftKey) {\n      if (\n        !(IS_IOS || IS_ANDROID)\n        && (\n          (messageSendKeyCombo === 'enter' && !e.shiftKey)\n          || (messageSendKeyCombo === 'ctrl-enter' && (e.ctrlKey || e.metaKey))\n        )\n      ) {\n        e.preventDefault();\n\n        closeTextFormatter();\n        onSend();\n      }\n    } else if (e.key === 'ArrowUp' && !html.length) {\n      e.preventDefault();\n      editLastMessage();\n    } else {\n      e.target.addEventListener('keyup', handleKeyUp);\n    }\n  }\n\n  function handleTouchSelection() {\n    if (!IS_ANDROID) {\n      return;\n    }\n\n    checkSelection();\n  }\n\n  function handleChange(e: ChangeEvent<HTMLDivElement>) {\n    const { innerHTML, textContent } = e.currentTarget;\n\n    onUpdate(innerHTML === SAFARI_BR ? '' : innerHTML);\n\n    // Reset focus on the input to remove any active styling when input is cleared\n    if (!IS_TOUCH_ENV && (!textContent || !textContent.length)) {\n      const selection = window.getSelection()!;\n      if (selection) {\n        inputRef.current!.blur();\n        selection.removeAllRanges();\n        focusEditableElement(inputRef.current!, true);\n      }\n    }\n  }\n\n  function stopEvent(e: React.MouseEvent<HTMLDivElement, MouseEvent>) {\n    if (!IS_ANDROID) {\n      return;\n    }\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  function updateInputHeight(willSend = false) {\n    const input = inputRef.current!;\n    const clone = cloneRef.current!;\n    const currentHeight = Number(input.style.height.replace('px', ''));\n    const newHeight = Math.min(clone.scrollHeight, MAX_INPUT_HEIGHT);\n    if (newHeight === currentHeight) {\n      return;\n    }\n\n    const transitionDuration = Math.round(\n      TRANSITION_DURATION_FACTOR * Math.log(Math.abs(newHeight - currentHeight)),\n    );\n\n    const exec = () => {\n      input.style.height = `${newHeight}px`;\n      input.style.transitionDuration = `${transitionDuration}ms`;\n      input.classList.toggle('overflown', clone.scrollHeight > MAX_INPUT_HEIGHT);\n    };\n\n    if (willSend) {\n      // Sync with sending animation\n      requestAnimationFrame(exec);\n    } else {\n      exec();\n    }\n  }\n\n  useEffect(() => {\n    if (IS_TOUCH_ENV) {\n      return;\n    }\n\n    focusInput();\n  }, [currentChatId, focusInput, replyingToId, shouldSetFocus]);\n\n  useEffect(() => {\n    if (noTabCapture) {\n      return undefined;\n    }\n\n    const captureFirstTab = debounce((e: KeyboardEvent) => {\n      if (e.key === 'Tab') {\n        e.preventDefault();\n        requestAnimationFrame(focusInput);\n      }\n    }, TAB_INDEX_PRIORITY_TIMEOUT, true, false);\n\n    return captureKeyboardListeners({ onTab: captureFirstTab });\n  }, [focusInput, noTabCapture]);\n\n  useEffect(() => {\n    const input = inputRef.current!;\n\n    function supressFocus() {\n      input.blur();\n    }\n\n    if (shouldSupressFocus) {\n      input.addEventListener('focus', supressFocus);\n    }\n\n    return () => {\n      input.removeEventListener('focus', supressFocus);\n    };\n  }, [shouldSupressFocus]);\n\n  const className = buildClassName(\n    'form-control custom-scroll',\n    html.length > 0 && 'touched',\n    shouldSupressFocus && 'focus-disabled',\n  );\n\n  return (\n    <div id={id} onClick={shouldSupressFocus ? onSupressedFocus : undefined}>\n      <div\n        ref={inputRef}\n        id={editableInputId || EDITABLE_INPUT_ID}\n        className={className}\n        contentEditable\n        onClick={focusInput}\n        onChange={handleChange}\n        onKeyDown={handleKeyDown}\n        onMouseDown={handleMouseDown}\n        onContextMenu={stopEvent}\n        onTouchCancel={handleTouchSelection}\n      />\n      <div ref={cloneRef} className={buildClassName(className, 'clone')} />\n      <span className=\"placeholder-text\">{placeholder}</span>\n      <TextFormatter\n        isOpen={isTextFormatterOpen}\n        anchorPosition={textFormatterAnchorPosition}\n        selectedRange={selectedRange}\n        onClose={handleCloseTextFormatter}\n      />\n    </div>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global): StateProps => {\n    const { chatId: currentChatId, threadId } = selectCurrentMessageList(global) || {};\n    const { messageSendKeyCombo } = global.settings.byKey;\n\n    return {\n      currentChatId,\n      messageSendKeyCombo,\n      replyingToId: currentChatId && threadId ? selectReplyingToId(global, currentChatId, threadId) : undefined,\n      noTabCapture: global.isPollModalOpen || global.payment.isPaymentModalOpen,\n    };\n  },\n  (setGlobal, actions): DispatchProps => pick(actions, ['editLastMessage']),\n)(MessageInput));\n","import { useRef } from '../lib/teact/teact';\n\nimport fastBlur from '../lib/fastBlur';\nimport useOnChange from './useOnChange';\nimport useBlur from './useBlur';\nimport { imgToCanvas } from '../util/files';\n\nconst RADIUS = 2;\nconst ITERATIONS = 2;\n\nexport default function useBlurSync(dataUri: string | false | undefined) {\n  const blurredRef = useRef<string>();\n\n  let isChanged = false;\n\n  useOnChange(() => {\n    isChanged = true;\n\n    blurredRef.current = undefined;\n\n    if (!dataUri) {\n      return;\n    }\n\n    const img = new Image();\n    img.src = dataUri;\n    if (!img.width) {\n      return;\n    }\n\n    const canvas = imgToCanvas(img);\n    fastBlur(canvas.getContext('2d'), 0, 0, canvas.width, canvas.height, RADIUS, ITERATIONS);\n\n    blurredRef.current = canvas.toDataURL();\n  }, [dataUri]);\n\n  // Sometimes `Image` do not manage to load synchronously,\n  // so we fall back the non-blurred variant and prepare the async one at least for the next time\n  const blurredAsync = useBlur(dataUri || undefined, Boolean(blurredRef.current));\n\n  return blurredRef.current || (!isChanged && blurredAsync) || dataUri || undefined;\n}\n","import React, { FC, memo, useCallback } from '../../lib/teact/teact';\n\nimport { ApiMessage, ApiWebPage } from '../../api/types';\n\nimport { getFirstLinkInMessage, getMessageSummaryText, getMessageWebPage } from '../../modules/helpers';\nimport buildClassName from '../../util/buildClassName';\nimport trimText from '../../util/trimText';\nimport renderText from './helpers/renderText';\nimport { formatPastTimeShort } from '../../util/dateFormat';\nimport useLang from '../../hooks/useLang';\n\nimport Media from './Media';\nimport Link from '../ui/Link';\nimport SafeLink from './SafeLink';\n\nimport './WebLink.scss';\n\nconst MAX_TEXT_LENGTH = 170; // symbols\n\ntype OwnProps = {\n  message: ApiMessage;\n  senderTitle?: string;\n  onMessageClick: (messageId: number, chatId: number) => void;\n};\n\nconst WebLink: FC<OwnProps> = ({ message, senderTitle, onMessageClick }) => {\n  const lang = useLang();\n\n  let linkData: ApiWebPage | undefined = getMessageWebPage(message);\n\n  if (!linkData) {\n    const link = getFirstLinkInMessage(message);\n    if (link) {\n      const { url, domain } = link;\n      const messageText = getMessageSummaryText(lang, message);\n\n      linkData = {\n        siteName: domain.replace(/^www./, ''),\n        url: url.includes('://') ? url : url.includes('@') ? `mailto:${url}` : `http://${url}`,\n        description: messageText !== url ? messageText : undefined,\n      } as ApiWebPage;\n    }\n  }\n\n  const handleMessageClick = useCallback(() => {\n    onMessageClick(message.id, message.chatId);\n  }, [onMessageClick, message.id, message.chatId]);\n\n  if (!linkData) {\n    return undefined;\n  }\n\n  const {\n    siteName,\n    url,\n    displayUrl,\n    title,\n    description,\n    photo,\n  } = linkData;\n\n  const truncatedDescription = !senderTitle && trimText(description, MAX_TEXT_LENGTH);\n\n  const className = buildClassName(\n    'WebLink scroll-item',\n    !photo && 'without-photo',\n  );\n\n  return (\n    <div\n      className={className}\n      data-initial={(siteName || displayUrl)[0]}\n    >\n      {photo && (\n        <Media message={message} />\n      )}\n      <div className=\"content\">\n        <Link className=\"site-title\" onClick={handleMessageClick}>{renderText(title || siteName || displayUrl)}</Link>\n        {truncatedDescription && (\n          <Link className=\"site-description\" onClick={handleMessageClick}>{renderText(truncatedDescription)}</Link>\n        )}\n        <SafeLink\n          url={url}\n          className=\"site-name\"\n          text=\"\"\n        >\n          {url.replace('mailto:', '') || displayUrl}\n        </SafeLink>\n        {senderTitle && <div className=\"sender-name\">{renderText(senderTitle)}</div>}\n      </div>\n      {senderTitle && (\n        <div className=\"message-date\">\n          <Link\n            className=\"date\"\n            onClick={handleMessageClick}\n          >\n            {formatPastTimeShort(message.date * 1000)}\n          </Link>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default memo(WebLink);\n","import { useCallback } from '../../../../lib/teact/teact';\n\nexport enum ChatAnimationTypes {\n  Move,\n  Opacity,\n  None,\n}\n\nexport function useChatAnimationType(orderDiffById: Record<number, number>) {\n  const movesUp = useCallback((id: number) => orderDiffById[id] < 0, [orderDiffById]);\n  const movesDown = useCallback((id: number) => orderDiffById[id] > 0, [orderDiffById]);\n\n  const orderDiffIds = Object.keys(orderDiffById).map(Number);\n  const numberOfUp = orderDiffIds.filter(movesUp).length;\n  const numberOfDown = orderDiffIds.filter(movesDown).length;\n\n  return useCallback((chatId: number): ChatAnimationTypes => {\n    const orderDiff = orderDiffById[chatId];\n\n    if (orderDiff === 0) {\n      return ChatAnimationTypes.None;\n    }\n\n    if (\n      orderDiff === Infinity\n      || orderDiff === -Infinity\n      || (movesUp(chatId) && numberOfUp <= numberOfDown)\n      || (movesDown(chatId) && numberOfDown < numberOfUp)\n    ) {\n      return ChatAnimationTypes.Opacity;\n    }\n\n    return ChatAnimationTypes.Move;\n  }, [movesDown, movesUp, numberOfDown, numberOfUp, orderDiffById]);\n}\n","import React, { FC, memo } from '../../../lib/teact/teact';\n\nimport { ApiChat } from '../../../api/types';\n\nimport { formatIntegerCompact } from '../../../util/textFormat';\nimport buildClassName from '../../../util/buildClassName';\n\nimport ShowTransition from '../../ui/ShowTransition';\n\nimport './Badge.scss';\n\ntype OwnProps = {\n  chat: ApiChat;\n  isPinned?: boolean;\n  isMuted?: boolean;\n};\n\nconst Badge: FC<OwnProps> = ({ chat, isPinned, isMuted }) => {\n  const isShown = Boolean(chat.unreadCount || chat.hasUnreadMark || isPinned);\n  const className = buildClassName(\n    'Badge',\n    isMuted && 'muted',\n    isPinned && 'pinned',\n    Boolean(chat.unreadCount || chat.hasUnreadMark) && 'unread',\n  );\n\n  function renderContent() {\n    if (chat.unreadCount) {\n      if (chat.unreadMentionsCount) {\n        return (\n          <div className=\"Badge-wrapper\">\n            <div className=\"Badge mention\">\n              <i className=\"icon-mention\" />\n            </div>\n            <div className={className}>\n              {formatIntegerCompact(chat.unreadCount)}\n            </div>\n          </div>\n        );\n      }\n\n      return (\n        <div className={className}>\n          {formatIntegerCompact(chat.unreadCount)}\n        </div>\n      );\n    } else if (chat.hasUnreadMark) {\n      return (\n        <div className={className} />\n      );\n    } else if (isPinned) {\n      return (\n        <div className={className}>\n          <i className=\"icon-pinned-chat\" />\n        </div>\n      );\n    }\n\n    return undefined;\n  }\n\n  return (\n    <ShowTransition isCustom className=\"Badge-transition\" isOpen={isShown}>\n      {renderContent}\n    </ShowTransition>\n  );\n};\n\nexport default memo(Badge);\n","import React, {\n  FC, memo, useCallback, useLayoutEffect, useRef,\n} from '../../../lib/teact/teact';\nimport { withGlobal } from '../../../lib/teact/teactn';\n\nimport useLang, { LangFn } from '../../../hooks/useLang';\n\nimport { GlobalActions, MessageListType } from '../../../global/types';\nimport {\n  ApiChat, ApiUser, ApiMessage, ApiMessageOutgoingStatus, ApiFormattedText, MAIN_THREAD_ID,\n} from '../../../api/types';\n\nimport { ANIMATION_END_DELAY } from '../../../config';\nimport { IS_MOBILE_SCREEN } from '../../../util/environment';\nimport {\n  getChatTitle,\n  isChatPrivate,\n  isActionMessage,\n  getPrivateChatUserId,\n  getMessageAction,\n  getMessageSenderName,\n  isChatChannel,\n  getMessageMediaHash,\n  getMessageSummaryText,\n  getMessageMediaThumbDataUri,\n  getMessageVideo,\n  getMessageSticker,\n  selectIsChatMuted,\n} from '../../../modules/helpers';\nimport {\n  selectChat, selectUser, selectChatMessage, selectOutgoingStatus, selectDraft, selectCurrentMessageList,\n  selectNotifySettings, selectNotifyExceptions,\n} from '../../../modules/selectors';\nimport { renderActionMessageText } from '../../common/helpers/renderActionMessageText';\nimport renderText from '../../common/helpers/renderText';\nimport { fastRaf } from '../../../util/schedulers';\nimport buildClassName from '../../../util/buildClassName';\nimport { pick } from '../../../util/iteratees';\nimport useEnsureMessage from '../../../hooks/useEnsureMessage';\nimport useChatContextActions from '../../../hooks/useChatContextActions';\nimport useFlag from '../../../hooks/useFlag';\nimport useMedia from '../../../hooks/useMedia';\nimport { ChatAnimationTypes } from './hooks';\n\nimport Avatar from '../../common/Avatar';\nimport VerifiedIcon from '../../common/VerifiedIcon';\nimport TypingStatus from '../../common/TypingStatus';\nimport LastMessageMeta from '../../common/LastMessageMeta';\nimport DeleteChatModal from '../../common/DeleteChatModal';\nimport ListItem from '../../ui/ListItem';\nimport Badge from './Badge';\n\nimport './Chat.scss';\n\ntype OwnProps = {\n  style?: string;\n  chatId: number;\n  folderId?: number;\n  orderDiff: number;\n  animationType: ChatAnimationTypes;\n  isSelected: boolean;\n  isPinned?: boolean;\n};\n\ntype StateProps = {\n  chat?: ApiChat;\n  isMuted?: boolean;\n  privateChatUser?: ApiUser;\n  actionTargetUser?: ApiUser;\n  actionTargetMessage?: ApiMessage;\n  actionTargetChatId?: number;\n  lastMessageSender?: ApiUser;\n  lastMessageOutgoingStatus?: ApiMessageOutgoingStatus;\n  draft?: ApiFormattedText;\n  messageListType?: MessageListType;\n  animationLevel?: number;\n  lastSyncTime?: number;\n};\n\ntype DispatchProps = Pick<GlobalActions, 'openChat' | 'focusLastMessage'>;\n\nconst ANIMATION_DURATION = 200;\n\nconst Chat: FC<OwnProps & StateProps & DispatchProps> = ({\n  style,\n  chatId,\n  folderId,\n  orderDiff,\n  animationType,\n  isSelected,\n  isPinned,\n  chat,\n  isMuted,\n  privateChatUser,\n  actionTargetUser,\n  lastMessageSender,\n  lastMessageOutgoingStatus,\n  actionTargetMessage,\n  actionTargetChatId,\n  draft,\n  messageListType,\n  animationLevel,\n  lastSyncTime,\n  openChat,\n  focusLastMessage,\n}) => {\n  // eslint-disable-next-line no-null/no-null\n  const ref = useRef<HTMLDivElement>(null);\n\n  const [isDeleteModalOpen, openDeleteModal, closeDeleteModal] = useFlag();\n\n  const { lastMessage, typingStatus } = chat || {};\n  const isAction = lastMessage && isActionMessage(lastMessage);\n\n  useEnsureMessage(chatId, isAction ? lastMessage!.replyToMessageId : undefined, actionTargetMessage);\n\n  const mediaThumbnail = lastMessage && !getMessageSticker(lastMessage)\n    ? getMessageMediaThumbDataUri(lastMessage)\n    : undefined;\n  const mediaBlobUrl = useMedia(lastMessage ? getMessageMediaHash(lastMessage, 'micro') : undefined);\n\n  // Sets animation excess values when `orderDiff` changes and then resets excess values to animate.\n  useLayoutEffect(() => {\n    if (animationLevel === 0) {\n      return;\n    }\n\n    const element = ref.current!;\n\n    // TODO Refactor animation: create `useListAnimation` that owns `orderDiff` and `animationType`\n    if (animationType === ChatAnimationTypes.Opacity) {\n      element.style.opacity = '0';\n\n      fastRaf(() => {\n        element.classList.add('animate-opacity');\n        element.style.opacity = '1';\n      });\n    } else if (animationType === ChatAnimationTypes.Move) {\n      element.style.transform = `translate3d(0, ${-orderDiff * 100}%, 0)`;\n\n      fastRaf(() => {\n        element.classList.add('animate-transform');\n        element.style.transform = '';\n      });\n    } else {\n      return;\n    }\n\n    setTimeout(() => {\n      fastRaf(() => {\n        element.classList.remove('animate-opacity', 'animate-transform');\n        element.style.opacity = '';\n        element.style.transform = '';\n      });\n    }, ANIMATION_DURATION + ANIMATION_END_DELAY);\n  }, [animationLevel, orderDiff, animationType]);\n\n  const handleClick = useCallback(() => {\n    openChat({ id: chatId });\n\n    if (isSelected && messageListType === 'thread') {\n      focusLastMessage();\n    }\n  }, [\n    isSelected,\n    messageListType,\n    openChat,\n    chatId,\n    focusLastMessage,\n  ]);\n\n  const contextActions = useChatContextActions({\n    chat,\n    privateChatUser,\n    handleDelete: openDeleteModal,\n    folderId,\n    isPinned,\n  });\n\n  const lang = useLang();\n\n  if (!chat) {\n    return undefined;\n  }\n\n  function renderLastMessageOrTyping() {\n    if (typingStatus && lastMessage && typingStatus.timestamp > lastMessage.date * 1000) {\n      return <TypingStatus typingStatus={typingStatus} />;\n    }\n\n    if (draft && draft.text.length) {\n      return (\n        <p className=\"last-message\">\n          <span className=\"draft\">{lang('Draft')}</span>\n          {renderText(draft.text)}\n        </p>\n      );\n    }\n\n    if (!lastMessage) {\n      return undefined;\n    }\n\n    if (isAction) {\n      const actionOrigin = chat && (isChatChannel(chat) || lastMessage.senderId === lastMessage.chatId)\n        ? chat\n        : lastMessageSender;\n\n      return (\n        <p className=\"last-message\">\n          {renderText(renderActionMessageText(\n            lang,\n            lastMessage,\n            actionOrigin,\n            actionTargetUser,\n            actionTargetMessage,\n            actionTargetChatId,\n            { asPlain: true },\n          ) as string)}\n        </p>\n      );\n    }\n\n    const senderName = getMessageSenderName(chatId, lastMessageSender);\n\n    return (\n      <p className=\"last-message\">\n        {senderName && (\n          <span className=\"sender-name\">{renderText(senderName)}</span>\n        )}\n        {renderMessageSummary(lang, lastMessage!, mediaBlobUrl || mediaThumbnail)}\n      </p>\n    );\n  }\n\n  const className = buildClassName(\n    'Chat chat-item-clickable',\n    isChatPrivate(chatId) ? 'private' : 'group',\n    isSelected && !IS_MOBILE_SCREEN && 'selected',\n  );\n\n  return (\n    <ListItem\n      ref={ref}\n      className={className}\n      style={style}\n      ripple={!IS_MOBILE_SCREEN}\n      contextActions={contextActions}\n      onClick={handleClick}\n    >\n      <Avatar\n        chat={chat}\n        user={privateChatUser}\n        withOnlineStatus\n        isSavedMessages={privateChatUser && privateChatUser.isSelf}\n        lastSyncTime={lastSyncTime}\n      />\n      <div className=\"info\">\n        <div className=\"title\">\n          <h3>{renderText(getChatTitle(chat, privateChatUser))}</h3>\n          {chat.isVerified && <VerifiedIcon />}\n          {isMuted && <i className=\"icon-muted-chat\" />}\n          {chat.lastMessage && (\n            <LastMessageMeta message={chat.lastMessage} outgoingStatus={lastMessageOutgoingStatus} />\n          )}\n        </div>\n        <div className=\"subtitle\">\n          {renderLastMessageOrTyping()}\n          <Badge chat={chat} isPinned={isPinned} isMuted={isMuted} />\n        </div>\n      </div>\n      <DeleteChatModal\n        isOpen={isDeleteModalOpen}\n        onClose={closeDeleteModal}\n        chat={chat}\n      />\n    </ListItem>\n  );\n};\n\nfunction renderMessageSummary(lang: LangFn, message: ApiMessage, blobUrl?: string) {\n  if (!blobUrl) {\n    return renderText(getMessageSummaryText(lang, message));\n  }\n\n  return (\n    <span className=\"media-preview\">\n      <img src={blobUrl} alt=\"\" />\n      {getMessageVideo(message) && <i className=\"icon-play\" />}\n      {renderText(getMessageSummaryText(lang, message, true))}\n    </span>\n  );\n}\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { chatId }): StateProps => {\n    const chat = selectChat(global, chatId);\n    if (!chat || !chat.lastMessage) {\n      return {};\n    }\n\n    const { senderId, replyToMessageId, isOutgoing } = chat.lastMessage;\n    const lastMessageSender = senderId ? selectUser(global, senderId) : undefined;\n    const lastMessageAction = getMessageAction(chat.lastMessage);\n    const actionTargetMessage = lastMessageAction && replyToMessageId\n      ? selectChatMessage(global, chat.id, replyToMessageId)\n      : undefined;\n    const { targetUserId: actionTargetUserId, targetChatId: actionTargetChatId } = lastMessageAction || {};\n    const privateChatUserId = getPrivateChatUserId(chat);\n    const { type: messageListType } = selectCurrentMessageList(global) || {};\n\n    return {\n      chat,\n      isMuted: selectIsChatMuted(chat, selectNotifySettings(global), selectNotifyExceptions(global)),\n      lastMessageSender,\n      ...(isOutgoing && { lastMessageOutgoingStatus: selectOutgoingStatus(global, chat.lastMessage) }),\n      ...(privateChatUserId && { privateChatUser: selectUser(global, privateChatUserId) }),\n      ...(actionTargetUserId && { actionTargetUser: selectUser(global, actionTargetUserId) }),\n      actionTargetChatId,\n      actionTargetMessage,\n      draft: selectDraft(global, chatId, MAIN_THREAD_ID),\n      messageListType,\n      animationLevel: global.settings.byKey.animationLevel,\n      lastSyncTime: global.lastSyncTime,\n    };\n  },\n  (setGlobal, actions): DispatchProps => pick(actions, [\n    'openChat',\n    'focusLastMessage',\n  ]),\n)(Chat));\n","import React, {\n  FC, memo, useMemo, useCallback, useEffect,\n} from '../../../lib/teact/teact';\nimport { withGlobal } from '../../../lib/teact/teactn';\n\nimport { GlobalActions } from '../../../global/types';\nimport {\n  ApiChat, ApiChatFolder, ApiUser, MAIN_THREAD_ID,\n} from '../../../api/types';\nimport { NotifyException, NotifySettings } from '../../../types';\n\nimport { ALL_CHATS_PRELOAD_DISABLED, CHAT_HEIGHT_PX, CHAT_LIST_SLICE } from '../../../config';\nimport { IS_ANDROID } from '../../../util/environment';\nimport usePrevious from '../../../hooks/usePrevious';\nimport { mapValues, pick } from '../../../util/iteratees';\nimport { getChatOrder, prepareChatList, prepareFolderListIds } from '../../../modules/helpers';\nimport {\n  selectChatFolder, selectCurrentMessageList, selectNotifyExceptions, selectNotifySettings,\n} from '../../../modules/selectors';\nimport useInfiniteScroll from '../../../hooks/useInfiniteScroll';\nimport { useChatAnimationType } from './hooks';\n\nimport InfiniteScroll from '../../ui/InfiniteScroll';\nimport Loading from '../../ui/Loading';\nimport Chat from './Chat';\n\ntype OwnProps = {\n  folderType: 'all' | 'archived' | 'folder';\n  folderId?: number;\n  noChatsText?: string;\n};\n\ntype StateProps = {\n  chatsById: Record<number, ApiChat>;\n  usersById: Record<number, ApiUser>;\n  chatFolder?: ApiChatFolder;\n  listIds?: number[];\n  currentChatId?: number;\n  orderedPinnedIds?: number[];\n  lastSyncTime?: number;\n  isInDiscussionThread?: boolean;\n  notifySettings: NotifySettings;\n  notifyExceptions: Record<number, NotifyException>;\n};\n\ntype DispatchProps = Pick<GlobalActions, 'loadMoreChats' | 'preloadTopChatMessages'>;\n\nenum FolderTypeToListType {\n  'all' = 'active',\n  'archived' = 'archived'\n}\n\nconst ChatList: FC<OwnProps & StateProps & DispatchProps> = ({\n  folderType,\n  folderId,\n  noChatsText = 'Chat list is empty.',\n  chatFolder,\n  chatsById,\n  usersById,\n  listIds,\n  currentChatId,\n  orderedPinnedIds,\n  lastSyncTime,\n  isInDiscussionThread,\n  notifySettings,\n  notifyExceptions,\n  loadMoreChats,\n  preloadTopChatMessages,\n}) => {\n  const [currentListIds, currentPinnedIds] = useMemo(() => {\n    return folderType === 'folder' && chatFolder\n      ? prepareFolderListIds(chatsById, usersById, chatFolder, notifySettings, notifyExceptions)\n      : [listIds, orderedPinnedIds];\n  }, [folderType, chatFolder, chatsById, usersById, notifySettings, notifyExceptions, listIds, orderedPinnedIds]);\n\n  const [orderById, orderedIds] = useMemo(() => {\n    if (!currentListIds || (folderType === 'folder' && !chatFolder)) {\n      return [];\n    }\n    const newChatArrays = prepareChatList(chatsById, currentListIds, currentPinnedIds, folderType);\n    const singleList = [...newChatArrays.pinnedChats, ...newChatArrays.otherChats];\n    const newOrderedIds = singleList.map(({ id }) => id);\n    const newOrderById = singleList.reduce((acc, chat, i) => {\n      acc[chat.id] = i;\n      return acc;\n    }, {} as Record<string, number>);\n\n    return [newOrderById, newOrderedIds];\n  }, [currentListIds, currentPinnedIds, folderType, chatFolder, chatsById]);\n\n  const prevOrderById = usePrevious(orderById);\n\n  const orderDiffById = orderById && prevOrderById\n    ? mapValues(orderById, (order, id) => {\n      return order - (prevOrderById[id] !== undefined ? prevOrderById[id] : Infinity);\n    })\n    : {};\n\n  const loadMoreOfType = useCallback(() => {\n    loadMoreChats({ listType: folderType === 'archived' ? 'archived' : 'active' });\n  }, [loadMoreChats, folderType]);\n\n  const [viewportIds, getMore] = useInfiniteScroll(\n    lastSyncTime ? loadMoreOfType : undefined,\n    orderedIds,\n    undefined,\n    CHAT_LIST_SLICE,\n    folderType === 'all' && !ALL_CHATS_PRELOAD_DISABLED,\n  );\n\n  // TODO Refactor to not call `prepareChatList` twice\n  const chatArrays = viewportIds && prepareChatList(chatsById, viewportIds, currentPinnedIds, folderType);\n\n  useEffect(() => {\n    if (lastSyncTime && folderType === 'all') {\n      preloadTopChatMessages();\n    }\n  }, [lastSyncTime, folderType, preloadTopChatMessages]);\n\n  const getAnimationType = useChatAnimationType(orderDiffById);\n\n  function renderChats() {\n    const viewportOffset = orderedIds!.indexOf(viewportIds![0]);\n    const pinnedOffset = viewportOffset + chatArrays!.pinnedChats.length;\n\n    return (\n      <div\n        className=\"scroll-container\"\n        // @ts-ignore\n        style={IS_ANDROID ? `height: ${orderedIds!.length * CHAT_HEIGHT_PX}px` : undefined}\n        teactFastList\n      >\n        {chatArrays!.pinnedChats.map(({ id }, i) => (\n          <Chat\n            key={id}\n            teactOrderKey={i}\n            chatId={id}\n            isPinned\n            folderId={folderId}\n            isSelected={id === currentChatId && !isInDiscussionThread}\n            animationType={getAnimationType(id)}\n            orderDiff={orderDiffById[id]}\n            // @ts-ignore\n            style={`top: ${(viewportOffset + i) * CHAT_HEIGHT_PX}px;`}\n          />\n        ))}\n        {chatArrays!.otherChats.map((chat, i) => (\n          <Chat\n            key={chat.id}\n            teactOrderKey={getChatOrder(chat)}\n            chatId={chat.id}\n            folderId={folderId}\n            isSelected={chat.id === currentChatId && !isInDiscussionThread}\n            animationType={getAnimationType(chat.id)}\n            orderDiff={orderDiffById[chat.id]}\n            // @ts-ignore\n            style={`top: ${(pinnedOffset + i) * CHAT_HEIGHT_PX}px;`}\n          />\n        ))}\n      </div>\n    );\n  }\n\n  return (\n    <InfiniteScroll\n      className=\"chat-list custom-scroll\"\n      items={viewportIds}\n      onLoadMore={getMore}\n      preloadBackwards={CHAT_LIST_SLICE}\n      noFastList\n      noScrollRestore\n    >\n      {viewportIds && viewportIds.length && chatArrays ? (\n        renderChats()\n      ) : viewportIds && !viewportIds.length ? (\n        <div className=\"no-results\">{noChatsText}</div>\n      ) : (\n        <Loading key=\"loading\" />\n      )}\n    </InfiniteScroll>\n  );\n};\n\nexport default memo(withGlobal<OwnProps>(\n  (global, { folderType, folderId }): StateProps => {\n    const {\n      chats: {\n        listIds,\n        byId: chatsById,\n        orderedPinnedIds,\n      },\n      users: { byId: usersById },\n      lastSyncTime,\n    } = global;\n    const { chatId: currentChatId, threadId: currentThreadId } = selectCurrentMessageList(global) || {};\n\n    const listType = folderType !== 'folder' ? FolderTypeToListType[folderType] : undefined;\n    const chatFolder = folderId ? selectChatFolder(global, folderId) : undefined;\n\n    return {\n      chatsById,\n      usersById,\n      currentChatId,\n      lastSyncTime,\n      ...(listType ? {\n        listIds: listIds[listType],\n        orderedPinnedIds: orderedPinnedIds[listType],\n      } : {\n        chatFolder,\n      }),\n      isInDiscussionThread: currentThreadId !== MAIN_THREAD_ID,\n      notifySettings: selectNotifySettings(global),\n      notifyExceptions: selectNotifyExceptions(global),\n    };\n  },\n  (setGlobal, actions): DispatchProps => pick(actions, ['loadMoreChats', 'preloadTopChatMessages']),\n)(ChatList));\n","import { useCallback, useEffect, useState } from '../../../../lib/teact/teact';\n\nimport { ApiMessageEntityTypes, ApiChatMember, ApiUser } from '../../../../api/types';\nimport { EDITABLE_INPUT_ID } from '../../../../config';\nimport { getUserFirstOrLastName } from '../../../../modules/helpers';\nimport searchUserName from '../helpers/searchUserName';\nimport { IS_MOBILE_SCREEN } from '../../../../util/environment';\nimport focusEditableElement from '../../../../util/focusEditableElement';\nimport useFlag from '../../../../hooks/useFlag';\n\nconst RE_NOT_USERNAME_SEARCH = /[^@_\\d\\wа-яё]+/i;\n\nexport default function useMentionTooltip(\n  canSuggestMembers: boolean | undefined,\n  html: string,\n  onUpdateHtml: (html: string) => void,\n  inputId: string = EDITABLE_INPUT_ID,\n  groupChatMembers?: ApiChatMember[],\n  currentUserId?: number,\n  usersById?: Record<number, ApiUser>,\n) {\n  const [isOpen, markIsOpen, unmarkIsOpen] = useFlag();\n  const [currentFilter, setCurrentFilter] = useState('');\n  const [filteredMembers, setFilteredMembers] = useState<ApiChatMember[]>([]);\n\n  const getFilteredMembers = useCallback((filter) => {\n    if (!groupChatMembers || !usersById) {\n      return undefined;\n    }\n\n    return groupChatMembers.filter(({ userId }) => {\n      const user = usersById[userId];\n      if (userId === currentUserId || !user) {\n        return false;\n      }\n\n      return !filter || searchUserName(filter, user);\n    });\n  }, [groupChatMembers, currentUserId, usersById]);\n\n  useEffect(() => {\n    if (!canSuggestMembers || !html.length) {\n      unmarkIsOpen();\n      return;\n    }\n\n    const usernameFilter = getUsernameFilter(html);\n\n    if (usernameFilter) {\n      const filter = usernameFilter ? usernameFilter.substr(1) : '';\n      const membersToMention = getFilteredMembers(filter);\n      if (membersToMention && membersToMention.length) {\n        markIsOpen();\n        setCurrentFilter(filter);\n        setFilteredMembers(membersToMention);\n      } else {\n        unmarkIsOpen();\n      }\n    } else {\n      unmarkIsOpen();\n    }\n  }, [canSuggestMembers, html, getFilteredMembers, markIsOpen, unmarkIsOpen]);\n\n  const insertMention = useCallback((user: ApiUser, forceFocus = false) => {\n    if (!user.username && !getUserFirstOrLastName(user)) {\n      return;\n    }\n\n    const insertedHtml = user.username\n      ? `@${user.username}`\n      : `<a\n          class=\"text-entity-link\"\n          data-entity-type=\"${ApiMessageEntityTypes.MentionName}\"\n          data-user-id=\"${user.id}\"\n          contenteditable=\"false\"\n        >${getUserFirstOrLastName(user)}</a>`;\n\n    const atIndex = html.lastIndexOf('@');\n    if (atIndex !== -1) {\n      onUpdateHtml(`${html.substr(0, atIndex)}${insertedHtml}&nbsp;`);\n      const messageInput = document.getElementById(inputId)!;\n      if (!IS_MOBILE_SCREEN) {\n        requestAnimationFrame(() => {\n          focusEditableElement(messageInput, forceFocus);\n        });\n      }\n    }\n\n    unmarkIsOpen();\n  }, [html, inputId, onUpdateHtml, unmarkIsOpen]);\n\n  return {\n    isMentionTooltipOpen: isOpen,\n    mentionFilter: currentFilter,\n    closeMentionTooltip: unmarkIsOpen,\n    insertMention,\n    mentionFilteredMembers: filteredMembers,\n  };\n}\n\nfunction getUsernameFilter(html: string) {\n  const tempEl = document.createElement('div');\n  tempEl.innerHTML = html;\n  const text = tempEl.innerText;\n\n  const lastSymbol = text[text.length - 1];\n  const lastWord = text.split(RE_NOT_USERNAME_SEARCH).pop();\n\n  if (\n    !text.length || RE_NOT_USERNAME_SEARCH.test(lastSymbol)\n    || !lastWord || !lastWord.startsWith('@')\n  ) {\n    return undefined;\n  }\n\n  return lastWord;\n}\n","import { ApiUser } from '../../../../api/types';\nimport { getUserFullName } from '../../../../modules/helpers';\nimport searchWords from '../../../../util/searchWords';\n\n// TODO: Support cyrillic translit search\nexport default function searchUserName(filter: string, user: ApiUser) {\n  const usernameLowered = user.username.toLowerCase();\n  const fullName = getUserFullName(user);\n  const fullNameLowered = fullName && fullName.toLowerCase();\n  const filterLowered = filter.toLowerCase();\n\n  return usernameLowered.startsWith(filterLowered) || (\n    fullNameLowered && searchWords(fullNameLowered, filterLowered)\n  );\n}\n"],"sourceRoot":""}